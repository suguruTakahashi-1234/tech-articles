---
title: "[Swift] enum の switch-case 文で where を使うと Xcode の補完機能の恩恵を得られない件"
emoji: "🕊"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Swift"]
published: true
---

以下のような enum を定義して、swtich-case文を記述してみます。

```swift
enum Menu: String {
    case rice
    case salad
}

var menu: Menu = .rice

switch menu {
case .rice:
    print("menu: \(menu.rawValue)") // menu: rice
    
case .salad:
    print("menu: \(menu.rawValue)")
}
```

ここで `rice` の場合に、さらに `where` によって外から条件を絞ります。

```swift
var menu: Menu = .rice
var isChild: Bool = true

switch menu { // ❌ Switch must be exhaustive
case .rice where isChild:
    print("menu: \(menu.rawValue), isChild: \(isChild)")

case .rice where !isChild:
    print("menu: \(menu.rawValue), isChild: \(isChild)")
    
case .salad:
    print("menu: \(menu.rawValue), isChild: \(isChild)")
}
```

↑ 一見、上記の記述で全パターン網羅しているように見えますが、これではコンパイルエラーになります。

Swift に自動補完してもらうと、なんと以下のように `case .rice:` が足りないと補完されます。

```swift
switch menu {
case .rice where isChild:
    print("menu: \(menu.rawValue), isChild: \(isChild)")

case .rice where !isChild:
    print("menu: \(menu.rawValue), isChild: \(isChild)")
    
case .salad:
    print("menu: \(menu.rawValue), isChild: \(isChild)")
    
case .rice: // ← 補完される
    <#code#>
}
```

どうやら、`where` の条件は、switch-case 文の管轄外みたいです。

ここで、`where` を使いながら `default:` を定義していると条件漏れに気づけないので、いっそのこと、`default` の場合は `fatalError` などさせて、気付けるような仕組みを作った方がいいと思います。

```swift
switch menu {
case .rice where isChild:
    print("menu: \(menu.rawValue), isChild: \(isChild)")

case .rice where !isChild:
    print("menu: \(menu.rawValue), isChild: \(isChild)")
    
case .salad:
    print("menu: \(menu.rawValue), isChild: \(isChild)")
    
default:
    fatalError("unexpected") // fatalError などしておくとよさそう
}
```

もし、switch-case 文の Xcode の補完機能の恩恵を得たいなら、以下のようにタプルを使って書くのが良いかもしれません。

```swift
switch (menu, isChild) {
case (.rice, true):
    print("menu: \(menu.rawValue), isChild: \(isChild)")
    
case (.rice, false):
    print("menu: \(menu.rawValue), isChild: \(isChild)")
    
case (.salad, _):
    print("menu: \(menu.rawValue), isChild: \(isChild)")
}
```

そもそも、Xcode の補完機能の恩恵を得られなくても良いのであれば、以下のようにも書けます。

```swift
switch menu  {
case .rice:
    if isChild {
        print("menu: \(menu.rawValue), isChild: \(isChild)")
    } else {
        print("menu: \(menu.rawValue), isChild: \(isChild)")
    }

case .salad:
    print("menu: \(menu.rawValue), isChild: \(isChild)")
}
```

ただ、`where` をつけること

case-by-case ですね。

