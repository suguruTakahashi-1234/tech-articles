[{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003e特定の条件のみのに適応される配列の \u003ccode\u003eextension\u003c/code\u003e を記述したい場合がありました。\u003cbr\u003e\n調べたところ \u003ccode\u003ewhere\u003c/code\u003e を用いるとうまく表現することができたのでそれの紹介になります。\u003c/p\u003e\n\n\u003cp\u003e環境：Xcode 12.5.1\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"やりかた\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%8B%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやりかた\u003c/h1\u003e\n\n\u003cp\u003e例： \u003ccode\u003eInt\u003c/code\u003e の配列のみに適応される \u003ccode\u003eextension\u003c/code\u003e を書きたい場合\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"kt\"\u003eFoundation\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"kt\"\u003eArray\u003c/span\u003e \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"kt\"\u003eElement\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003edoublePrint\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eforEach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eintArray\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"n\"\u003eintArray\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edoublePrint\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 4\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 6\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003estrArray\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"n\"\u003estrArray\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edoublePrint\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← これはコンパイルエラーになる\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003estrAndIntArray\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eAny\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"n\"\u003estrAndIntArray\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edoublePrint\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← これもコンパイルエラーになる\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ポイント\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eポイント\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eextension\u003c/code\u003e と \u003ccode\u003ewhere\u003c/code\u003e で条件を絞ることができる（Protocolの拡張などでも用いる技）\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eArray\u003c/code\u003e の場合 \u003ccode\u003eElement\u003c/code\u003e で要素の型を得られるので \u003ccode\u003eextension Array where Element == \"型名\"\u003c/code\u003e などで絞ることができる\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ewhere\u003c/code\u003e の条件に合わない使い方をするとコンパイルエラーにしてくれる（実行時エラーにはならない）\u003c/li\u003e\n\u003c/ul\u003e\n","body":"# はじめに\n\n特定の条件のみのに適応される配列の `extension` を記述したい場合がありました。\n調べたところ `where` を用いるとうまく表現することができたのでそれの紹介になります。\n\n環境：Xcode 12.5.1\n\n# やりかた\n\n例： `Int` の配列のみに適応される `extension` を書きたい場合\n\n```swift\nimport Foundation\n\nextension Array where Element == Int {\n    func doublePrint() {\n        self.forEach { print($0 * 2) }\n    }\n}\n\nlet intArray = [1, 2, 3]\nintArray.doublePrint()\n\n// 出力\n// 2\n// 4\n// 6\n\nlet strArray = [\"1\", \"2\", \"3\"]\nstrArray.doublePrint() // ← これはコンパイルエラーになる\n\nlet strAndIntArray: [Any] = [\"1\", \"2\", 3]\nstrAndIntArray.doublePrint() // ← これもコンパイルエラーになる\n```\n\n# ポイント\n- `extension` と `where` で条件を絞ることができる（Protocolの拡張などでも用いる技）\n- `Array` の場合 `Element` で要素の型を得られるので `extension Array where Element == \"型名\"` などで絞ることができる\n- `where` の条件に合わない使い方をするとコンパイルエラーにしてくれる（実行時エラーにはならない）\n","coediting":false,"comments_count":0,"created_at":"2021-09-26T09:42:31+09:00","group":null,"id":"96c6ee4f30d95de4afe6","likes_count":1,"private":false,"reactions_count":0,"tags":[{"name":"Swift","versions":[]}],"title":"【Swift】特定の条件のみのに適応される配列の extension を記述する方法（where）","updated_at":"2021-09-27T14:04:27+09:00","url":"https://qiita.com/ikuraikura/items/96c6ee4f30d95de4afe6","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eCombine で処理を連結するときに、\u003ccode\u003eAnyPublisher\u003c/code\u003e の \u003ccode\u003eOutput\u003c/code\u003e に空の \u003ccode\u003eVoid\u003c/code\u003e を返して、何も返り値がないことを暗に示していたのですが、それよりは \u003ccode\u003e.ignoreOutput()\u003c/code\u003e して \u003ccode\u003eOutput\u003c/code\u003e を \u003ccode\u003eNever\u003c/code\u003e にしたほうが意図が伝わるのでは？ と思い、それで実装したところ思ったように動かなかったため、挙動を整理しました。\u003c/p\u003e\n\n\u003cp\u003e環境：Xcode 12.5.1\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"結論\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E8%AB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結論\u003c/h1\u003e\n\n\u003cp\u003e先に結論から述べます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eAnyPublisher\u003c/code\u003e の \u003ccode\u003eOutput\u003c/code\u003e が \u003ccode\u003eNever\u003c/code\u003e になった段階でストリームは流れなくなる\u003c/li\u003e\n\u003cli\u003e何も返り値がない場合の \u003ccode\u003eAnyPublisher\u003c/code\u003e の \u003ccode\u003eOutput\u003c/code\u003e は \u003ccode\u003eVoid\u003c/code\u003e を返して、\u003ccode\u003eNever\u003c/code\u003e にしたい箇所で \u003ccode\u003e.ignoreOutput()\u003c/code\u003e とつけて \u003ccode\u003eNever\u003c/code\u003e にしてあげるのが良さそう\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実験その1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E9%A8%93%E3%81%9D%E3%81%AE1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実験その1\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003eCurrentValueSubject\u0026lt;Int, Never\u0026gt;\u003c/code\u003e の \u003ccode\u003enumber\u003c/code\u003e が 0 か負の値かチェックするという適当な処理を例にして実験します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"kt\"\u003eCombine\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"kt\"\u003eFoundation\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eenum\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eError\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003ezeroError\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eminusError\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eSet\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eAnyCancellable\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enumber\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n       \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edropFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"checkZero\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003echeckZero\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"checkMinus\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 上のflatMapの段階でNeverになるのでここにストリームは流れてこない\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003echeckMinus\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"completion.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ehoge\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003ehoge\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003echeckZero\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eFuture\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eVoid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epromise\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enumberValue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"now: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enumberValue\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003epromise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezeroError\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003epromise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e(()))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eignoreOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003echeckMinus\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eFuture\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eVoid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epromise\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enumberValue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"now: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enumberValue\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"n\"\u003enumberValue\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003epromise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eminusError\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003epromise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e(()))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eignoreOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nf\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 本当はここでminusErrorになってほしいがcheckMinusに到達しない\u003c/span\u003e\n\u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// checkZero\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// now: 1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// checkZero\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// now: -1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// checkZero\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// now: 0\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// error: zeroError\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// completion.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのように \u003ccode\u003echeckMinus()\u003c/code\u003eまで処理が到達していないことがわかります。\u003cbr\u003e\nつまり、前段の \u003ccode\u003echeckZero()\u003c/code\u003e で止まっていることがわかります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eポイント\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eAnyPublisher\u003c/code\u003e 返す関数側で \u003ccode\u003eNever\u003c/code\u003e を返すようにしている\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eAnyPublisher\u003c/code\u003e の \u003ccode\u003eOutput\u003c/code\u003e が \u003ccode\u003eNever\u003c/code\u003e になった段階でストリームは流れなくなる（本当は流れてほしい）\n\n\u003cul\u003e\n\u003cli\u003e→ 途中の \u003ccode\u003eflatMap\u003c/code\u003e で \u003ccode\u003eNever\u003c/code\u003e にするとストリームはそこで止まる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実験その2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E9%A8%93%E3%81%9D%E3%81%AE2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実験その2\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"kt\"\u003eCombine\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"kt\"\u003eFoundation\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eenum\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eError\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003ezeroError\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eminusError\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eSet\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eAnyCancellable\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enumber\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n       \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edropFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eVoid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"checkZero\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003echeckZero\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 最後のflatMapでNeverにする\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"checkMinus\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003echeckMinus\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// AnyPublisher\u0026lt;Void, TestError\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eignoreOutput\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Void を Never に変換\u003c/span\u003e\n                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 型合わせ\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"completion.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ehoge\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003ehoge\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003echeckZero\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eVoid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Voidに変更\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eFuture\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eVoid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epromise\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enumberValue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"now: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enumberValue\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003epromise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezeroError\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003epromise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e(()))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//    .ignoreOutput()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003echeckMinus\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eVoid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Voidに変更\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eFuture\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eVoid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003epromise\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enumberValue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"now: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enumberValue\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"n\"\u003enumberValue\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003epromise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eminusError\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003epromise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e(()))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//    .ignoreOutput()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nf\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// checkZero\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// now: 1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// checkMinus\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// now: 1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// checkZero\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// now: -1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// checkMinus\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// now: -1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// error: minusError\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// completion.\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// checkZero\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// now: 0\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e今回は \u003ccode\u003echeckZero()\u003c/code\u003e の \u003ccode\u003eflatMap\u003c/code\u003e では、\u003ccode\u003eNever\u003c/code\u003e としていないため、ストリームが流れて、\u003ccode\u003echeckMinus()\u003c/code\u003e まで処理が流れていることがわかります。\u003c/p\u003e\n\n\u003cp\u003eまた、最後の \u003ccode\u003eAnyPublisher\u003c/code\u003e 返す関数側で \u003ccode\u003eNever\u003c/code\u003e であれば、\u003ccode\u003esink()\u003c/code\u003e の \u003ccode\u003ereceiveValue\u003c/code\u003e までストリームがながれていないこともわかります（もしながれていれば、\u003ccode\u003e\"receiveValue: \\(hoge)\"\u003c/code\u003e が出力されるはず）。\u003c/p\u003e\n\n\u003cp\u003eこれは、 \u003ccode\u003eNever\u003c/code\u003e になった段階でストリームは流れなくなる証拠でもあります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eポイント\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eAnyPublisher\u003c/code\u003e 返す関数側で \u003ccode\u003eNever\u003c/code\u003e とはせずに、\u003ccode\u003eflatMap\u003c/code\u003e の中で必要に応じて、 \u003ccode\u003eNever\u003c/code\u003e に変換する\u003c/li\u003e\n\u003cli\u003eこれなら、ストリーム側でコントールが可能になる\n\n\u003cul\u003e\n\u003cli\u003e→ 何も返り値がない場合の \u003ccode\u003eAnyPublisher\u003c/code\u003e の \u003ccode\u003eOutput\u003c/code\u003e は \u003ccode\u003eVoid\u003c/code\u003e を返して、\u003ccode\u003eNever\u003c/code\u003e にしたい箇所で \u003ccode\u003e.ignoreOutput()\u003c/code\u003e とつけてあげるのが良さそう\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eAnyPublisher\u003c/code\u003e の \u003ccode\u003eOutput\u003c/code\u003e が \u003ccode\u003eNever\u003c/code\u003e になった段階でストリームは流れなくなる\u003c/li\u003e\n\u003cli\u003e何も返り値がない場合の \u003ccode\u003eAnyPublisher\u003c/code\u003e の \u003ccode\u003eOutput\u003c/code\u003e は \u003ccode\u003eVoid\u003c/code\u003e を返して、\u003ccode\u003eNever\u003c/code\u003e にしたい箇所で \u003ccode\u003e.ignoreOutput()\u003c/code\u003e とつけて \u003ccode\u003eNever\u003c/code\u003e にしてあげるのが良さそう\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eそもそも、こういう処理は \u003ccode\u003easync/await\u003c/code\u003e でやってあげるとよさそうであるが、 iOS15 以上対応まででよいアプリ開発がいつになったらできるのだろうか、、、\u003c/p\u003e\n","body":"\n# はじめに\n\nCombine で処理を連結するときに、`AnyPublisher` の `Output` に空の `Void` を返して、何も返り値がないことを暗に示していたのですが、それよりは `.ignoreOutput()` して `Output` を `Never` にしたほうが意図が伝わるのでは？ と思い、それで実装したところ思ったように動かなかったため、挙動を整理しました。\n\n\n環境：Xcode 12.5.1\n\n# 結論\n\n先に結論から述べます。\n\n- `AnyPublisher` の `Output` が `Never` になった段階でストリームは流れなくなる\n- 何も返り値がない場合の `AnyPublisher` の `Output` は `Void` を返して、`Never` にしたい箇所で `.ignoreOutput()` とつけて `Never` にしてあげるのが良さそう\n\n# 実験その1\n\n`CurrentValueSubject\u003cInt, Never\u003e` の `number` が 0 か負の値かチェックするという適当な処理を例にして実験します。\n\n```swift\nimport Combine\nimport Foundation\n\nenum TestError: Error {\n    case zeroError\n    case minusError\n}\n\nvar cancellables: Set\u003cAnyCancellable\u003e = []\nlet number = CurrentValueSubject\u003cInt, Never\u003e(0)\n\nfunc start() {\n       number\n        .dropFirst()\n        .setFailureType(to: TestError.self)\n        .flatMap { _ -\u003e AnyPublisher\u003cNever, TestError\u003e in\n            print(\"checkZero\")\n            return checkZero()\n        }\n        .flatMap { _ -\u003e AnyPublisher\u003cNever, TestError\u003e in\n            print(\"checkMinus\") // 上のflatMapの段階でNeverになるのでここにストリームは流れてこない\n            return checkMinus()\n        }\n        .sink { completion in\n            switch completion {\n            case .finished:\n                print(\"finished\")\n            case let .failure(error):\n                print(\"error: \\(error)\")\n            }\n            print(\"completion.\")\n        } receiveValue: { hoge in\n            print(\"receiveValue: \\(hoge)\")\n        }\n        .store(in: \u0026cancellables)\n}\n\nfunc checkZero() -\u003e AnyPublisher\u003cNever, TestError\u003e {\n    Future\u003cVoid, TestError\u003e { promise in\n        let numberValue = number.value\n        print(\"now: \\(numberValue)\")\n        guard number.value != 0 else {\n            promise(.failure(TestError.zeroError))\n            return\n        }\n        promise(.success(()))\n    }\n    .ignoreOutput()\n    .eraseToAnyPublisher()\n}\n\nfunc checkMinus() -\u003e AnyPublisher\u003cNever, TestError\u003e {\n    Future\u003cVoid, TestError\u003e { promise in\n        let numberValue = number.value\n        print(\"now: \\(numberValue)\")\n        guard numberValue \u003e 0 else {\n            promise(.failure(TestError.minusError))\n            return\n        }\n        promise(.success(()))\n    }\n    .ignoreOutput()\n    .eraseToAnyPublisher()\n}\n\nstart()\n\nnumber.value = 1\nnumber.value = -1 // 本当はここでminusErrorになってほしいがcheckMinusに到達しない\nnumber.value = 0\n\n// 出力\n// checkZero\n// now: 1\n// checkZero\n// now: -1\n// checkZero\n// now: 0\n// error: zeroError\n// completion.\n```\n\nこのように `checkMinus()`まで処理が到達していないことがわかります。\nつまり、前段の ` checkZero()` で止まっていることがわかります。\n\n- ポイント\n    - `AnyPublisher` 返す関数側で `Never` を返すようにしている\n    - `AnyPublisher` の `Output` が `Never` になった段階でストリームは流れなくなる（本当は流れてほしい）\n        - → 途中の `flatMap` で `Never` にするとストリームはそこで止まる\n\n# 実験その2\n\n```swift\nimport Combine\nimport Foundation\n\nenum TestError: Error {\n    case zeroError\n    case minusError\n}\n\nvar cancellables: Set\u003cAnyCancellable\u003e = []\nlet number = CurrentValueSubject\u003cInt, Never\u003e(0)\n\nfunc start() {\n       number\n        .dropFirst()\n        .setFailureType(to: TestError.self)\n        .flatMap { _ -\u003e AnyPublisher\u003cVoid, TestError\u003e in\n            print(\"checkZero\")\n            return checkZero()\n        }\n        .flatMap { _ -\u003e AnyPublisher\u003cNever, TestError\u003e in // 最後のflatMapでNeverにする\n            print(\"checkMinus\")\n            return checkMinus() // AnyPublisher\u003cVoid, TestError\u003e\n                .ignoreOutput() // Void を Never に変換\n                .eraseToAnyPublisher() // 型合わせ\n        }\n        .sink { completion in\n            switch completion {\n            case .finished:\n                print(\"finished\")\n            case let .failure(error):\n                print(\"error: \\(error)\")\n            }\n            print(\"completion.\")\n        } receiveValue: { hoge in\n            print(\"receiveValue: \\(hoge)\")\n        }\n        .store(in: \u0026cancellables)\n}\n\nfunc checkZero() -\u003e AnyPublisher\u003cVoid, TestError\u003e { // Voidに変更\n    Future\u003cVoid, TestError\u003e { promise in\n        let numberValue = number.value\n        print(\"now: \\(numberValue)\")\n        guard number.value != 0 else {\n            promise(.failure(TestError.zeroError))\n            return\n        }\n        promise(.success(()))\n    }\n//    .ignoreOutput()\n    .eraseToAnyPublisher()\n}\n\nfunc checkMinus() -\u003e AnyPublisher\u003cVoid, TestError\u003e { // Voidに変更\n    Future\u003cVoid, TestError\u003e { promise in\n        let numberValue = number.value\n        print(\"now: \\(numberValue)\")\n        guard numberValue \u003e 0 else {\n            promise(.failure(TestError.minusError))\n            return\n        }\n        promise(.success(()))\n    }\n//    .ignoreOutput()\n    .eraseToAnyPublisher()\n}\n\nstart()\n\nnumber.value = 1\nnumber.value = -1\nnumber.value = 0\n\n// 出力\n// checkZero\n// now: 1\n// checkMinus\n// now: 1\n// checkZero\n// now: -1\n// checkMinus\n// now: -1\n// error: minusError\n// completion.\n// checkZero\n// now: 0\n```\n\n今回は `checkZero()` の `flatMap` では、`Never` としていないため、ストリームが流れて、`checkMinus()` まで処理が流れていることがわかります。\n\nまた、最後の `AnyPublisher` 返す関数側で `Never` であれば、`sink()` の `receiveValue` までストリームがながれていないこともわかります（もしながれていれば、`\"receiveValue: \\(hoge)\"` が出力されるはず）。\n\nこれは、 `Never` になった段階でストリームは流れなくなる証拠でもあります。\n\n- ポイント\n    - `AnyPublisher` 返す関数側で `Never` とはせずに、`flatMap` の中で必要に応じて、 `Never` に変換する\n    - これなら、ストリーム側でコントールが可能になる\n      - → 何も返り値がない場合の `AnyPublisher` の `Output` は `Void` を返して、`Never` にしたい箇所で `.ignoreOutput()` とつけてあげるのが良さそう\n\n# まとめ\n\n- `AnyPublisher` の `Output` が `Never` になった段階でストリームは流れなくなる\n- 何も返り値がない場合の `AnyPublisher` の `Output` は `Void` を返して、`Never` にしたい箇所で `.ignoreOutput()` とつけて `Never` にしてあげるのが良さそう\n\nそもそも、こういう処理は `async/await` でやってあげるとよさそうであるが、 iOS15 以上対応まででよいアプリ開発がいつになったらできるのだろうか、、、\n\n","coediting":false,"comments_count":0,"created_at":"2021-09-26T02:21:45+09:00","group":null,"id":"6efb4c75774ae066f45d","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Swift","versions":[]},{"name":"Combine","versions":[]}],"title":"【Swift】【Combine入門】AnyPublisher の Output を Never にした場合の挙動","updated_at":"2021-09-26T09:54:43+09:00","url":"https://qiita.com/ikuraikura/items/6efb4c75774ae066f45d","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"強制アンラップを返す関数の注意点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BC%B7%E5%88%B6%E3%82%A2%E3%83%B3%E3%83%A9%E3%83%83%E3%83%97%E3%82%92%E8%BF%94%E3%81%99%E9%96%A2%E6%95%B0%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e強制アンラップを返す関数の注意点\u003c/h1\u003e\n\n\u003cp\u003e強制アンラップを返す関数で \u003ccode\u003enil\u003c/code\u003e を返すような処理を書くとコンパイルエラーにはならずに実行時エラーになります。\u003c/p\u003e\n\n\u003cp\u003e環境：Xcode 12.5.1\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eサンプル\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etestA\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etestB\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"c1\"\u003e// nilを返却してもコンパイルエラーにはならない\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ehogeA\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003etestA\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 変数宣言時に!をつけなくてもコンパイルは通る\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ehogeB\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003etestB\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 変数宣言時に!をつけなくてもコンパイルは通るが、実行時にエラーになる\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eなので、そもそも強制アンラップを返す関数は使うのはやめたほうがいいです。\u003c/p\u003e\n","body":"\n# 強制アンラップを返す関数の注意点\n\n強制アンラップを返す関数で `nil` を返すような処理を書くとコンパイルエラーにはならずに実行時エラーになります。\n\n環境：Xcode 12.5.1\n\n```swift:サンプル\nfunc testA() -\u003e Int! {\n    return 0\n}\n\nfunc testB() -\u003e Int! {\n    return nil // nilを返却してもコンパイルエラーにはならない\n}\n\nlet hogeA: Int = testA() // 変数宣言時に!をつけなくてもコンパイルは通る\nlet hogeB: Int = testB() // 変数宣言時に!をつけなくてもコンパイルは通るが、実行時にエラーになる\n```\n\nなので、そもそも強制アンラップを返す関数は使うのはやめたほうがいいです。\n","coediting":false,"comments_count":0,"created_at":"2021-09-26T02:18:30+09:00","group":null,"id":"97e440bfb2bad78ebc7d","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Swift","versions":[]}],"title":"【Swift】強制アンラップを返す関数の注意点","updated_at":"2021-09-26T09:55:28+09:00","url":"https://qiita.com/ikuraikura/items/97e440bfb2bad78ebc7d","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eProtocol を拡張するにあたって \u003ccode\u003eextension\u003c/code\u003e であったり、 \u003ccode\u003ewhere\u003c/code\u003e の絞りこみがよくわかっていなかったので整理してみました。\u003cbr\u003e\n（Xcode:12.5.1）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"基本的な使い方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e基本的な使い方\u003c/h1\u003e\n\n\u003cp\u003e例：Protocol で鳥が　「息をすること」 = \u003ccode\u003ebreathe()\u003c/code\u003e と「飛ぶこと」 = \u003ccode\u003efly()\u003c/code\u003e を表現します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eprotocol\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003ebreathe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efly\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"kt\"\u003eCrow\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003ebreathe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efly\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003ePlayground で BirdProtocol を継承した Class を宣言すると勝手に上のように関数の定義をサポートしてくれます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"拡張方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8B%A1%E5%BC%B5%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e拡張方法\u003c/h1\u003e\n\n\u003cp\u003e例：カモのように泳げる鳥もいるので、「泳げること」 = \u003ccode\u003eswim()\u003c/code\u003e も追加してあげます。\u003c/p\u003e\n\n\u003cp\u003eこの場合に拡張する方法を 3 つ紹介したいと思います。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e拡張方法その1\n\n\u003cul\u003e\n\u003cli\u003e複数の Protocol を継承させる ← \u003cstrong\u003eおすすめ\u003c/strong\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e拡張方法その2\n\n\u003cul\u003e\n\u003cli\u003e既存の Protocol を継承した Protocol を継承させる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e拡張方法その3\n\n\u003cul\u003e\n\u003cli\u003e既存の Protocol を extension する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"拡張方法その1-複数の-protocol-を継承させる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8B%A1%E5%BC%B5%E6%96%B9%E6%B3%95%E3%81%9D%E3%81%AE1-%E8%A4%87%E6%95%B0%E3%81%AE-protocol-%E3%82%92%E7%B6%99%E6%89%BF%E3%81%95%E3%81%9B%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e拡張方法その1: 複数の Protocol を継承させる\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"protocol-の定義\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#protocol-%E3%81%AE%E5%AE%9A%E7%BE%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eProtocol の定義\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eprotocol\u003c/span\u003e \u003cspan class=\"kt\"\u003eSwimAble\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eswim\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"class-の定義\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#class-%E3%81%AE%E5%AE%9A%E7%BE%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eClass の定義\u003c/h3\u003e\n\n\u003cp\u003eClass の定義の際に複数の Protocol を継承させることが可能です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"kt\"\u003eKamoA\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eSwimAble\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003ebreathe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efly\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eswim\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e下記のように extension で分けて表現するとこともできます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"kt\"\u003eKamoA\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003ebreathe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efly\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"kt\"\u003eKamoA\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eSwimAble\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eswim\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"実行してみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行してみる\u003c/h3\u003e\n\n\u003cp\u003e実際に \u003ccode\u003eswim()\u003c/code\u003e を実行する際には、以下のように Classを格納する変数の型の表現を気を付けてあげる必要があります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 例1\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ebirdA1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eKamoA\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 型指定なし\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebirdA1\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eswim\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 勝手にSwimAbleを適応してくれる\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 例2\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ebirdA2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eKamoA\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// BirdProtocolの型指定する\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// birdA2.swim() // BirdProtocolにはswim()がないのでコンパイルエラーとなる!!\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 例3\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ebirdA3\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"kt\"\u003eSwimAble\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eKamoA\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 複数のProtocolを指定する場合はこう書く\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebirdA3\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eswim\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// これならswim()できる\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"使い所\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%84%E6%89%80\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使い所\u003c/h3\u003e\n\n\u003cp\u003e一番一般的な拡張のさせ方の認識です。\u003cbr\u003e\n迷ったらこれでいいと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"拡張方法その2-既存の-protocol-を継承した-protocol-を継承させる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8B%A1%E5%BC%B5%E6%96%B9%E6%B3%95%E3%81%9D%E3%81%AE2-%E6%97%A2%E5%AD%98%E3%81%AE-protocol-%E3%82%92%E7%B6%99%E6%89%BF%E3%81%97%E3%81%9F-protocol-%E3%82%92%E7%B6%99%E6%89%BF%E3%81%95%E3%81%9B%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e拡張方法その2: 既存の Protocol を継承した Protocol を継承させる\u003c/h2\u003e\n\n\u003cp\u003e既存の Protocol を継承した Protocol を作成します。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"protocol-の定義-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#protocol-%E3%81%AE%E5%AE%9A%E7%BE%A9-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eProtocol の定義\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eprotocol\u003c/span\u003e \u003cspan class=\"kt\"\u003eSwimAbleBird\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eswim\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eちなみに、以下のように書くこともできます。\u003cbr\u003e\nただし、Protocol の宣言では \u003ccode\u003ewhere\u003c/code\u003e を使わず、extension 時に拡張したい範囲を絞るために \u003ccode\u003ewhere\u003c/code\u003e を用いる認識です。 \u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// こうはあまり書かないはず？\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eprotocol\u003c/span\u003e \u003cspan class=\"kt\"\u003eSwimAbleBird\u003c/span\u003e \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"k\"\u003eSelf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eswim\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"class-の定義-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#class-%E3%81%AE%E5%AE%9A%E7%BE%A9-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eClass の定義\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003eSwimAbleBird\u003c/code\u003e を継承させるだけで、\u003ccode\u003eBirdProtocol\u003c/code\u003e の機能も保証してくれます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"kt\"\u003eKamoB\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eSwimAbleBird\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003ebreathe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efly\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eswim\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"実行してみる-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行してみる\u003c/h3\u003e\n\n\u003cp\u003e複数 Protocol を 継承した場合に比べて、型宣言するときに \u003ccode\u003eBirdProtocol \u0026amp; SwimAble\u003c/code\u003e のように表現しなくても、\u003ccode\u003eSwimAbleBird\u003c/code\u003e だけでシンプルに \u003ccode\u003eswim()\u003c/code\u003e を実行することができます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 例1\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ebirdB1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eKamoB\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebirdB1\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eswim\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 例2\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ebirdB2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eSwimAbleBird\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eKamoB\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// SwimAbleBirdの型を指定する\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebirdB2\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eswim\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// SwimAbleBirdにはswim()がある\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"使い所-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%84%E6%89%80-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使い所\u003c/h3\u003e\n\n\u003cp\u003eあきらかに特性が異なる Protocol を追加する場合に使う認識です。\u003cbr\u003e\nなので、今回のような泳げる機能を追加するだけではケースでは使わない認識です。\u003c/p\u003e\n\n\u003cp\u003e例えば、今は鳥だけを扱っていますが、哺乳類などを扱う種類が増えていくと、どんどん Protocol を増やしていくことになってしまったりして、困ります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"拡張方法その3-既存の-protocol-を-extension-する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8B%A1%E5%BC%B5%E6%96%B9%E6%B3%95%E3%81%9D%E3%81%AE3-%E6%97%A2%E5%AD%98%E3%81%AE-protocol-%E3%82%92-extension-%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e拡張方法その3: 既存の Protocol を extension する\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"protocol-の定義-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#protocol-%E3%81%AE%E5%AE%9A%E7%BE%A9-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eProtocol の定義\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eprotocol\u003c/span\u003e \u003cspan class=\"kt\"\u003eSwimAble\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"k\"\u003eSelf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eSwimAble\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// Protocol を extension する場合は {} の中身まで書かなければならない\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eswim\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003efatalError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"override required\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"class-の定義-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#class-%E3%81%AE%E5%AE%9A%E7%BE%A9-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eClass の定義\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"kt\"\u003eKamoC\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eSwimAble\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003ebreathe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efly\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eswim\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"swim\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// overrideする\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"実行してみる-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行してみる\u003c/h3\u003e\n\n\u003cp\u003e型指定しない場合のみしか、\u003ccode\u003eKamoC\u003c/code\u003e での override した \u003ccode\u003eswim（）\u003c/code\u003e しか使えず、\u003ccode\u003eBirdProtocol \u0026amp; SwimAble\u003c/code\u003e と型指定した場合は \u003ccode\u003eKamoC\u003c/code\u003e での override した \u003ccode\u003eswim（）\u003c/code\u003e は無視されるという謎の挙動になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// 例1\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ebirdC1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eKamoC\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebirdC1\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eswim\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \"swim\"\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 例2\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ebirdC2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eKamoC\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// birdC2.swim() // コンパイルエラー\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 例3\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ebirdC3\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"kt\"\u003eSwimAble\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eKamoC\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebirdC3\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eswim\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 実行時エラー （ Fatal error: override required ） ← overrideできていない理由は不明\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e共通で \u003ccode\u003eswim（）\u003c/code\u003e 処理を使うのであれば \u003ccode\u003eextension BirdProtocol where Self: SwimAble\u003c/code\u003e 時に実態の \u003ccode\u003eswim（）\u003c/code\u003e 処理を書けば問題ないが、Class 側で個別に実装したい時は、このように思わぬ事故が発生しそう。。。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"使い所-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E3%81%84%E6%89%80-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使い所\u003c/h3\u003e\n\n\u003cp\u003e個別の Class では実装させないような場合に用いるイメージです。（以下の機能制限のような例。）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"応用-機能制限\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%9C%E7%94%A8-%E6%A9%9F%E8%83%BD%E5%88%B6%E9%99%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【応用】 機能制限\u003c/h1\u003e\n\n\u003cp\u003e例：ダチョウやペンギンのように飛べない鳥がいるので、それを \u003ccode\u003eBirdProtocol\u003c/code\u003e を extension させて表現します。\u003c/p\u003e\n\n\u003cp\u003eポイントは \u003ccode\u003ewhere Self: FlyUnable\u003c/code\u003e とすることで、他の \u003ccode\u003eBirdProtocol\u003c/code\u003e を継承した Class には影響させないというところです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eprotocol\u003c/span\u003e \u003cspan class=\"kt\"\u003eFlyUnable\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"k\"\u003eSelf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eFlyUnable\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efly\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003efatalError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Can't fly.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"kt\"\u003eDachoA\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eFlyUnable\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003ebreathe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ebirdA\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eDachoA\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebirdA\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ebreathe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebirdA\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efly\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 実行時エラーが起こる\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e下記のように \u003ccode\u003eBirdProtocol\u003c/code\u003e を継承させた \u003ccode\u003eFlyUnableBird\u003c/code\u003e を定義することでも表現可能です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eprotocol\u003c/span\u003e \u003cspan class=\"kt\"\u003eFlyUnableBird\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"kt\"\u003eBirdProtocol\u003c/span\u003e \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"k\"\u003eSelf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eFlyUnableBird\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efly\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003efatalError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Can't fly.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"kt\"\u003eDachoB\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eFlyUnableBird\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003ebreathe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ebirdB\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eDachoB\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebirdB\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ebreathe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebirdB\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efly\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 実行時エラーが起こる\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h1\u003e\n\n\u003cp\u003eなるべく細かく Protocol で機能を分割していくのが Swift っぽいのかもしれません。\u003c/p\u003e\n","body":"\n# はじめに\n\nProtocol を拡張するにあたって `extension` であったり、 `where` の絞りこみがよくわかっていなかったので整理してみました。\n（Xcode:12.5.1）\n\n# 基本的な使い方\n\n例：Protocol で鳥が　「息をすること」 = `breathe()` と「飛ぶこと」 = `fly()` を表現します。\n\n```swift\nprotocol BirdProtocol {\n    func breathe()\n    func fly()\n}\n```\n\n```swift\nclass Crow: BirdProtocol {\n    func breathe() {}\n\n    func fly() {}\n}\n```\n\nPlayground で BirdProtocol を継承した Class を宣言すると勝手に上のように関数の定義をサポートしてくれます。\n\n# 拡張方法\n\n例：カモのように泳げる鳥もいるので、「泳げること」 = `swim()` も追加してあげます。\n\nこの場合に拡張する方法を 3 つ紹介したいと思います。\n\n- 拡張方法その1\n    - 複数の Protocol を継承させる ← **おすすめ**\n- 拡張方法その2\n    - 既存の Protocol を継承した Protocol を継承させる\n- 拡張方法その3\n    - 既存の Protocol を extension する\n\n## 拡張方法その1: 複数の Protocol を継承させる\n\n### Protocol の定義\n\n```swift\nprotocol SwimAble {\n    func swim()\n}\n```\n\n### Class の定義\n\nClass の定義の際に複数の Protocol を継承させることが可能です。\n\n```swift\nclass KamoA: BirdProtocol, SwimAble {\n    func breathe() {}\n\n    func fly() {}\n\n    func swim() {}\n}\n```\n\n下記のように extension で分けて表現するとこともできます。\n\n```swift\nclass KamoA: BirdProtocol {\n    func breathe() {}\n    \n    func fly() {}\n}\n\nextension KamoA: SwimAble {\n    func swim() {}\n}\n```\n\n### 実行してみる\n\n実際に `swim()` を実行する際には、以下のように Classを格納する変数の型の表現を気を付けてあげる必要があります。\n\n```swift\n// 例1\nlet birdA1 = KamoA() // 型指定なし\nbirdA1.swim() // 勝手にSwimAbleを適応してくれる\n\n// 例2\nlet birdA2: BirdProtocol = KamoA() // BirdProtocolの型指定する\n// birdA2.swim() // BirdProtocolにはswim()がないのでコンパイルエラーとなる!!\n\n// 例3\nlet birdA3: BirdProtocol \u0026 SwimAble = KamoA() // 複数のProtocolを指定する場合はこう書く\nbirdA3.swim() // これならswim()できる\n```\n\n### 使い所\n\n一番一般的な拡張のさせ方の認識です。\n迷ったらこれでいいと思います。\n\n## 拡張方法その2: 既存の Protocol を継承した Protocol を継承させる\n\n既存の Protocol を継承した Protocol を作成します。\n\n### Protocol の定義\n\n```swift\nprotocol SwimAbleBird: BirdProtocol {\n    func swim()\n}\n```\n\nちなみに、以下のように書くこともできます。\nただし、Protocol の宣言では `where` を使わず、extension 時に拡張したい範囲を絞るために `where` を用いる認識です。 \n\n```swift\n// こうはあまり書かないはず？\nprotocol SwimAbleBird where Self: BirdProtocol {\n    func swim()\n}\n```\n\n### Class の定義\n\n`SwimAbleBird` を継承させるだけで、`BirdProtocol` の機能も保証してくれます。\n\n```swift\nclass KamoB: SwimAbleBird {\n    func breathe() {}\n\n    func fly() {}\n\n    func swim() {}\n}\n```\n\n### 実行してみる\n\n複数 Protocol を 継承した場合に比べて、型宣言するときに `BirdProtocol \u0026 SwimAble` のように表現しなくても、`SwimAbleBird` だけでシンプルに `swim()` を実行することができます。\n\n```swift\n// 例1\nlet birdB1 = KamoB()\nbirdB1.swim()\n\n// 例2\nlet birdB2: SwimAbleBird = KamoB() // SwimAbleBirdの型を指定する\nbirdB2.swim() // SwimAbleBirdにはswim()がある\n```\n\n### 使い所\n\nあきらかに特性が異なる Protocol を追加する場合に使う認識です。\nなので、今回のような泳げる機能を追加するだけではケースでは使わない認識です。\n\n例えば、今は鳥だけを扱っていますが、哺乳類などを扱う種類が増えていくと、どんどん Protocol を増やしていくことになってしまったりして、困ります。\n\n## 拡張方法その3: 既存の Protocol を extension する\n\n### Protocol の定義\n\n```swift\nprotocol SwimAble {}\n\nextension BirdProtocol where Self: SwimAble {\n    // Protocol を extension する場合は {} の中身まで書かなければならない\n    func swim() {\n        fatalError(\"override required\")\n    }\n}\n```\n\n### Class の定義\n\n```swift\nclass KamoC: BirdProtocol, SwimAble {\n    func breathe() {}\n    \n    func fly() {}\n    \n    func swim() {\n        print(\"swim\") // overrideする\n    }\n}\n```\n\n### 実行してみる\n\n型指定しない場合のみしか、`KamoC` での override した `swim（）` しか使えず、`BirdProtocol \u0026 SwimAble` と型指定した場合は `KamoC` での override した `swim（）` は無視されるという謎の挙動になります。\n\n```swift\n// 例1\nlet birdC1 = KamoC()\nbirdC1.swim() // \"swim\"\n\n// 例2\nlet birdC2: BirdProtocol = KamoC()\n// birdC2.swim() // コンパイルエラー\n\n// 例3\nlet birdC3: BirdProtocol \u0026 SwimAble = KamoC()\nbirdC3.swim() // 実行時エラー （ Fatal error: override required ） ← overrideできていない理由は不明\n```\n\n共通で `swim（）` 処理を使うのであれば `extension BirdProtocol where Self: SwimAble` 時に実態の `swim（）` 処理を書けば問題ないが、Class 側で個別に実装したい時は、このように思わぬ事故が発生しそう。。。\n\n### 使い所\n\n個別の Class では実装させないような場合に用いるイメージです。（以下の機能制限のような例。）\n\n# 【応用】 機能制限\n\n例：ダチョウやペンギンのように飛べない鳥がいるので、それを `BirdProtocol` を extension させて表現します。\n\nポイントは `where Self: FlyUnable` とすることで、他の `BirdProtocol` を継承した Class には影響させないというところです。\n\n```swift\nprotocol FlyUnable {}\n\nextension BirdProtocol where Self: FlyUnable {\n    func fly() {\n        fatalError(\"Can't fly.\")\n    }\n}\n\nclass DachoA: BirdProtocol, FlyUnable {\n    func breathe() {}\n}\n\nlet birdA = DachoA()\nbirdA.breathe()\nbirdA.fly() // 実行時エラーが起こる\n```\n\n下記のように `BirdProtocol` を継承させた `FlyUnableBird` を定義することでも表現可能です。\n\n```swift\nprotocol FlyUnableBird: BirdProtocol {}\n\nextension BirdProtocol where Self: FlyUnableBird {\n    func fly() {\n        fatalError(\"Can't fly.\")\n    }\n}\n\nclass DachoB: FlyUnableBird {\n    func breathe() {}\n}\n\nlet birdB = DachoB()\nbirdB.breathe()\nbirdB.fly() // 実行時エラーが起こる\n```\n\n# 最後に\n\nなるべく細かく Protocol で機能を分割していくのが Swift っぽいのかもしれません。\n","coediting":false,"comments_count":0,"created_at":"2021-09-25T23:47:44+09:00","group":null,"id":"880e49a1a290a8d3345c","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Swift","versions":[]}],"title":"【Swift】Protocol の拡張について","updated_at":"2021-09-26T08:46:25+09:00","url":"https://qiita.com/ikuraikura/items/880e49a1a290a8d3345c","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"やりたいこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやりたいこと\u003c/h1\u003e\n\n\u003cp\u003e初期値が nil の CurrentValueSubject について nil 以外の値がくるまでのタイムアウトを設定すること。\u003cbr\u003e\n環境：Xcode 12.5.1\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"結論\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E8%AB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結論\u003c/h1\u003e\n\n\u003cp\u003e初期値が nil の CurrentValueSubject について nil 以外の値がくるまでのタイムアウトを設定するには、以下の順で処理してあげるとうまくいきます。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003ecompactMap()\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003efirst()\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003etimeout()\u003c/code\u003e \u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eサンプル\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"kt\"\u003eCombine\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"kt\"\u003eFoundation\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eenum\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eError\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eminusError\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003enilError\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003etimeoutError\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eotherError\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ecancellables\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eSet\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eAnyCancellable\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectL\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompactMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← nilを排除\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← nil 以外の値がくれば completion が呼ばれる\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← timeout の Failure を設定してあげる\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eseconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 今回は3秒で設定\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003escheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003ecustomError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimeoutError\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eFail\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eminusError\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eJust\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nf\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 即時実行\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003easyncAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edeadline\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mf\"\u003e2.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← その2秒後に実行\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003easyncAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edeadline\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mf\"\u003e4.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← その4秒後に実行\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 10\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// finished ← first()のおかげで 4 秒待つことはなく timeoutError にならない\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eもちろん、3 秒以内に nil 以外の値がこなければタイムアウトします↓\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 即時実行\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003easyncAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edeadline\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mf\"\u003e4.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 4秒待たせる\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← その4秒後に実行\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003easyncAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edeadline\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mf\"\u003e4.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← その4秒後に実行\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// error: timeoutError\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e以上です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"上記のサンプル処理がよくわからない人へ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%8A%E8%A8%98%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E5%87%A6%E7%90%86%E3%81%8C%E3%82%88%E3%81%8F%E3%82%8F%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84%E4%BA%BA%E3%81%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e上記のサンプル処理がよくわからない人へ↓\u003c/h1\u003e\n\n\u003cp\u003e以降はサンプル処理の解説でないですが、Combine の挙動のポイントを書き記したものになります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"前提処理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E6%8F%90%E5%87%A6%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前提処理\u003c/h2\u003e\n\n\u003cp\u003e以下の定義はすべてに共通します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"kt\"\u003eCombine\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"kt\"\u003eFoundation\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eenum\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eError\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eminusError\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003enilError\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003etimeoutError\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eotherError\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ecancellables\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eSet\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eAnyCancellable\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eTestError\u003c/code\u003e という適当なエラーを用意\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003etwice(num: Int)\u003c/code\u003e という数値を 2 倍する適当な関数を用意\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ecancellables\u003c/code\u003e という適当な \u003ccode\u003eAnyCancellable\u003c/code\u003e を \u003ccode\u003e.store(in: \u0026amp;cancellables)\u003c/code\u003e できる変数を用意\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"お断り\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E6%96%AD%E3%82%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eお断り\u003c/h2\u003e\n\n\u003cp\u003e所々で \u003ccode\u003enil\u003c/code\u003e を返却しない処理で、\u003ccode\u003ecompactMap()\u003c/code\u003e を使用してしまっておりますが、誤った使い方です。\u003cbr\u003e\nそういう場合は \u003ccode\u003emap()\u003c/code\u003e を使いましょう。\u003c/p\u003e\n\n\u003cp\u003eまた、\u003ccode\u003emap()\u003c/code\u003e で \u003ccode\u003eAnyPublisher\u0026lt;Output, Failure\u0026gt;\u003c/code\u003e を返すような場合は、\u003ccode\u003emap()\u003c/code\u003e ではなく \u003ccode\u003eflatMap()\u003c/code\u003e としてあげた方が良いです。\u003c/p\u003e\n\n\u003cp\u003e申し訳ございません🙇‍♂️\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"currentvaluesubject-の初期化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#currentvaluesubject-%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eCurrentValueSubject\u003c/code\u003e の初期化\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e失敗例\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectA\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// CurrentValueSubject\u0026lt;Output, Failure\u0026gt; は初期化が必要\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubject\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← いきなり代入するとエラーになる\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e成功例\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectA\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esubjectA\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// nilで初期化\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectA\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 初期化後ならエラーにならない\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eCurrentValueSubject\u0026lt;Output, Failure\u0026gt;\u003c/code\u003e は初期化が必要\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"sink-の挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sink-%E3%81%AE%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003esink\u003c/code\u003e の挙動\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectB\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectB\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edescribing\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力↓\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: nil ← いきなりnilでながれる\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003esink\u003c/code\u003e するといきなり処理が流れる → 初期値が流れる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"dropfirst-の挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dropfirst-%E3%81%AE%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003edropFirst\u003c/code\u003e の挙動\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectC\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edropFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 追加\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edescribing\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力↓\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// なし ← .dropFirst()のおかげで初回（初期値）のストリームはながれない\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003edropFirst\u003c/code\u003e で初回（初期値）のストリームを流れるのを防ぐ\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"send-の挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#send-%E3%81%AE%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003esend\u003c/code\u003e の挙動\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectC\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edropFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edescribing\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// sendまたはvalueの代入によってストリームが走る\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力↓\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: Optional(1)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: nil\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: Optional(2)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: Optional(3)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003esend\u003c/code\u003e または \u003ccode\u003evalue\u003c/code\u003e の代入によってストリームが走る\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"cancel-の挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cancel-%E3%81%AE%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003ecancel\u003c/code\u003e の挙動\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectC\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edropFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edescribing\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// cancel の処理の挙動\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eforEach\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ecancel\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// cancel()の実施\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// cancel()以降処理しなくなる\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"c1\"\u003e// cancel()以降処理しなくなる\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力↓\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: Optional(1)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: nil\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ecancel\u003c/code\u003e 以降のストリームは流れない\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"completion-finished-の挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#completion-finished-%E3%81%AE%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003ecompletion: .finished\u003c/code\u003e の挙動\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectC\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edropFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edescribing\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ecompletion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// completion\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// sinkのcompletionの処理に入ったためsinkは走らない\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// sinkのcompletionの処理に入ったためsinkは走らない\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectC\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"c1\"\u003e// sinkのcompletionの処理に入ったためsinkは走らない\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力↓\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: Optional(1)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// finished\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ecompletion\u003c/code\u003e の処理に入るとストリームに値は走らなくなる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"map-の挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#map-%E3%81%AE%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003emap\u003c/code\u003e の挙動\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectD\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectD\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edropFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nf\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e??\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 追加\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edescribing\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esubjectD\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectD\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectD\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 2 ← map の処理が適応\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 0 ← nilは $0 ?? 0 によって0に変換されて処理された\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 4 ← map の処理が適応\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e配列操作の \u003ccode\u003emap\u003c/code\u003e とほぼ同じように処理される\u003c/li\u003e\n\u003cli\u003e関数を通して値を変換させるのに相性が良い\u003c/li\u003e\n\u003cli\u003e場合に応じて型も変えることができる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"compactmap-の挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#compactmap-%E3%81%AE%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003ecompactMap\u003c/code\u003e の挙動\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectE\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectE\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edropFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompactMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 追加\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nf\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e)}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 先にcompactMap()することによってアンラップ処理を省略\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edescribing\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esubjectE\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectE\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← compactMapによりnilは出力なし\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectE\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 2 ← オプショナルが外れる\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 4 ← オプショナルが外れる\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ecompactMap()\u003c/code\u003e は nil の際に処理を流れなくする\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ecompactMap { $0 }\u003c/code\u003e は Combine ならではの \u003ccode\u003eguard let hoge = hoge else { return }\u003c/code\u003e のようなイメージ\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ccode\u003ecompactMap { $0 }\u003c/code\u003e は書き換えると以下のようになる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectF\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectF\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edropFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompactMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← compactMap { $0 } と同等の処理\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nf\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edescribing\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"failjusterasetoanypublishersetfailuretypeflatmap-の合わせ技\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#failjusterasetoanypublishersetfailuretypeflatmap-%E3%81%AE%E5%90%88%E3%82%8F%E3%81%9B%E6%8A%80\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eFail\u003c/code\u003e、\u003ccode\u003eJust\u003c/code\u003e、\u003ccode\u003eeraseToAnyPublisher\u003c/code\u003e、\u003ccode\u003esetFailureType\u003c/code\u003e、\u003ccode\u003eflatMap\u003c/code\u003e の合わせ技\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectG\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectG\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edropFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 型を指定\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eFail\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enilError\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Fail(error: Error)を返す\u003c/span\u003e\n                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eJust\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// AnyPublisher\u0026lt;Int, TestError\u0026gt; にあわせる\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nf\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esubjectG\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectG\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ←  nil のため、Fail(error: TestError.nilError) 発生\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectG\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 上の処理により sink の completion ブロックに入ったため処理が走らない\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// error: nilError\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eFail\u003c/code\u003e はエラーを返す Publisher（\u003ccode\u003estruct Fail\u0026lt;Output, Failure\u0026gt; : Publisher where Failure : Error\u003c/code\u003e）\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eJust\u003c/code\u003e はエラーを返さない Publisher（\u003ccode\u003estruct Just\u0026lt;Output\u0026gt; : Publisher\u003c/code\u003e）\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003e.setFailureType(to: Error.self)\u003c/code\u003e によって、Publisher に任意のエラーを付与できる ← これをつかって \u003ccode\u003eJust\u003c/code\u003e にエラーを付与することも可能\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eAnyPublisher\u0026lt;Output, Error\u0026gt;\u003c/code\u003e のような publisher を返す場合は \u003ccode\u003e.eraseToAnyPublisher()\u003c/code\u003e をつけてあげると型が揃う\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eflatMap()\u003c/code\u003e は \u003ccode\u003eAnyPublisher\u0026lt;Output, Failure\u0026gt;\u003c/code\u003e を流すストリームを作成する　（ここを \u003ccode\u003emap()\u003c/code\u003e にすると \u003ccode\u003eAnyPublisher\u0026lt;Output, Failure\u0026gt;\u003c/code\u003e の型であってもストリームは流れない）\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eFail\u003c/code\u003e を検知すると \u003ccode\u003esink\u003c/code\u003e の \u003ccode\u003ecompletion\u003c/code\u003e ブロックに入りそれ以降のストリームに流れてきた値は処理しない\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"errormap-の挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#errormap-%E3%81%AE%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eerrorMap\u003c/code\u003e の挙動\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectH\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectH\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edropFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompactMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 型を指定\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eFail\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enilError\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// Fail(error: Error)を返す\u003c/span\u003e\n                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eJust\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// AnyPublisher\u0026lt;Int, TestError\u0026gt; にあわせる\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// AnyPublisher\u0026lt;Int, TestError\u0026gt; を Int と TestError に分ける\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nf\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emapError\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eerror\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"before error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eotherError\u003c/span\u003e \u003cspan class=\"c1\"\u003e// すべてTestError.otherErrorに変換する\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esubjectH\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectH\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ←  nil のため、Fail(error: TestError.nilError) 発生\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectH\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 上の処理により sink の completion ブロックに入ったため処理が走らない\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// before error: nilError\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// error: otherError // ← nilError だったエラーが otherError に変更されている\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003emap\u003c/code\u003e は \u003ccode\u003eOutput\u003c/code\u003e に対してのみ処理をしないし、\u003ccode\u003eerrorMap\u003c/code\u003e は \u003ccode\u003eFailure\u003c/code\u003e にのみ処理を適応する\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"first-の挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#first-%E3%81%AE%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003efirst\u003c/code\u003e の挙動\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectI\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectI\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edropFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 追加\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompactMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eFail\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enilError\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eJust\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nf\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emapError\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eerror\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"before error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eotherError\u003c/span\u003e \u003cspan class=\"c1\"\u003e// すべてTestError.otherErrorに変換する\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esubjectI\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← first()によって1つの処理が終了したらsinkのcompletionブロックに入る\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectI\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← すでにsinkのcompletionブロックに入っているため処理が走らない\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectI\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← すでにsinkのcompletionブロックに入っているため処理が走らない\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003efirst()\u003c/code\u003e はひとつのストリームを受け取ったら \u003ccode\u003ecompletion\u003c/code\u003e となる\u003c/li\u003e\n\u003cli\u003eひとつめで \u003ccode\u003ecompletion\u003c/code\u003e するのではなく、N 回目で \u003ccode\u003ecompletion\u003c/code\u003e するかをコントロールするには \u003ccode\u003eprefix()\u003c/code\u003e を用いる↓\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"補足-prefix-の挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A3%9C%E8%B6%B3-prefix-%E3%81%AE%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【補足】 \u003ccode\u003eprefix\u003c/code\u003e の挙動\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectI\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectI\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edropFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eprefix\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 追加\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompactMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eFail\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enilError\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eJust\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nf\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emapError\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eerror\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"before error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eotherError\u003c/span\u003e \u003cspan class=\"c1\"\u003e// すべてTestError.otherErrorに変換する\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esubjectI\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 1つめ\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectI\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 2つめ ← prefix(2)によりこの時点でcompletionする\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectI\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 3つめ ← completionブロックに入ったため処理されない\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 4\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// finished\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eprefix()\u003c/code\u003e で、値が来てから N 回目で \u003ccode\u003ecompletion\u003c/code\u003e するかをコントロールできる\u003c/li\u003e\n\u003cli\u003eつまり、\u003ccode\u003efirst()\u003c/code\u003e と \u003ccode\u003eprefix(1)\u003c/code\u003e は同じ挙動（のはず）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"timeout-の挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#timeout-%E3%81%AE%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003etimeout\u003c/code\u003e の挙動\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"基本形\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9F%BA%E6%9C%AC%E5%BD%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e基本形\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectJ\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectJ\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edropFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompactMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eFail\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enilError\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eJust\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nf\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 追加\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eseconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003escheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003ecustomError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimeoutError\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esubjectJ\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 即時実行\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003easyncAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edeadline\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mf\"\u003e2.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esubjectJ\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← send(5)の2秒後に実行\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003easyncAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edeadline\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mf\"\u003e4.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esubjectJ\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← send(6)の4秒後に実行 ← timeoutが3秒のため実行されない\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 10\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 12 // ← subjectJ.send(5)実行から2秒後\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// error: timeoutError // ← subjectJ.send(6)実行から3秒後\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003etimeout()\u003c/code\u003e で設定する期間は、値を最初に受け始めてから \u003ccode\u003ecompletion\u003c/code\u003e するまでの時間ではなく、ストリームが流れていない期間を指定したこととなる\u003c/li\u003e\n\u003cli\u003e一度タイムアウトすると \u003ccode\u003ecompletion\u003c/code\u003e 処理が実行されるため、ストリームは走らなくなる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"わざとタイムアウトさせる方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%8F%E3%81%96%E3%81%A8%E3%82%BF%E3%82%A4%E3%83%A0%E3%82%A2%E3%82%A6%E3%83%88%E3%81%95%E3%81%9B%E3%82%8B%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eわざとタイムアウトさせる方法\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectK\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectK\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompactMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← わざと全てnilに変換する\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompactMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eFail\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eminusError\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eJust\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nf\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eseconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003escheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003ecustomError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimeoutError\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esubjectK\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// error: timeoutError\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003e.compactMap { _ -\u0026gt; Int? in return nil }\u003c/code\u003e で、わざと全て \u003ccode\u003enil\u003c/code\u003e に変換する処理を \u003ccode\u003ecompactMap()\u003c/code\u003e 内で行うと、ストリームが流れないので timeout する\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"タイトル回収\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E5%9B%9E%E5%8F%8E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eタイトル回収\u003c/h2\u003e\n\n\u003cp\u003e初期値が nil の CurrentValueSubject について nil 以外の値がくるまでのタイムアウトを設定する\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"うまくいく例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%86%E3%81%BE%E3%81%8F%E3%81%84%E3%81%8F%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eうまくいく例\u003c/h3\u003e\n\n\u003cp\u003e初期値が nil の CurrentValueSubject があるとき、nil 以外の最初の一つ目の値がくるまでタイムアウトを設定するには、以下の順で処理してあげるとうまくいく。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003ecompactMap()\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003efirst()\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003etimeout()\u003c/code\u003e \u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectL\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompactMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← nilを排除\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← nil 以外の値がくれば completion が呼ばれる\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← timeout の Failure を設定してあげる\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eseconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003escheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003ecustomError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimeoutError\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompactMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eFail\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eminusError\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eJust\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nf\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 即時実行\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003easyncAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edeadline\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mf\"\u003e2.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← その2秒後に実行\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003easyncAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edeadline\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mf\"\u003e4.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← その4秒後に実行\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 10\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// finished ← first()のおかげで 4 秒待つことはなく timeoutError にならない\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"うまくいかない例1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%86%E3%81%BE%E3%81%8F%E3%81%84%E3%81%8B%E3%81%AA%E3%81%84%E4%BE%8B1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eうまくいかない例1\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003efirst()\u003c/code\u003e を抜いてみた場合↓\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectL\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompactMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← nilを排除\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//    .first() // ← nil 以外の値がくれば completion が呼ばれる\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← timeout の Failure を設定してあげる\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eseconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003escheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003ecustomError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimeoutError\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompactMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eFail\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eminusError\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eJust\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nf\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 即時実行\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003easyncAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edeadline\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mf\"\u003e2.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← その2秒後に実行\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003easyncAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edeadline\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mf\"\u003e4.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← その4秒後に実行\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 10\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// receiveValue: 12\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// error: timeoutError\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003efirst()\u003c/code\u003e がないため、明確にストリームを止めない限り \u003ccode\u003ecompletion\u003c/code\u003e のブロックには行かないためタイムアウトエラーとなる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"うまくいかない例2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%86%E3%81%BE%E3%81%8F%E3%81%84%E3%81%8B%E3%81%AA%E3%81%84%E4%BE%8B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eうまくいかない例2\u003c/h3\u003e\n\n\u003cp\u003e\u003ccode\u003efirst()\u003c/code\u003e のあとに \u003ccode\u003ecompactMap()\u003c/code\u003e した場合↓\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esubjectL\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eCurrentValueSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"kt\"\u003eNever\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edropFirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 値がくれば completion が呼ばれる\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompactMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← nilを排除\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← timeout の Failure を設定してあげる\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eseconds\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003escheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003ecustomError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimeoutError\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecompactMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAnyPublisher\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eFail\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eminusError\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eJust\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetFailureType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeraseToAnyPublisher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nf\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esink\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003efinished\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"finished\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003efailure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nv\"\u003ereceiveValue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"receiveValue: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ein\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ecancellables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 即時実行\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003easyncAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edeadline\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mf\"\u003e2.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← その2秒後に実行\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003easyncAfter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edeadline\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mf\"\u003e4.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esubjectL\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← その4秒後に実行\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// finished\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003esubjectL.send(nil)\u003c/code\u003e で nil が来て、\u003ccode\u003efirst()\u003c/code\u003e を通過するので、その時点で \u003ccode\u003ecompletion\u003c/code\u003e することが確定し、\u003ccode\u003ecompactMap { $0 }\u003c/code\u003e で nil が排除されてすぐに \u003ccode\u003ecompletion\u003c/code\u003e のブロックに入る\u003c/li\u003e\n\u003c/ul\u003e\n","body":"\n# やりたいこと\n\n初期値が nil の CurrentValueSubject について nil 以外の値がくるまでのタイムアウトを設定すること。\n環境：Xcode 12.5.1\n\n# 結論\n\n初期値が nil の CurrentValueSubject について nil 以外の値がくるまでのタイムアウトを設定するには、以下の順で処理してあげるとうまくいきます。\n\n1. `compactMap()`\n2. `first()`\n3. `timeout()` \n\n```swift:サンプル\nimport Combine\nimport Foundation\n\nenum TestError: Error {\n    case minusError\n    case nilError\n    case timeoutError\n    case otherError\n}\n\nfunc twice(num: Int) -\u003e Int {\n    return num * 2\n}\n\nvar cancellables = Set\u003cAnyCancellable\u003e()\n\nvar subjectL = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectL\n    .compactMap { $0 } // ← nilを排除\n    .first() // ← nil 以外の値がくれば completion が呼ばれる\n    .setFailureType(to: TestError.self) // ← timeout の Failure を設定してあげる\n    .timeout(\n        .seconds(3), // 今回は3秒で設定\n        scheduler: DispatchQueue.main,\n        options: nil,\n        customError: { .timeoutError }\n    )\n    .flatMap { num -\u003e AnyPublisher\u003cInt, TestError\u003e in\n        guard num \u003e 0 else {\n            return Fail(error: TestError.minusError)\n                .eraseToAnyPublisher()\n        }\n        return Just(num)\n            .setFailureType(to: TestError.self)\n            .eraseToAnyPublisher()\n    }\n    .map { twice(num: $0) }\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\($0)\")\n    }\n    .store(in: \u0026cancellables)\n\nsubjectL.send(nil) // ← 即時実行\nDispatchQueue.main.asyncAfter(deadline: .now() + 2.0) {\n    subjectL.send(5) // ← その2秒後に実行\n    DispatchQueue.main.asyncAfter(deadline: .now() + 4.0) {\n        subjectL.send(6) // ← その4秒後に実行\n    }\n}\n\n// 出力\n// receiveValue: 10\n// finished ← first()のおかげで 4 秒待つことはなく timeoutError にならない\n```\n\nもちろん、3 秒以内に nil 以外の値がこなければタイムアウトします↓\n\n```swift\nsubjectL.send(nil) // ← 即時実行\nDispatchQueue.main.asyncAfter(deadline: .now() + 4.0) { // ← 4秒待たせる\n    subjectL.send(5) // ← その4秒後に実行\n    DispatchQueue.main.asyncAfter(deadline: .now() + 4.0) {\n        subjectL.send(6) // ← その4秒後に実行\n    }\n}\n\n// 出力\n// error: timeoutError\n```\n\n以上です。\n\n# 上記のサンプル処理がよくわからない人へ↓\n\n以降はサンプル処理の解説でないですが、Combine の挙動のポイントを書き記したものになります。\n\n## 前提処理\n\n以下の定義はすべてに共通します。\n\n```swift\nimport Combine\nimport Foundation\n\nenum TestError: Error {\n    case minusError\n    case nilError\n    case timeoutError\n    case otherError\n}\n\nfunc twice(num: Int) -\u003e Int {\n    return num * 2\n}\n\nvar cancellables = Set\u003cAnyCancellable\u003e()\n```\n\n- `TestError` という適当なエラーを用意\n- `twice(num: Int)` という数値を 2 倍する適当な関数を用意\n- `cancellables` という適当な `AnyCancellable` を `.store(in: \u0026cancellables)` できる変数を用意\n\n\n## お断り\n\n所々で `nil` を返却しない処理で、`compactMap()` を使用してしまっておりますが、誤った使い方です。\nそういう場合は `map()` を使いましょう。\n\nまた、`map()` で `AnyPublisher\u003cOutput, Failure\u003e` を返すような場合は、`map()` ではなく `flatMap()` としてあげた方が良いです。\n\n申し訳ございません🙇‍♂️\n\n\n## `CurrentValueSubject` の初期化\n\n\n```swift:失敗例\nvar subjectA: CurrentValueSubject\u003cInt?, Never\u003e\n\n// CurrentValueSubject\u003cOutput, Failure\u003e は初期化が必要\nsubject.value = 0 // ← いきなり代入するとエラーになる\n```\n\n```swift:成功例\nvar subjectA: CurrentValueSubject\u003cInt?, Never\u003e\n\nsubjectA = CurrentValueSubject\u003cInt?, Never\u003e(nil) // nilで初期化\nsubjectA.value = 1 // 初期化後ならエラーにならない\n```\n\n- `CurrentValueSubject\u003cOutput, Failure\u003e` は初期化が必要\n\n\n## `sink` の挙動\n\n\n```swift\nvar subjectB = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectB\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\(String(describing: $0))\")\n    }\n    .store(in: \u0026cancellables)\n\n// 出力↓\n// receiveValue: nil ← いきなりnilでながれる\n```\n\n- `sink` するといきなり処理が流れる → 初期値が流れる\n\n\n## `dropFirst` の挙動\n\n\n```swift\nvar subjectC = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectC\n    .dropFirst() // ← 追加\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\(String(describing: $0))\")\n    }\n    .store(in: \u0026cancellables)\n\n// 出力↓\n// なし ← .dropFirst()のおかげで初回（初期値）のストリームはながれない\n```\n\n- `dropFirst` で初回（初期値）のストリームを流れるのを防ぐ\n\n## `send` の挙動\n\n\n```swift\nvar subjectC = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectC\n    .dropFirst()\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\(String(describing: $0))\")\n    }\n    .store(in: \u0026cancellables)\n\n/// sendまたはvalueの代入によってストリームが走る\nsubjectC.send(1)\nsubjectC.send(nil)\nsubjectC.send(2)\nsubjectC.value = 3\n\n// 出力↓\n// receiveValue: Optional(1)\n// receiveValue: nil\n// receiveValue: Optional(2)\n// receiveValue: Optional(3)\n```\n\n- `send` または `value` の代入によってストリームが走る\n\n\n## `cancel` の挙動\n\n\n```swift\nvar subjectC = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectC\n    .dropFirst()\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\(String(describing: $0))\")\n    }\n    .store(in: \u0026cancellables)\n\n/// cancel の処理の挙動\nsubjectC.send(1)\nsubjectC.send(nil)\ncancellables.forEach{ $0.cancel() } // cancel()の実施\nsubjectC.send(2) // cancel()以降処理しなくなる\nsubjectC.value = 3 // cancel()以降処理しなくなる\n\n// 出力↓\n// receiveValue: Optional(1)\n// receiveValue: nil\n```\n\n- `cancel` 以降のストリームは流れない\n\n\n## `completion: .finished` の挙動\n\n\n```swift\nvar subjectC = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectC\n    .dropFirst()\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\(String(describing: $0))\")\n    }\n    .store(in: \u0026cancellables)\n\nsubjectC.send(1)\nsubjectC.send(completion: .finished) // completion\nsubjectC.send(nil) // sinkのcompletionの処理に入ったためsinkは走らない\nsubjectC.send(2) // sinkのcompletionの処理に入ったためsinkは走らない\nsubjectC.value = 3 // sinkのcompletionの処理に入ったためsinkは走らない\n\n// 出力↓\n// receiveValue: Optional(1)\n// finished\n```\n\n- `completion` の処理に入るとストリームに値は走らなくなる\n\n\n## `map` の挙動\n\n\n```swift\nvar subjectD = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectD\n    .dropFirst()\n    .map { twice(num: $0 ?? 0) } // ← 追加\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\(String(describing: $0))\")\n    }\n    .store(in: \u0026cancellables)\n\nsubjectD.send(1)\nsubjectD.send(nil)\nsubjectD.value = 2\n\n// 出力\n// receiveValue: 2 ← map の処理が適応\n// receiveValue: 0 ← nilは $0 ?? 0 によって0に変換されて処理された\n// receiveValue: 4 ← map の処理が適応\n```\n\n- 配列操作の `map` とほぼ同じように処理される\n- 関数を通して値を変換させるのに相性が良い\n- 場合に応じて型も変えることができる\n\n## `compactMap` の挙動\n\n```swift\nvar subjectE = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectE\n    .dropFirst()\n    .compactMap { $0 } // ← 追加\n    .map { twice(num: $0 )} // 先にcompactMap()することによってアンラップ処理を省略\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\(String(describing: $0))\")\n    }\n    .store(in: \u0026cancellables)\n\nsubjectE.send(1)\nsubjectE.send(nil) // ← compactMapによりnilは出力なし\nsubjectE.value = 2\n\n// 出力\n// receiveValue: 2 ← オプショナルが外れる\n// receiveValue: 4 ← オプショナルが外れる\n```\n\n- `compactMap()` は nil の際に処理を流れなくする\n- `compactMap { $0 }` は Combine ならではの `guard let hoge = hoge else { return }` のようなイメージ\n\n`compactMap { $0 }` は書き換えると以下のようになる。\n\n```swift\nvar subjectF = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectF\n    .dropFirst()\n    .compactMap { num -\u003e Int? in // ← compactMap { $0 } と同等の処理\n        guard let num = num else {\n            return nil\n        }\n        return num\n    }\n    .map { twice(num: $0) }\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\(String(describing: $0))\")\n    }\n    .store(in: \u0026cancellables)\n```\n\n## `Fail`、`Just`、`eraseToAnyPublisher`、`setFailureType`、`flatMap` の合わせ技\n\n\n```swift\nvar subjectG = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectG\n    .dropFirst()\n    .flatMap { num -\u003e AnyPublisher\u003cInt, TestError\u003e in // 型を指定\n        guard let num = num else {\n            return Fail(error: TestError.nilError) // Fail(error: Error)を返す\n                .eraseToAnyPublisher()\n        }\n        return Just(num)\n            .setFailureType(to: TestError.self) // AnyPublisher\u003cInt, TestError\u003e にあわせる\n            .eraseToAnyPublisher()\n    }\n    .map { twice(num: $0) }\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\($0)\")\n    }\n    .store(in: \u0026cancellables)\n\nsubjectG.send(1)\nsubjectG.send(nil) // ←  nil のため、Fail(error: TestError.nilError) 発生\nsubjectG.value = 2 // ← 上の処理により sink の completion ブロックに入ったため処理が走らない\n\n// 出力\n// receiveValue: 2\n// error: nilError\n```\n\n- `Fail` はエラーを返す Publisher（`struct Fail\u003cOutput, Failure\u003e : Publisher where Failure : Error`）\n- `Just` はエラーを返さない Publisher（`struct Just\u003cOutput\u003e : Publisher`）\n- `.setFailureType(to: Error.self)` によって、Publisher に任意のエラーを付与できる ← これをつかって `Just` にエラーを付与することも可能\n- `AnyPublisher\u003cOutput, Error\u003e` のような publisher を返す場合は `.eraseToAnyPublisher()` をつけてあげると型が揃う\n- `flatMap()` は `AnyPublisher\u003cOutput, Failure\u003e` を流すストリームを作成する　（ここを `map()` にすると `AnyPublisher\u003cOutput, Failure\u003e` の型であってもストリームは流れない）\n- `Fail` を検知すると `sink` の `completion` ブロックに入りそれ以降のストリームに流れてきた値は処理しない\n\n## `errorMap` の挙動\n\n\n```swift\nvar subjectH = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectH\n    .dropFirst()\n    .compactMap { num -\u003e AnyPublisher\u003cInt, TestError\u003e in // 型を指定\n        guard let num = num else {\n            return Fail(error: TestError.nilError) // Fail(error: Error)を返す\n                .eraseToAnyPublisher()\n        }\n        return Just(num)\n            .setFailureType(to: TestError.self) // AnyPublisher\u003cInt, TestError\u003e にあわせる\n            .eraseToAnyPublisher()\n    }\n    .flatMap { $0 } // AnyPublisher\u003cInt, TestError\u003e を Int と TestError に分ける\n    .map { twice(num: $0) }\n    .mapError { error -\u003e TestError in\n        print(\"before error: \\(error)\")\n        return TestError.otherError // すべてTestError.otherErrorに変換する\n    }\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\($0)\")\n    }\n    .store(in: \u0026cancellables)\n\nsubjectH.send(1)\nsubjectH.send(nil) // ←  nil のため、Fail(error: TestError.nilError) 発生\nsubjectH.value = 2 // ← 上の処理により sink の completion ブロックに入ったため処理が走らない\n\n// 出力\n// receiveValue: 2\n// before error: nilError\n// error: otherError // ← nilError だったエラーが otherError に変更されている\n```\n\n- `map` は `Output` に対してのみ処理をしないし、`errorMap` は `Failure` にのみ処理を適応する\n\n## `first` の挙動\n\n\n```swift\nvar subjectI = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectI\n    .dropFirst()\n    .first() // ← 追加\n    .compactMap { num -\u003e AnyPublisher\u003cInt, TestError\u003e in\n        guard let num = num else {\n            return Fail(error: TestError.nilError)\n                .eraseToAnyPublisher()\n        }\n        return Just(num)\n            .setFailureType(to: TestError.self)\n            .eraseToAnyPublisher()\n    }\n    .flatMap { $0 }\n    .map { twice(num: $0) }\n    .mapError { error -\u003e TestError in\n        print(\"before error: \\(error)\")\n        return TestError.otherError // すべてTestError.otherErrorに変換する\n    }\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\($0)\")\n    }\n    .store(in: \u0026cancellables)\n\nsubjectI.send(1) // ← first()によって1つの処理が終了したらsinkのcompletionブロックに入る\nsubjectI.send(nil) // ← すでにsinkのcompletionブロックに入っているため処理が走らない\nsubjectI.value = 2 // ← すでにsinkのcompletionブロックに入っているため処理が走らない\n\n// 出力\n// receiveValue: 2\n```\n\n- `first()` はひとつのストリームを受け取ったら `completion` となる\n- ひとつめで `completion` するのではなく、N 回目で `completion` するかをコントロールするには `prefix()` を用いる↓\n\n## 【補足】 `prefix` の挙動\n\n```swift\nvar subjectI = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectI\n    .dropFirst()\n    .prefix(2) // ← 追加\n    .compactMap { num -\u003e AnyPublisher\u003cInt, TestError\u003e in\n        guard let num = num else {\n            return Fail(error: TestError.nilError)\n                .eraseToAnyPublisher()\n        }\n        return Just(num)\n            .setFailureType(to: TestError.self)\n            .eraseToAnyPublisher()\n    }\n    .flatMap { $0 }\n    .map { twice(num: $0) }\n    .mapError { error -\u003e TestError in\n        print(\"before error: \\(error)\")\n        return TestError.otherError // すべてTestError.otherErrorに変換する\n    }\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\($0)\")\n    }\n    .store(in: \u0026cancellables)\n\nsubjectI.send(1) // 1つめ\nsubjectI.send(2) // 2つめ ← prefix(2)によりこの時点でcompletionする\nsubjectI.value = 3 // 3つめ ← completionブロックに入ったため処理されない\n\n// 出力\n// receiveValue: 2\n// receiveValue: 4\n// finished\n```\n\n- `prefix()` で、値が来てから N 回目で `completion` するかをコントロールできる\n- つまり、`first()` と `prefix(1)` は同じ挙動（のはず）\n\n## `timeout` の挙動\n\n### 基本形\n\n```swift\nvar subjectJ = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectJ\n    .dropFirst()\n    .compactMap { num -\u003e AnyPublisher\u003cInt, TestError\u003e in\n        guard let num = num else {\n            return Fail(error: TestError.nilError)\n                .eraseToAnyPublisher()\n        }\n        return Just(num)\n            .setFailureType(to: TestError.self)\n            .eraseToAnyPublisher()\n    }\n    .flatMap { $0 }\n    .map { twice(num: $0) }\n    .timeout( // ← 追加\n        .seconds(3),\n        scheduler: DispatchQueue.main,\n        options: nil,\n        customError: { .timeoutError }\n    )\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\($0)\")\n    }\n    .store(in: \u0026cancellables)\n\nsubjectJ.send(5) // ← 即時実行\nDispatchQueue.main.asyncAfter(deadline: .now() + 2.0) {\n    subjectJ.send(6) // ← send(5)の2秒後に実行\n    DispatchQueue.main.asyncAfter(deadline: .now() + 4.0) {\n        subjectJ.send(7) // ← send(6)の4秒後に実行 ← timeoutが3秒のため実行されない\n    }\n}\n\n\n// 出力\n// receiveValue: 10\n// receiveValue: 12 // ← subjectJ.send(5)実行から2秒後\n// error: timeoutError // ← subjectJ.send(6)実行から3秒後\n```\n\n- `timeout()` で設定する期間は、値を最初に受け始めてから `completion` するまでの時間ではなく、ストリームが流れていない期間を指定したこととなる\n- 一度タイムアウトすると `completion` 処理が実行されるため、ストリームは走らなくなる\n\n### わざとタイムアウトさせる方法\n\n```swift\nvar subjectK = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectK\n    .compactMap { _ -\u003e Int? in return nil } // ← わざと全てnilに変換する\n    .compactMap { num -\u003e AnyPublisher\u003cInt, TestError\u003e? in\n        guard num \u003e 0 else {\n            return Fail(error: TestError.minusError)\n                .eraseToAnyPublisher()\n        }\n        return Just(num)\n            .setFailureType(to: TestError.self)\n            .eraseToAnyPublisher()\n    }\n    .flatMap { $0 }\n    .map { twice(num: $0) }\n    .timeout(\n        .seconds(3),\n        scheduler: DispatchQueue.main,\n        options: nil,\n        customError: { .timeoutError }\n    )\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\($0)\")\n    }\n    .store(in: \u0026cancellables)\n\nsubjectK.send(7)\n\n// 出力\n// error: timeoutError\n```\n\n- `.compactMap { _ -\u003e Int? in return nil }` で、わざと全て `nil` に変換する処理を `compactMap()` 内で行うと、ストリームが流れないので timeout する\n\n\n## タイトル回収\n\n初期値が nil の CurrentValueSubject について nil 以外の値がくるまでのタイムアウトを設定する\n\n### うまくいく例\n\n初期値が nil の CurrentValueSubject があるとき、nil 以外の最初の一つ目の値がくるまでタイムアウトを設定するには、以下の順で処理してあげるとうまくいく。\n\n1. `compactMap()`\n2. `first()`\n3. `timeout()` \n\n```swift\nvar subjectL = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectL\n    .compactMap { $0 } // ← nilを排除\n    .first() // ← nil 以外の値がくれば completion が呼ばれる\n    .setFailureType(to: TestError.self) // ← timeout の Failure を設定してあげる\n    .timeout(\n        .seconds(3),\n        scheduler: DispatchQueue.main,\n        options: nil,\n        customError: { .timeoutError }\n    )\n    .compactMap { num -\u003e AnyPublisher\u003cInt, TestError\u003e in\n        guard num \u003e 0 else {\n            return Fail(error: TestError.minusError)\n                .eraseToAnyPublisher()\n        }\n        return Just(num)\n            .setFailureType(to: TestError.self)\n            .eraseToAnyPublisher()\n    }\n    .flatMap { $0 }\n    .map { twice(num: $0) }\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\($0)\")\n    }\n    .store(in: \u0026cancellables)\n\nsubjectL.send(nil) // ← 即時実行\nDispatchQueue.main.asyncAfter(deadline: .now() + 2.0) {\n    subjectL.send(5) // ← その2秒後に実行\n    DispatchQueue.main.asyncAfter(deadline: .now() + 4.0) {\n        subjectL.send(6) // ← その4秒後に実行\n    }\n}\n\n// 出力\n// receiveValue: 10\n// finished ← first()のおかげで 4 秒待つことはなく timeoutError にならない\n```\n\n### うまくいかない例1\n\n`first()` を抜いてみた場合↓\n\n```swift\nvar subjectL = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectL\n    .compactMap { $0 } // ← nilを排除\n//    .first() // ← nil 以外の値がくれば completion が呼ばれる\n    .setFailureType(to: TestError.self) // ← timeout の Failure を設定してあげる\n    .timeout(\n        .seconds(3),\n        scheduler: DispatchQueue.main,\n        options: nil,\n        customError: { .timeoutError }\n    )\n    .compactMap { num -\u003e AnyPublisher\u003cInt, TestError\u003e in\n        guard num \u003e 0 else {\n            return Fail(error: TestError.minusError)\n                .eraseToAnyPublisher()\n        }\n        return Just(num)\n            .setFailureType(to: TestError.self)\n            .eraseToAnyPublisher()\n    }\n    .flatMap { $0 }\n    .map { twice(num: $0) }\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\($0)\")\n    }\n    .store(in: \u0026cancellables)\n\nsubjectL.send(nil) // ← 即時実行\nDispatchQueue.main.asyncAfter(deadline: .now() + 2.0) {\n    subjectL.send(5) // ← その2秒後に実行\n    DispatchQueue.main.asyncAfter(deadline: .now() + 4.0) {\n        subjectL.send(6) // ← その4秒後に実行\n    }\n}\n\n// 出力\n// receiveValue: 10\n// receiveValue: 12\n// error: timeoutError\n```\n\n- `first()` がないため、明確にストリームを止めない限り `completion` のブロックには行かないためタイムアウトエラーとなる\n\n### うまくいかない例2\n\n`first()` のあとに `compactMap()` した場合↓\n\n```swift\nvar subjectL = CurrentValueSubject\u003cInt?, Never\u003e(nil)\nsubjectL\n    .dropFirst()\n    .first() // ← 値がくれば completion が呼ばれる\n    .compactMap { $0 } // ← nilを排除\n    .setFailureType(to: TestError.self) // ← timeout の Failure を設定してあげる\n    .timeout(\n        .seconds(3),\n        scheduler: DispatchQueue.main,\n        options: nil,\n        customError: { .timeoutError }\n    )\n    .compactMap { num -\u003e AnyPublisher\u003cInt, TestError\u003e in\n        guard num \u003e 0 else {\n            return Fail(error: TestError.minusError)\n                .eraseToAnyPublisher()\n        }\n        return Just(num)\n            .setFailureType(to: TestError.self)\n            .eraseToAnyPublisher()\n    }\n    .flatMap { $0 }\n    .map { twice(num: $0) }\n    .sink { completion in\n        switch completion {\n        case .finished:\n            print(\"finished\")\n        case let .failure(error):\n            print(\"error: \\(error)\")\n        }\n    } receiveValue: {\n        print(\"receiveValue: \\($0)\")\n    }\n    .store(in: \u0026cancellables)\n\nsubjectL.send(nil) // ← 即時実行\nDispatchQueue.main.asyncAfter(deadline: .now() + 2.0) {\n    subjectL.send(5) // ← その2秒後に実行\n    DispatchQueue.main.asyncAfter(deadline: .now() + 4.0) {\n        subjectL.send(6) // ← その4秒後に実行\n    }\n}\n\n// 出力\n// finished\n```\n\n- `subjectL.send(nil)` で nil が来て、`first()` を通過するので、その時点で `completion` することが確定し、`compactMap { $0 }` で nil が排除されてすぐに `completion` のブロックに入る\n","coediting":false,"comments_count":0,"created_at":"2021-09-04T01:15:51+09:00","group":null,"id":"0ee6bf6d2cb70b9c7607","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Swift","versions":[]},{"name":"Combine","versions":[]}],"title":"【Swift】【Combine入門】Combine で初期値が nil の CurrentValueSubject について nil 以外の値がくるまでのタイムアウトを設定する方法","updated_at":"2021-09-27T08:37:30+09:00","url":"https://qiita.com/ikuraikura/items/0ee6bf6d2cb70b9c7607","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"解説\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E8%AA%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解説\u003c/h1\u003e\n\n\u003cp\u003eタイトルの通りです。\u003cbr\u003e\n環境:Xcode12.5.1\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"kt\"\u003eFoundation\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003estruct\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\n    \u003cspan class=\"nf\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"nv\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"nv\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// A--P-B という関係なら AP + PB \u0026lt; AB は成り立たないことを用いる \u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ※ ここで AP + PB = AB で評価すると Double の端数で等式が成り立たなくなるので .ulpOfOne を用いる\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eisIncludeLineSegment\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econsistingOf\u003c/span\u003e \u003cspan class=\"nv\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eBool\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003edistanceToA\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edistance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003edistanceToB\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edistance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003edistanceAB\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edistance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edistanceToA\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003edistanceToB\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003edistanceAB\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eulpOfOne\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003edistance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"nv\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003esqrt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ediffX\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ediffX\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ediffY\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ediffY\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 二乗はpow()でもよいがDouble型の指定があるため使いづらいため敬遠\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003ediffX\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"nv\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003ediffY\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"nv\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etarget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 別の評価方法（問題があるかもしれません）\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eisIncludeLineSegmentOther\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econsistingOf\u003c/span\u003e \u003cspan class=\"nv\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eBool\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eendPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// 点Pが線分AB上にある\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// テスト\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// y = 2x + 1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// 5点列挙：(0, 1), (1, 3), (2,5), (3,7), (4,8)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e/// (1,3) と (3, 7) の線分で考える\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003epoint01\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003epoint13\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003epoint25\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003epoint37\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003epoint48\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003epoint00\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 直線上にないその他の点\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// isIncludeLineSegmentでのテスト\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint01\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eisIncludeLineSegment\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003econsistingOf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint37\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint13\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eisIncludeLineSegment\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003econsistingOf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint37\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint25\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eisIncludeLineSegment\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003econsistingOf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint37\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint37\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eisIncludeLineSegment\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003econsistingOf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint37\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint48\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eisIncludeLineSegment\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003econsistingOf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint37\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint00\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eisIncludeLineSegment\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003econsistingOf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint37\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// isIncludeLineSegmentOtherでのテスト\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint01\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eisIncludeLineSegmentOther\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003econsistingOf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint37\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint13\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eisIncludeLineSegmentOther\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003econsistingOf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint37\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint25\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eisIncludeLineSegmentOther\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003econsistingOf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint37\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint37\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eisIncludeLineSegmentOther\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003econsistingOf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint37\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint48\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eisIncludeLineSegmentOther\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003econsistingOf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint37\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint00\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eisIncludeLineSegmentOther\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003econsistingOf\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoint13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epoint37\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"# 解説\n\nタイトルの通りです。\n環境:Xcode12.5.1\n\n```swift\nimport Foundation\n\nstruct RectangularCoordinateSystemPoint {\n    let x: Double\n    let y: Double\n    \n    init(_ x: Double, _ y: Double) {\n        self.x = x\n        self.y = y\n    }\n}\n\nextension RectangularCoordinateSystemPoint {\n    // A--P-B という関係なら AP + PB \u003c AB は成り立たないことを用いる \n    // ※ ここで AP + PB = AB で評価すると Double の端数で等式が成り立たなくなるので .ulpOfOne を用いる\n    func isIncludeLineSegment(consistingOf endPoint: (a: RectangularCoordinateSystemPoint, b: RectangularCoordinateSystemPoint)) -\u003e Bool {\n        let distanceToA = self.distance(to: endPoint.a)\n        let distanceToB = self.distance(to: endPoint.b)\n        let distanceAB = endPoint.a.distance(to: endPoint.b)\n        return distanceToA + distanceToB - distanceAB \u003c .ulpOfOne\n    }\n\n    func distance(to target: RectangularCoordinateSystemPoint) -\u003e Double {\n        return sqrt(self.diffX(to: target) * self.diffX(to: target) + self.diffY(to: target) * self.diffY(to: target)) // 二乗はpow()でもよいがDouble型の指定があるため使いづらいため敬遠\n    }\n    \n    func diffX(to target: RectangularCoordinateSystemPoint) -\u003e Double {\n        return self.x - target.x\n    }\n    \n    func diffY(to target: RectangularCoordinateSystemPoint) -\u003e Double {\n        return self.y - target.y\n    }\n}\n\nextension RectangularCoordinateSystemPoint {\n    // 別の評価方法（問題があるかもしれません）\n    func isIncludeLineSegmentOther(consistingOf endPoint: (a: RectangularCoordinateSystemPoint, b: RectangularCoordinateSystemPoint)) -\u003e Bool {\n        if (endPoint.a.x \u003c= self.x \u0026\u0026 self.x \u003c= endPoint.b.x) || (endPoint.b.x \u003c= self.x \u0026\u0026 self.x \u003c= endPoint.a.x) {\n            if (endPoint.a.y \u003c= self.y \u0026\u0026 self.y \u003c= endPoint.b.y) || (endPoint.b.y \u003c= self.y \u0026\u0026 self.y \u003c= endPoint.a.y) {\n                if (self.y * (endPoint.a.x - endPoint.b.x)) + (endPoint.a.y * (endPoint.b.x - self.x)) + (endPoint.b.y * (self.x - endPoint.a.x)) == 0 {\n                    // 点Pが線分AB上にある\n                    return true\n                }\n            }\n        }\n        return false\n    }\n}\n\n/// テスト\n/// y = 2x + 1\n/// 5点列挙：(0, 1), (1, 3), (2,5), (3,7), (4,8)\n/// (1,3) と (3, 7) の線分で考える\nlet point01 = RectangularCoordinateSystemPoint(0,1)\nlet point13 = RectangularCoordinateSystemPoint(1,3)\nlet point25 = RectangularCoordinateSystemPoint(2,5)\nlet point37 = RectangularCoordinateSystemPoint(3,7)\nlet point48 = RectangularCoordinateSystemPoint(4,8)\nlet point00 = RectangularCoordinateSystemPoint(0,0) // 直線上にないその他の点\n\n/// isIncludeLineSegmentでのテスト\nprint(point01.isIncludeLineSegment(consistingOf: (point13, point37))) // false\nprint(point13.isIncludeLineSegment(consistingOf: (point13, point37))) // true\nprint(point25.isIncludeLineSegment(consistingOf: (point13, point37))) // true\nprint(point37.isIncludeLineSegment(consistingOf: (point13, point37))) // true\nprint(point48.isIncludeLineSegment(consistingOf: (point13, point37))) // false\nprint(point00.isIncludeLineSegment(consistingOf: (point13, point37))) // false\n\n/// isIncludeLineSegmentOtherでのテスト\nprint(point01.isIncludeLineSegmentOther(consistingOf: (point13, point37))) // false\nprint(point13.isIncludeLineSegmentOther(consistingOf: (point13, point37))) // true\nprint(point25.isIncludeLineSegmentOther(consistingOf: (point13, point37))) // true\nprint(point37.isIncludeLineSegmentOther(consistingOf: (point13, point37))) // true\nprint(point48.isIncludeLineSegmentOther(consistingOf: (point13, point37))) // false\nprint(point00.isIncludeLineSegmentOther(consistingOf: (point13, point37))) // false\n```\n","coediting":false,"comments_count":0,"created_at":"2021-09-02T11:48:59+09:00","group":null,"id":"59cc6366da15aeb00c43","likes_count":1,"private":false,"reactions_count":0,"tags":[{"name":"Swift","versions":[]}],"title":"【Swift】平面座標系である点がある線分上にあるかを評価する方法","updated_at":"2021-09-06T09:49:55+09:00","url":"https://qiita.com/ikuraikura/items/59cc6366da15aeb00c43","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"サンプルコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eサンプルコード\u003c/h1\u003e\n\n\u003cp\u003eタイトルの通りです。\u003cbr\u003e\n環境：Xcode12.5.1\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"kt\"\u003eFoundation\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003estruct\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\n    \u003cspan class=\"nf\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"nv\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"nv\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003egetSubtendedAngle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"nv\"\u003epointA\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"nv\"\u003epointB\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eAngle\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 始点を自身の点Pとする\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003epointP\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// 点Aと点Bまでのベクトルを宣言する\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003evectorPA\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemVector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epointP\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epointA\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003evectorPB\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemVector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epointP\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epointB\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// ベクトルの大きさと内積を求める\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003emagnitudePA\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evectorPA\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emagnitude\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003emagnitudePB\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evectorPB\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emagnitude\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003einnerProduct\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemVector\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003einnerProduct\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evectorPA\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evectorPB\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e//  cosθ = 𝑎⃗・𝑏⃗ / |𝑎⃗| * |𝑏⃗| の公式より\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ecosTheta\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einnerProduct\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emagnitudePA\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003emagnitudePB\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kt\"\u003eAngle\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eradian\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eacos\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecosTheta\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003estruct\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemVector\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eelementX\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eelementY\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\n\n    \u003cspan class=\"nf\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efrom\u003c/span\u003e \u003cspan class=\"nv\"\u003efromPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"nv\"\u003etoPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelementX\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etoPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003efromPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelementY\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etoPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003efromPoint\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemVector\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003emagnitude\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003esqrt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eelementX\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eelementX\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eelementY\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eelementY\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003einnerProduct\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"nv\"\u003evectorA\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemVector\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"nv\"\u003evectorB\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemVector\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003evectorA\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelementX\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003evectorB\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelementX\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003evectorA\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelementY\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003evectorB\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelementY\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eenum\u003c/span\u003e \u003cspan class=\"kt\"\u003eAngle\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"nf\"\u003eradian\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"nv\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"nf\"\u003earcDegree\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"nv\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003eradian\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003earcDegree\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epi\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e180\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eradian\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003earcDegree\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003earcDegree\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003earcDegree\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eradian\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e180\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epi\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enormalizedArcDegree\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003earcDegree\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etruncatingRemainder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003edividingBy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mf\"\u003e360.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.0\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedArcDegree\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedArcDegree\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mf\"\u003e360.0\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enormalizedArcDegree\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// サンプル\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003epointP\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003epointA\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003epointB\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eRectangularCoordinateSystemPoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eangle\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eAngle\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epointP\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetSubtendedAngle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epointA\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epointB\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"なす角 ∠APB: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003eangle\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003earcDegree\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// なす角 ∠APB: 45.00000000000001\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"# サンプルコード\n\nタイトルの通りです。\n環境：Xcode12.5.1\n\n```swift\nimport Foundation\n\nstruct RectangularCoordinateSystemPoint {\n    let x: Double\n    let y: Double\n    \n    init(_ x:Double, _ y:Double) {\n        self.x = x\n        self.y = y\n    }\n}\n\nextension RectangularCoordinateSystemPoint {\n    func getSubtendedAngle(_ pointA: RectangularCoordinateSystemPoint, _ pointB:RectangularCoordinateSystemPoint) -\u003e Angle {\n        // 始点を自身の点Pとする\n        let pointP = self\n\n        // 点Aと点Bまでのベクトルを宣言する\n        let vectorPA = RectangularCoordinateSystemVector(from: pointP, to: pointA)\n        let vectorPB = RectangularCoordinateSystemVector(from: pointP, to: pointB)\n\n        // ベクトルの大きさと内積を求める\n        let magnitudePA = vectorPA.magnitude\n        let magnitudePB = vectorPB.magnitude\n        let innerProduct = RectangularCoordinateSystemVector.innerProduct(vectorPA, vectorPB)\n\n        //  cosθ = 𝑎⃗・𝑏⃗ / |𝑎⃗| * |𝑏⃗| の公式より\n        let cosTheta = innerProduct / (magnitudePA * magnitudePB)\n        return Angle.radian(acos(cosTheta))\n    }\n}\n\nstruct RectangularCoordinateSystemVector {\n    let elementX: Double\n    let elementY: Double\n    \n    init(from fromPoint: RectangularCoordinateSystemPoint, to toPoint: RectangularCoordinateSystemPoint) {\n        self.elementX = toPoint.x - fromPoint.x\n        self.elementY = toPoint.y - fromPoint.y\n    }\n}\n\nextension RectangularCoordinateSystemVector {\n    var magnitude: Double {\n        return sqrt(elementX * elementX + elementY * elementY)\n    }\n    \n    static func innerProduct(_ vectorA: RectangularCoordinateSystemVector, _ vectorB: RectangularCoordinateSystemVector) -\u003e Double {\n        return vectorA.elementX * vectorB.elementX + vectorA.elementY * vectorB.elementY\n    }\n}\n\nenum Angle {\n    case radian(_ value: Double)\n    case arcDegree(_ value: Double)\n    \n    var radian: Double {\n        switch self {\n        case let .arcDegree(value):\n            return value * .pi / 180\n        case let .radian(value):\n            return value\n        }\n    }\n    \n    var arcDegree: Double {\n        var arcDegree: Double {\n            switch self {\n            case let .arcDegree(value):\n                return value\n            case let .radian(value):\n                return value * 180 / .pi\n            }\n        }\n        let normalizedArcDegree = arcDegree.truncatingRemainder(dividingBy: 360.0)\n        return 0.0 \u003e normalizedArcDegree ? normalizedArcDegree + 360.0 : normalizedArcDegree\n    }\n}\n\n// サンプル\nlet pointP = RectangularCoordinateSystemPoint(1,3)\nlet pointA = RectangularCoordinateSystemPoint(3,4)\nlet pointB = RectangularCoordinateSystemPoint(2,6)\n\nlet angle: Angle = pointP.getSubtendedAngle(pointA, pointB)\n\nprint(\"なす角 ∠APB: \\(angle.arcDegree)\") // なす角 ∠APB: 45.00000000000001\n```\n","coediting":false,"comments_count":0,"created_at":"2021-09-02T08:49:25+09:00","group":null,"id":"5818ba162d32323e63ed","likes_count":1,"private":false,"reactions_count":0,"tags":[{"name":"Swift","versions":[]}],"title":"【Swift】平面座標系でのベクトルの内積の公式を用いてある3点からなるなす角を求める方法","updated_at":"2021-09-02T12:40:24+09:00","url":"https://qiita.com/ikuraikura/items/5818ba162d32323e63ed","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003e関数の引数としてタプルを設定した場合の挙動をまとめました。（Xocde:12.5.1）\u003cbr\u003e\nコードを見れば何がやりたいかわかると思います🙇‍♂️\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"タプル内の変数宣言なし\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BF%E3%83%97%E3%83%AB%E5%86%85%E3%81%AE%E5%A4%89%E6%95%B0%E5%AE%A3%E8%A8%80%E3%81%AA%E3%81%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eタプル内の変数宣言なし\u003c/h2\u003e\n\n\u003cp\u003eタプル内の変数宣言なしの場合はタプルのインデックスでアクセス可能です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efuncA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eints\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// indexでのアクセス\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eints\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eints\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nf\"\u003efuncA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eints\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"タプル内の変数宣言あり\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BF%E3%83%97%E3%83%AB%E5%86%85%E3%81%AE%E5%A4%89%E6%95%B0%E5%AE%A3%E8%A8%80%E3%81%82%E3%82%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eタプル内の変数宣言あり\u003c/h2\u003e\n\n\u003cp\u003eタプル内の変数宣言ありの場合はタプルのインデックスでも、変数でもどちらでもアクセス可能です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efuncB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eints\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// a,bでのアクセス ← 安全にアクセスできるのでおすすめ！！\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eints\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eints\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// indexでのアクセス\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eints\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eints\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nf\"\u003efuncB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eints\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"タプル内の変数宣言あり-かつ-実行時に引数を省略する-エラーになる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BF%E3%83%97%E3%83%AB%E5%86%85%E3%81%AE%E5%A4%89%E6%95%B0%E5%AE%A3%E8%A8%80%E3%81%82%E3%82%8A-%E3%81%8B%E3%81%A4-%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%AB%E5%BC%95%E6%95%B0%E3%82%92%E7%9C%81%E7%95%A5%E3%81%99%E3%82%8B-%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AB%E3%81%AA%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eタプル内の変数宣言あり かつ 実行時に引数を省略する （エラーになる）\u003c/h2\u003e\n\n\u003cp\u003eエラーになるので関数を宣言できません。理由は不明です。Apple さん、対応してください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efuncC\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eints\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"nv\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"nv\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e \u003cspan class=\"c1\"\u003e// なぜか引数としての変数を省略できないのでエラーになる\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eもちろんこれはできます↓\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// もちろんこれはできる\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003efuncD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"nv\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"nv\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// a,bでのアクセス\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// indexでのアクセス ← これはできない！！\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// print(0) // 0 ← 当たり前であるが 0 がプリントされるので注意\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// print(1) // 1 ← 当たり前であるが 1 がプリントされるので注意\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nf\"\u003efuncD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 1\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"さいごに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eさいごに\u003c/h1\u003e\n\n\u003cp\u003e関数の引数としてタプルを設定する場合も変数を設定できます！\u003c/p\u003e\n","body":"\n# はじめに\n\n関数の引数としてタプルを設定した場合の挙動をまとめました。（Xocde:12.5.1）\nコードを見れば何がやりたいかわかると思います🙇‍♂️\n\n## タプル内の変数宣言なし\n\nタプル内の変数宣言なしの場合はタプルのインデックスでアクセス可能です。\n\n```swift\nfunc funcA(ints: (Int, Int)) {\n    // indexでのアクセス\n    print(ints.0) \n    print(ints.1)\n}\n\nfuncA(ints: (1, 2))\n// 1\n// 2\n```\n\n## タプル内の変数宣言あり\n\nタプル内の変数宣言ありの場合はタプルのインデックスでも、変数でもどちらでもアクセス可能です。\n\n```swift\nfunc funcB(ints: (a: Int, b: Int)) {\n    // a,bでのアクセス ← 安全にアクセスできるのでおすすめ！！\n    print(ints.a)\n    print(ints.b)\n    \n    // indexでのアクセス\n    print(ints.0)\n    print(ints.1)\n}\n\nfuncB(ints: (a: 1, b: 2))\n// 1\n// 2\n// 1\n// 2\n```\n\n## タプル内の変数宣言あり かつ 実行時に引数を省略する （エラーになる）\n\nエラーになるので関数を宣言できません。理由は不明です。Apple さん、対応してください。\n\n```swift\nfunc funcC(ints: (_ a: Int, _ b: Int)) {} // なぜか引数としての変数を省略できないのでエラーになる\n```\n\nもちろんこれはできます↓\n\n```swift\n// もちろんこれはできる\nfunc funcD(_ a: Int, _ b: Int) {\n    // a,bでのアクセス\n    print(a)\n    print(b)\n    \n    // indexでのアクセス ← これはできない！！\n    // print(0) // 0 ← 当たり前であるが 0 がプリントされるので注意\n    // print(1) // 1 ← 当たり前であるが 1 がプリントされるので注意\n}\n\nfuncD(1, 2)\n// 1\n// 2\n```\n\n# さいごに\n\n関数の引数としてタプルを設定する場合も変数を設定できます！\n","coediting":false,"comments_count":0,"created_at":"2021-08-23T11:16:50+09:00","group":null,"id":"f6c86b04f0522fb37cfb","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Swift","versions":[]}],"title":"【Swift】関数の引数としてタプルを設定した場合の挙動","updated_at":"2021-09-07T22:07:00+09:00","url":"https://qiita.com/ikuraikura/items/f6c86b04f0522fb37cfb","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"ポイント\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eポイント\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eプロトコルを継承したプロトコルは継承元のプロトコルを満たさなくてもよい\n\n\u003cul\u003e\n\u003cli\u003eプロトコルの要件を満たす必要があるのは継承したClass側\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e引数としてプロトコルを設定している場合、直接そのプロトコルを継承していなくてよい\n\n\u003cul\u003e\n\u003cli\u003e間接的にそのプロトコルを継承している関係であればエラーは起こらない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実験したコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E9%A8%93%E3%81%97%E3%81%9F%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実験したコード\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eprotocol\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ehoge\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eprotocol\u003c/span\u003e \u003cspan class=\"kt\"\u003eMogeProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003emoge\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eprotocol\u003c/span\u003e \u003cspan class=\"kt\"\u003eMogeHogeProtocol\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003emoge\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// var hoge: Int { get } ← HogeProtocol プロトコルを継承しているが hoge を宣言しなくてもよい\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eprotocol\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeMogeProtocol\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eMogeProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// var moge: Int { get } ← MogeProtocol プロトコルを継承しているが moge を宣言しなくてもよい\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ehoge\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// パターンA\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"kt\"\u003eMogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eMogeProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003emoge\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// パターンB\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ehoge\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// パターンC\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"kt\"\u003eMogeAndHogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eMogeProtocol\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003emoge\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ehoge\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// パターンD（MogeHogeProtocolはHogeProtocolを継承している）\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"kt\"\u003eMogeHogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eMogeHogeProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003emoge\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ehoge\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// パターンE（HogeMogeProtocolはMogeProtocolを継承している）\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeMogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeMogeProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003emoge\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ehoge\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// パターンF（HogeMogeProtocolはMogeProtocolを継承している）\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeMogeAndHogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeMogeProtocol\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeProtocol\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003emoge\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ehoge\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestClass\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ehogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeProtocol\u003c/span\u003e\n\n    \u003cspan class=\"nf\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ehogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeProtocol\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehogeClass\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehogeClass\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehogeClass\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehoge\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e/// 実験\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestClass\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ehogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eMogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"c1\"\u003e// MogeProtocol ← HogeProtocol は継承していないのでコンパイルエラー\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestClass\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ehogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"c1\"\u003e// HogeProtocol\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestClass\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ehogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eMogeAndHogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"c1\"\u003e// MogeProtocol + HogeProtocol\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestClass\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ehogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eMogeHogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"c1\"\u003e// MogeHogeProtocol（HogeProtocolを継承している）\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestClass\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ehogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeMogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"c1\"\u003e// HogeMogeProtocol（MogeProtocolを継承している） ← HogeProtocol は継承していないのでコンパイルエラー\u003c/span\u003e\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ef\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestClass\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ehogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eHogeMogeAndHogeClass\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"c1\"\u003e// HogeMogeProtocol（MogeProtocolを継承している） + HogeProtocol\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"# ポイント\n\n- プロトコルを継承したプロトコルは継承元のプロトコルを満たさなくてもよい\n    - プロトコルの要件を満たす必要があるのは継承したClass側\n- 引数としてプロトコルを設定している場合、直接そのプロトコルを継承していなくてよい\n    - 間接的にそのプロトコルを継承している関係であればエラーは起こらない\n\n# 実験したコード\n\n```swift\nprotocol HogeProtocol {\n    var hoge: Int { get }\n}\n\nprotocol MogeProtocol {\n    var moge: Int { get }\n}\n\nprotocol MogeHogeProtocol: HogeProtocol {\n    var moge: Int { get }\n    // var hoge: Int { get } ← HogeProtocol プロトコルを継承しているが hoge を宣言しなくてもよい\n}\n\nprotocol HogeMogeProtocol: MogeProtocol {\n    // var moge: Int { get } ← MogeProtocol プロトコルを継承しているが moge を宣言しなくてもよい\n    var hoge: Int { get }\n}\n\n// パターンA\nclass MogeClass: MogeProtocol {\n    var moge: Int = 0\n}\n\n// パターンB\nclass HogeClass: HogeProtocol {\n    var hoge: Int = 2\n}\n\n// パターンC\nclass MogeAndHogeClass: MogeProtocol, HogeProtocol {\n    var moge: Int = 0\n    var hoge: Int = 3\n}\n\n// パターンD（MogeHogeProtocolはHogeProtocolを継承している）\nclass MogeHogeClass: MogeHogeProtocol {\n    var moge: Int = 0\n    var hoge: Int = 4\n}\n\n// パターンE（HogeMogeProtocolはMogeProtocolを継承している）\nclass HogeMogeClass: HogeMogeProtocol {\n    var moge: Int = 0\n    var hoge: Int = 5\n}\n\n// パターンF（HogeMogeProtocolはMogeProtocolを継承している）\nclass HogeMogeAndHogeClass: HogeMogeProtocol, HogeProtocol {\n    var moge: Int = 0\n    var hoge: Int = 6\n}\n\nclass TestClass {\n    let hogeClass: HogeProtocol\n    \n    init(hogeClass: HogeProtocol) {\n        self.hogeClass = hogeClass\n        print(hogeClass.hoge)\n    }\n}\n\n/// 実験\nlet a = TestClass(hogeClass: MogeClass()) // MogeProtocol ← HogeProtocol は継承していないのでコンパイルエラー\nlet b = TestClass(hogeClass: HogeClass()) // HogeProtocol\nlet c = TestClass(hogeClass: MogeAndHogeClass()) // MogeProtocol + HogeProtocol\nlet d = TestClass(hogeClass: MogeHogeClass()) // MogeHogeProtocol（HogeProtocolを継承している）\nlet e = TestClass(hogeClass: HogeMogeClass()) // HogeMogeProtocol（MogeProtocolを継承している） ← HogeProtocol は継承していないのでコンパイルエラー\nlet f = TestClass(hogeClass: HogeMogeAndHogeClass()) // HogeMogeProtocol（MogeProtocolを継承している） + HogeProtocol\n```\n","coediting":false,"comments_count":0,"created_at":"2021-08-23T10:56:11+09:00","group":null,"id":"128561ac017893f9fbe5","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Swift","versions":[]}],"title":"【Swift】プロトコルにプロトコルを継承させたときの挙動","updated_at":"2021-08-23T11:02:56+09:00","url":"https://qiita.com/ikuraikura/items/128561ac017893f9fbe5","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/akeome/items/514c077cfc460d7d2382\" id=\"reference-c6afa503beac563d3be3\"\u003e配列を処理するときに次の要素を扱う方法\u003c/a\u003eの記事を参考にいろいろとアレンジしてみました。\u003cbr\u003e\nまた、空配列がやってきたりして、ペアの生成に失敗したときにエラーにならないことも確認しながら書いてみました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"パターン1最後の要素のペアにはnilを入れたい場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B31%E6%9C%80%E5%BE%8C%E3%81%AE%E8%A6%81%E7%B4%A0%E3%81%AE%E3%83%9A%E3%82%A2%E3%81%AB%E3%81%AFnil%E3%82%92%E5%85%A5%E3%82%8C%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eパターン1：最後の要素のペアにはnilを入れたい場合\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"kt\"\u003eArray\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003epair\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"kt\"\u003eElement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eElement\u003c/span\u003e\u003cspan class=\"p\"\u003e?)]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ecopy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eElement\u003c/span\u003e\u003cspan class=\"p\"\u003e?]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecopy\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eenumerated\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecopy\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoffset\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enums\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"n\"\u003enums\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epair\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eforEach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enum2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e * \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e = \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//  出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//  1 * 2 = 2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//  2 * 3 = 6\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\u003cspan class=\"n\"\u003eempty\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epair\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eforEach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enum2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e * \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e = \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//  出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//  なし\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"パターン2最後の要素のペアには先頭の要素とペアにしたい場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B32%E6%9C%80%E5%BE%8C%E3%81%AE%E8%A6%81%E7%B4%A0%E3%81%AE%E3%83%9A%E3%82%A2%E3%81%AB%E3%81%AF%E5%85%88%E9%A0%AD%E3%81%AE%E8%A6%81%E7%B4%A0%E3%81%A8%E3%83%9A%E3%82%A2%E3%81%AB%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eパターン2：最後の要素のペアには先頭の要素とペアにしたい場合\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"kt\"\u003eArray\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003epair\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"kt\"\u003eElement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eElement\u003c/span\u003e\u003cspan class=\"p\"\u003e)]?\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ecopy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eElement\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003efirst\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efirst\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e// このguard文で早期リターンさせないと空の配列が来たときに実行時エラーになる\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 空配列を返却してもよいがpairが作れなかったという意味も込めてnilを返す\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecopy\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eenumerated\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecopy\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoffset\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enums\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"n\"\u003enums\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epair\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eforEach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e * \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e = \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 1 * 2 = 2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 2 * 3 = 6\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 3 * 1 = 3 ← 最後のペアには先頭の要素が入る\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\u003cspan class=\"n\"\u003eempty\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epair\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eforEach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e * \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e = \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// なし\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"パターン3最後の要素のペアを自由に変更させたい場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B33%E6%9C%80%E5%BE%8C%E3%81%AE%E8%A6%81%E7%B4%A0%E3%81%AE%E3%83%9A%E3%82%A2%E3%82%92%E8%87%AA%E7%94%B1%E3%81%AB%E5%A4%89%E6%9B%B4%E3%81%95%E3%81%9B%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eパターン3：最後の要素のペアを自由に変更させたい場合\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"kt\"\u003eArray\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003epair\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003elastPairIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"kt\"\u003eElement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eElement\u003c/span\u003e\u003cspan class=\"p\"\u003e?)]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ecopy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eElement\u003c/span\u003e\u003cspan class=\"p\"\u003e?]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\n        \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003elastPair\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eElement\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003elastPairIndex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elastPairIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eindices\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003econtains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elastPairIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elastPair\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003elastPairIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elastPair\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecopy\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elastPair\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nf\"\u003eenumerated\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecopy\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoffset\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enums\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"n\"\u003enums\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epair\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003elastPairIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eforEach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enum2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e * \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e = \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 1 * 2 = 2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 2 * 3 = 6\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003enums\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epair\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eforEach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enum2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e * \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e = \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 1 * 2 = 2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 2 * 3 = 6\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 3 * 1 = 3\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// こういうこと（最後は最後の値とペアになる）も可能\u003c/span\u003e\n\u003cspan class=\"n\"\u003enums\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epair\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003elastPairIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enums\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eindices\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elast\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eforEach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enum2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e * \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e = \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 1 * 2 = 2\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 2 * 3 = 6\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 3 * 3 = 9 ← 最後は最後の値とペアになる\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\u003cspan class=\"n\"\u003eempty\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epair\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eforEach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enum2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e * \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e = \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// なし\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eempty\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epair\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003elastPairIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eforEach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enum2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e * \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e = \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// なし\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// こいうことしてもエラーにはならない\u003c/span\u003e\n\u003cspan class=\"n\"\u003eempty\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epair\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003elastPairIndex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eforEach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enum2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enum2\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e * \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e = \u003c/span\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e\u003cspan class=\"n\"\u003enum1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 出力\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// なし\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"さいごに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eさいごに\u003c/h1\u003e\n\n\u003cp\u003eArray の Array[Index] でのアクセスは実行時まで、エラーに気づかないので \u003ccode\u003eself.indices.contains(Index)\u003c/code\u003e で Index が存在することを確認してからアクセスした方がいいです。\u003c/p\u003e\n\n\u003cp\u003eというよりも、そのようなアクセスをする処理を書かないのがベターです。\u003c/p\u003e\n","body":"\n# はじめに\n\n[配列を処理するときに次の要素を扱う方法](https://qiita.com/akeome/items/514c077cfc460d7d2382)の記事を参考にいろいろとアレンジしてみました。\nまた、空配列がやってきたりして、ペアの生成に失敗したときにエラーにならないことも確認しながら書いてみました。\n\n## パターン1：最後の要素のペアにはnilを入れたい場合\n\n```swift\nextension Array {\n    var pair: [(Element, Element?)] {\n        var copy: [Element?] = self\n        copy.append(nil)\n        return enumerated().map { ($0.element, copy[$0.offset + 1]) }\n    }\n}\n\nlet nums = [1,2,3]\nnums.pair.forEach { num1, num2 in\n    guard let num2 = num2 else {\n        return\n    }\n    print(\"\\(num1) * \\(num2) = \\(num1 * (num2))\")\n}\n//  出力\n//  1 * 2 = 2\n//  2 * 3 = 6\n\nlet empty: [Int]  = []\nempty.pair.forEach { num1, num2 in\n    guard let num2 = num2 else {\n        return\n    }\n    print(\"\\(num1) * \\(num2) = \\(num1 * (num2))\")\n}\n//  出力\n//  なし\n```\n\n## パターン2：最後の要素のペアには先頭の要素とペアにしたい場合\n\n```swift\nextension Array {\n    var pair: [(Element, Element)]? {\n        var copy: [Element] = self\n        guard let first = self.first else { // このguard文で早期リターンさせないと空の配列が来たときに実行時エラーになる\n            return nil // 空配列を返却してもよいがpairが作れなかったという意味も込めてnilを返す\n        }\n        copy.append(first)\n        return enumerated().map { ($0.element, copy[$0.offset + 1]) }\n    }\n}\n\nlet nums = [1,2,3]\nnums.pair?.forEach { num1, num2 in\n    print(\"\\(num1) * \\(num2) = \\(num1 * (num2))\")\n}\n// 出力\n// 1 * 2 = 2\n// 2 * 3 = 6\n// 3 * 1 = 3 ← 最後のペアには先頭の要素が入る\n\nlet empty: [Int]  = []\nempty.pair?.forEach { num1, num2 in\n    print(\"\\(num1) * \\(num2) = \\(num1 * (num2))\")\n}\n// 出力\n// なし\n```\n\n## パターン3：最後の要素のペアを自由に変更させたい場合\n\n```swift\nextension Array {\n    func pair(lastPairIndex: Int? = 0) -\u003e [(Element, Element?)] {\n        var copy: [Element?] = self\n        var lastPair: Element?\n        if let lastPairIndex = lastPairIndex, self.indices.contains(lastPairIndex) {\n            lastPair = self[lastPairIndex]\n        } else {\n            lastPair = nil\n        }\n        copy.append(lastPair)\n        return enumerated().map { ($0.element, copy[$0.offset + 1]) }\n    }\n}\n\nlet nums = [1,2,3]\nnums.pair(lastPairIndex: nil).forEach { num1, num2 in\n    guard let num2 = num2 else {\n        return\n    }\n    print(\"\\(num1) * \\(num2) = \\(num1 * (num2))\")\n}\n// 出力\n// 1 * 2 = 2\n// 2 * 3 = 6\n\nnums.pair().forEach { num1, num2 in\n    guard let num2 = num2 else {\n        return\n    }\n    print(\"\\(num1) * \\(num2) = \\(num1 * (num2))\")\n}\n// 出力\n// 1 * 2 = 2\n// 2 * 3 = 6\n// 3 * 1 = 3\n\n// こういうこと（最後は最後の値とペアになる）も可能\nnums.pair(lastPairIndex: nums.indices.last).forEach { num1, num2 in\n    guard let num2 = num2 else {\n        return\n    }\n    print(\"\\(num1) * \\(num2) = \\(num1 * (num2))\")\n}\n// 出力\n// 1 * 2 = 2\n// 2 * 3 = 6\n// 3 * 3 = 9 ← 最後は最後の値とペアになる\n\n\nlet empty: [Int]  = []\nempty.pair().forEach { num1, num2 in\n    guard let num2 = num2 else {\n        return\n    }\n    print(\"\\(num1) * \\(num2) = \\(num1 * (num2))\")\n}\n// 出力\n// なし\n\nempty.pair(lastPairIndex: nil).forEach { num1, num2 in\n    guard let num2 = num2 else {\n        return\n    }\n    print(\"\\(num1) * \\(num2) = \\(num1 * (num2))\")\n}\n// 出力\n// なし\n\n// こいうことしてもエラーにはならない\nempty.pair(lastPairIndex: 100).forEach { num1, num2 in\n    guard let num2 = num2 else {\n        return\n    }\n    print(\"\\(num1) * \\(num2) = \\(num1 * (num2))\")\n}\n// 出力\n// なし\n```\n\n# さいごに\n\nArray の Array[Index] でのアクセスは実行時まで、エラーに気づかないので `self.indices.contains(Index)` で Index が存在することを確認してからアクセスした方がいいです。\n\nというよりも、そのようなアクセスをする処理を書かないのがベターです。\n","coediting":false,"comments_count":0,"created_at":"2021-08-23T10:13:14+09:00","group":null,"id":"36f3222b166716c889ad","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Swift","versions":[]}],"title":"【Swift】配列をペアに変換して処理する方法","updated_at":"2021-08-26T17:08:52+09:00","url":"https://qiita.com/ikuraikura/items/36f3222b166716c889ad","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eよく Array の contains の挙動について忘れるので、まとめてみました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"基本的な挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e基本的な挙動\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// （基本形の挙動）クロージャーの返りがひとつでもtrueが含まれればtrueを返却する\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econtains\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ture\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econtains\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// （備考）空配列の場合はクロージャーを1周も通過しないため必ずfalseを返す（はず）\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econtains\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econtains\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"以下-0を含むか-のいろいろな書き方-全部同じ意味のはず\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%A5%E4%B8%8B-0%E3%82%92%E5%90%AB%E3%82%80%E3%81%8B-%E3%81%AE%E3%81%84%E3%82%8D%E3%81%84%E3%82%8D%E3%81%AA%E6%9B%B8%E3%81%8D%E6%96%B9-%E5%85%A8%E9%83%A8%E5%90%8C%E3%81%98%E6%84%8F%E5%91%B3%E3%81%AE%E3%81%AF%E3%81%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e以下、 0を含むか？ のいろいろな書き方 （全部同じ意味のはず）\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// (1) 一番長いタイプ\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003econtains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ewhere\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e}))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003econtains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ewhere\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e}))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// (2) 引数を省略\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003econtains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ewhere\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e}))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003econtains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ewhere\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e}))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// (3) whereを省略\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econtains\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econtains\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// (4) whereを省略かつ引数を省略 ← 迷ったらこれにしてます\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econtains\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econtains\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// (5) クロージャーを省略\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003econtains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true\u003c/span\u003e\n\u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003econtains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"さいごに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eさいごに\u003c/h1\u003e\n\n\u003cp\u003econtains は結構便利！！\u003c/p\u003e\n","body":"\n# はじめに\n\nよく Array の contains の挙動について忘れるので、まとめてみました。\n\n## 基本的な挙動\n\n```swift\n// （基本形の挙動）クロージャーの返りがひとつでもtrueが含まれればtrueを返却する\nprint([0,1].contains { _ in true }) // ture\nprint([2,3].contains { _ in false }) // false\n\n// （備考）空配列の場合はクロージャーを1周も通過しないため必ずfalseを返す（はず）\nprint([].contains { _ in true }) // false\nprint([].contains { _ in false }) // false\n```\n\n## 以下、 0を含むか？ のいろいろな書き方 （全部同じ意味のはず）\n\n```swift\n// (1) 一番長いタイプ\nprint([0,1].contains(where: { num in num == 0 })) // true\nprint([2,3].contains(where: { num in num == 0 })) // false\n\n// (2) 引数を省略\nprint([0,1].contains(where: { $0 == 0 })) // true\nprint([2,3].contains(where: { $0 == 0 })) // false\n\n// (3) whereを省略\nprint([0,1].contains { num in num == 0 }) // true\nprint([2,3].contains { num in num == 0 }) // false\n\n// (4) whereを省略かつ引数を省略 ← 迷ったらこれにしてます\nprint([0,1].contains { $0 == 0 }) // true\nprint([2,3].contains { $0 == 0 }) // false\n\n// (5) クロージャーを省略\nprint([0,1].contains(0)) // true\nprint([2,3].contains(0)) // false\n```\n\n# さいごに\n\ncontains は結構便利！！\n","coediting":false,"comments_count":0,"created_at":"2021-08-23T09:37:25+09:00","group":null,"id":"42f2c1079316fa175afb","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Swift","versions":[]}],"title":"【Swift】Array の contains の挙動の整理","updated_at":"2021-08-23T09:37:58+09:00","url":"https://qiita.com/ikuraikura/items/42f2c1079316fa175afb","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h1\u003e\n\n\u003cp\u003eタイトルのとおりです。\u003c/p\u003e\n\n\u003cp\u003eサンプルを見ればわかると思います。\u003c/p\u003e\n\n\u003cp\u003eいろいろ探したのですが、このケースについて解説している記事がなかったので、Playground で実際にコーディングして挙動をまとめてみました。\u003c/p\u003e\n\n\u003cp\u003e環境は Xcode 12.5.1 になります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"基本編\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9F%BA%E6%9C%AC%E7%B7%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e基本編\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"サンプル\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eサンプル\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"kt\"\u003eFoundation\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eenum\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eError\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003elargeError\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003esmallError\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003esixError\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003emethodA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethrows\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elargeError\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003emethodB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethrows\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esmallError\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003emethodC\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethrows\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"nf\"\u003emethodA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// throws 関数のなかで throws 関数を呼び出す ← こいつ\u003c/span\u003e\n    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"nf\"\u003emethodB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// throws 関数のなかで throws 関数を呼び出す ← こいつ\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esixError\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003emethodD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"nf\"\u003emethodC\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 通常の関数のなかで throws 関数を呼び出す ← いつもの\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"このときの挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%AE%E3%81%A8%E3%81%8D%E3%81%AE%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこのときの挙動\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nf\"\u003emethodD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// largeError\u003c/span\u003e\n\u003cspan class=\"nf\"\u003emethodD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// smallError\u003c/span\u003e\n\u003cspan class=\"nf\"\u003emethodD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// sixError\u003c/span\u003e\n\u003cspan class=\"nf\"\u003emethodD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 7\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ポイント\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eポイント\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003emethodC で methodA や methodB のエラーを methodC 内で \u003ccode\u003ethrow\u003c/code\u003e しなくても methodD 側までエラーを飛ばしてくれる\u003c/li\u003e\n\u003cli\u003emethodC で methodA や methodB の \u003ccode\u003edo-catch\u003c/code\u003e は記述しなくてもコンパイルエラーにならない\u003c/li\u003e\n\u003cli\u003eただし、methodA や　methodB の前に \u003ccode\u003etry\u003c/code\u003e はつけないとコンパイルエラーとなる\u003c/li\u003e\n\u003cli\u003emethodC ならではのエラーを飛ばす場合は、普通に \u003ccode\u003ethrow\u003c/code\u003e すればよい（\u003ccode\u003ethrow TestError.sixError\u003c/code\u003e のところ）\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003erethrows\u003c/code\u003e はクロージャーで発生したエラーに関するハンドリングをいい感じにするやつなので、これとはあんまり関係ない（\u003ca href=\"https://swift.codelly.dev/guide/%E3%82%A8%E3%83%A9%E3%83%BC%E5%87%A6%E7%90%86/#rethrows\" rel=\"nofollow noopener\" target=\"_blank\"\u003erethrows のわかりやすい記事\u003c/a\u003e）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"応用編\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%9C%E7%94%A8%E7%B7%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e応用編\u003c/h2\u003e\n\n\u003cp\u003emethodA や methodB も methodC 内で \u003ccode\u003edo-catch\u003c/code\u003e で囲むことで、別のエラーとして \u003ccode\u003ethrow\u003c/code\u003e することが可能です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"サンプル-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eサンプル\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"kt\"\u003eFoundation\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eenum\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eError\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003elargeError\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003esmallError\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003esixError\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003ewrapError\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ← 追加\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003emethodA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethrows\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elargeError\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003emethodB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethrows\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esmallError\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003emethodC\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethrows\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"nf\"\u003emethodA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"nf\"\u003emethodB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// methodB を do-catch で囲む\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewrapError\u003c/span\u003e \u003cspan class=\"c1\"\u003e// methodB のエラーを wrapError に変換\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"kt\"\u003eTestError\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esixError\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003emethodD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"nf\"\u003emethodC\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"このときの挙動-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%AE%E3%81%A8%E3%81%8D%E3%81%AE%E6%8C%99%E5%8B%95-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこのときの挙動\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"swift\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nf\"\u003emethodD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// largeError\u003c/span\u003e\n\u003cspan class=\"nf\"\u003emethodD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// wrapError ← smallError から変更されている\u003c/span\u003e\n\u003cspan class=\"nf\"\u003emethodD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// sixError\u003c/span\u003e\n\u003cspan class=\"nf\"\u003emethodD\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003enum\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 7\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ポイント-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eポイント\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003emethodA や methodB も methodC 内で \u003ccode\u003edo-catch\u003c/code\u003e で囲むことで、別のエラーとして \u003ccode\u003ethrow\u003c/code\u003e することが可能（＝ エラーの置き換えが可能）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003e記事を探すよりも Playground でコーディングしたほうが早いこともある\u003c/p\u003e\n","body":"# 概要\n\nタイトルのとおりです。\n\nサンプルを見ればわかると思います。\n\nいろいろ探したのですが、このケースについて解説している記事がなかったので、Playground で実際にコーディングして挙動をまとめてみました。\n\n環境は Xcode 12.5.1 になります。\n\n## 基本編\n\n### サンプル\n\n```swift\nimport Foundation\n\nenum TestError: Error {\n    case largeError\n    case smallError\n    case sixError\n}\n\nfunc methodA(num: Int) throws -\u003e Int {\n    if num \u003e 8 {\n        throw TestError.largeError\n    }\n    return num\n}\n\nfunc methodB(num: Int) throws -\u003e Int {\n    if num \u003c 4 {\n        throw TestError.smallError\n    }\n    return num\n}\n\n\nfunc methodC(num: Int) throws -\u003e Int {\n    let _ = try methodA(num: num) // throws 関数のなかで throws 関数を呼び出す ← こいつ\n    let _ = try methodB(num: num) // throws 関数のなかで throws 関数を呼び出す ← こいつ\n    if num == 6 {\n        throw TestError.sixError\n    }\n    return num\n}\n\nfunc methodD(num: Int) {\n    do {\n        let c = try methodC(num: num) // 通常の関数のなかで throws 関数を呼び出す ← いつもの\n        print(c)\n    } catch {\n        print(error)\n    }\n}\n```\n\n### このときの挙動\n\n```swift\nmethodD(num: 9) // largeError\nmethodD(num: 3) // smallError\nmethodD(num: 6) // sixError\nmethodD(num: 7) // 7\n```\n\n### ポイント\n\n- methodC で methodA や methodB のエラーを methodC 内で `throw` しなくても methodD 側までエラーを飛ばしてくれる\n- methodC で methodA や methodB の `do-catch` は記述しなくてもコンパイルエラーにならない\n- ただし、methodA や　methodB の前に `try` はつけないとコンパイルエラーとなる\n- methodC ならではのエラーを飛ばす場合は、普通に `throw` すればよい（`throw TestError.sixError` のところ）\n- `rethrows` はクロージャーで発生したエラーに関するハンドリングをいい感じにするやつなので、これとはあんまり関係ない（[rethrows のわかりやすい記事](https://swift.codelly.dev/guide/%E3%82%A8%E3%83%A9%E3%83%BC%E5%87%A6%E7%90%86/#rethrows)）\n\n\n## 応用編\n\nmethodA や methodB も methodC 内で `do-catch` で囲むことで、別のエラーとして `throw` することが可能です。\n\n### サンプル\n\n```swift\nimport Foundation\n\nenum TestError: Error {\n    case largeError\n    case smallError\n    case sixError\n    case wrapError // ← 追加\n}\n\nfunc methodA(num: Int) throws -\u003e Int {\n    if num \u003e 8 {\n        throw TestError.largeError\n    }\n    return num\n}\n\nfunc methodB(num: Int) throws -\u003e Int {\n    if num \u003c 4 {\n        throw TestError.smallError\n    }\n    return num\n}\n\nfunc methodC(num: Int) throws -\u003e Int {\n    let _ = try methodA(num: num)\n    do {\n        let _ = try methodB(num: num) // methodB を do-catch で囲む\n    } catch {\n        throw TestError.wrapError // methodB のエラーを wrapError に変換\n    }\n    if num == 6 {\n        throw TestError.sixError\n    }\n    return num\n}\n\nfunc methodD(num: Int) {\n    do {\n        let c = try methodC(num: num)\n        print(c)\n    } catch {\n        print(error)\n    }\n}\n```\n\n### このときの挙動\n\n```swift\nmethodD(num: 9) // largeError\nmethodD(num: 3) // wrapError ← smallError から変更されている\nmethodD(num: 6) // sixError\nmethodD(num: 7) // 7\n```\n\n### ポイント\n\n- methodA や methodB も methodC 内で `do-catch` で囲むことで、別のエラーとして `throw` することが可能（＝ エラーの置き換えが可能）\n\n# まとめ\n\n記事を探すよりも Playground でコーディングしたほうが早いこともある\n","coediting":false,"comments_count":0,"created_at":"2021-08-03T23:21:54+09:00","group":null,"id":"9a552356814f97c4251b","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Swift","versions":[]}],"title":"【Swift】throws 関数の中で throws 関数を呼び出したときの挙動【エラー処理】","updated_at":"2021-08-04T07:17:06+09:00","url":"https://qiita.com/ikuraikura/items/9a552356814f97c4251b","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"問題です\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%95%8F%E9%A1%8C%E3%81%A7%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e問題です\u003c/h1\u003e\n\n\u003cp\u003e現在、 \u003ccode\u003eコミットID_1\u003c/code\u003e の \u003ccode\u003edevelop\u003c/code\u003e ブランチから別のブランチである \u003ccode\u003efeature/hogehoge\u003c/code\u003e ブランチを派生させて \u003ccode\u003eコミットID_2\u003c/code\u003e → \u003ccode\u003eコミットID_3\u003c/code\u003e → \u003ccode\u003eコミットID_4\u003c/code\u003e の順に修正をコミットし、\u003ccode\u003efeature/hogehoge\u003c/code\u003e ブランチをリモートブランチにプッシュしています。\u003c/p\u003e\n\n\u003cp\u003eこの状態で \u003ccode\u003eコミットID_2\u003c/code\u003e 〜 \u003ccode\u003eコミットID_4\u003c/code\u003e のコミットをまとめたい場合どのようにすればよいでしょうか？\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eつまり、これを\u003c/strong\u003e\u003cbr\u003e\n\u003ccode\u003eコミット1（develop ブランチ）\u003c/code\u003e → \u003ccode\u003eコミット2（feature/hogehoge ブランチ）\u003c/code\u003e → \u003ccode\u003eコミット3（feature/hogehoge ブランチ）\u003c/code\u003e → \u003ccode\u003eコミット4（feature/hogehoge ブランチ）\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eこうしたい\u003c/strong\u003e\u003cbr\u003e\n\u003ccode\u003eコミット1（develop ブランチ）\u003c/code\u003e → \u003ccode\u003eコミット2〜4（feature/hogehoge ブランチ）\u003c/code\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"答え\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%AD%94%E3%81%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e答え\u003c/h1\u003e\n\n\u003col\u003e\n\u003cli\u003e対象のブランチにチェクアウトして \u003ccode\u003egit log --oneline\u003c/code\u003e で rebase 元になるコミット ID を探す\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003egit rebase -i \u0026lt;コミット ID\u0026gt;\u003c/code\u003e で rebase を実行する\u003c/li\u003e\n\u003cli\u003eEdit モードで rebase 指示書を修正する\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003egit push --force-with-lease origin HEAD\u003c/code\u003e で強制プッシュする\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"1-git-log---oneline-で-rebase-元になるコミット-id-を探す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-git-log---oneline-%E3%81%A7-rebase-%E5%85%83%E3%81%AB%E3%81%AA%E3%82%8B%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88-id-%E3%82%92%E6%8E%A2%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. \u003ccode\u003egit log --oneline\u003c/code\u003e で rebase 元になるコミット ID を探す\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit checkout feature/hogehoge\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit log \u003cspan class=\"nt\"\u003e--oneline\u003c/span\u003e\n\nコミットID_4 \u003cspan class=\"o\"\u003e(\u003c/span\u003eHEAD -\u0026gt; feature/hogehoge, origin/feature/hogehoge\u003cspan class=\"o\"\u003e)\u003c/span\u003eコミットメッセージ_4\nコミットID_3 コミットメッセージ_3\nコミットID_2 コミットメッセージ_2\nコミットID_1 \u003cspan class=\"o\"\u003e(\u003c/span\u003eorigin/develop, origin/HEAD, develop\u003cspan class=\"o\"\u003e)\u003c/span\u003e コミットメッセージ_1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-git-rebase--i-コミット-id-で-rebase-を実行する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-git-rebase--i-%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88-id-%E3%81%A7-rebase-%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. \u003ccode\u003egit rebase -i \u0026lt;コミット ID\u0026gt;\u003c/code\u003e で rebase を実行する\u003c/h2\u003e\n\n\u003cp\u003eまとめるコミット ID の1つ前を指定して、\u003ccode\u003egit rebase -i\u003c/code\u003e を実行します。\u003cbr\u003e\n今回の場合は \u003ccode\u003eコミットID_2\u003c/code\u003e 〜 \u003ccode\u003eコミットID_4\u003c/code\u003e をまとめるので \u003ccode\u003eコミットID_1\u003c/code\u003e を指定します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit rebase \u003cspan class=\"nt\"\u003e-i\u003c/span\u003e コミットID_1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"3-edit-モードで-rebase-指示書を修正する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-edit-%E3%83%A2%E3%83%BC%E3%83%89%E3%81%A7-rebase-%E6%8C%87%E7%A4%BA%E6%9B%B8%E3%82%92%E4%BF%AE%E6%AD%A3%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. Edit モードで rebase 指示書を修正する\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003egit rebase -i\u003c/code\u003e を実行すると Edit モードで以下のような表示が出現します。\u003cbr\u003e\nここで表示されるのは \u003ccode\u003eコミットID_1\u003c/code\u003e からみて時系列順でコミットが上から並んでいます（\u003ccode\u003egit log --oneline\u003c/code\u003eとは逆順のはず）。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003epick コミットID_2 コミットメッセージ_2\npick コミットID_3 コミットメッセージ_3\npick コミットID_4 コミットメッセージ_4\n\n\u003cspan class=\"c\"\u003e# Rebase xxxxx..yyyyy onto zzzzzz\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# Commands:\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# p, pick \u0026lt;commit\u0026gt; = use commit\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# r, reword \u0026lt;commit\u0026gt; = use commit, but edit the commit message\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# e, edit \u0026lt;commit\u0026gt; = use commit, but stop for amending\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# s, squash \u0026lt;commit\u0026gt; = use commit, but meld into previous commit\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# f, fixup \u0026lt;commit\u0026gt; = like \"squash\", but discard this commit's log message\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# x, exec \u0026lt;command\u0026gt; = run command (the rest of the line) using shell\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# b, break = stop here (continue rebase later with 'git rebase --continue')\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# d, drop \u0026lt;commit\u0026gt; = remove commit\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# l, label \u0026lt;label\u0026gt; = label current HEAD with a name\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# t, reset \u0026lt;label\u0026gt; = reset HEAD to a label\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# m, merge [-C \u0026lt;commit\u0026gt; | -c \u0026lt;commit\u0026gt;] \u0026lt;label\u0026gt; [# \u0026lt;oneline\u0026gt;]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e今回は \u003ccode\u003eコミットID_2\u003c/code\u003e に \u003ccode\u003eコミットID_3\u003c/code\u003e と \u003ccode\u003eコミットID_4\u003c/code\u003e をまとめる方法を選択します（\u003ccode\u003eコミットID_4\u003c/code\u003e にまとめる方法はないはずです。）。\u003cbr\u003e\n省略形の \u003ccode\u003ep\u003c/code\u003e とか \u003ccode\u003er\u003c/code\u003e とか \u003ccode\u003ef\u003c/code\u003e を指定することが多いはずです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eコミットメッセージ修正しない場合\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ep コミットID_2 コミットメッセージ_2\nf コミットID_3 コミットメッセージ_3\nf コミットID_4 コミットメッセージ_4\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eEdit モードを \u003ccode\u003e:wq\u003c/code\u003e でセーブして抜けて rebase がうまくいくと以下が出力されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eSuccessfully rebased and updated refs/heads/feature/hogehoge.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれで rebase は完了です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"コミットメッセージを修正する場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%92%E4%BF%AE%E6%AD%A3%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコミットメッセージを修正する場合\u003c/h3\u003e\n\n\u003cp\u003e多くの場合はコミットメッセージを修正するので、rebase 指示書を以下のようにします。（\u003ccode\u003er\u003c/code\u003e がポイント）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eコミットメッセージ修正する場合\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003er コミットID_2 コミットメッセージ_2\nf コミットID_3 コミットメッセージ_3\nf コミットID_4 コミットメッセージ_4\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eEdit モードを \u003ccode\u003e:wq\u003c/code\u003e でセーブして抜けるとコミットメッセージの修正が求められます。\u003c/p\u003e\n\n\u003cp\u003eそれも\u003ccode\u003e:wq\u003c/code\u003e でセーブして抜けると、以下のような表示がされるので、\u003ccode\u003egit rebase --continue\u003c/code\u003e してrebase を進めてください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eAborting commit due to empty commit message.\nYou can amend the commit now, with\n\n  git commit \u003cspan class=\"nt\"\u003e--amend\u003c/span\u003e \n\nOnce you are satisfied with your changes, run\n\n  git rebase \u003cspan class=\"nt\"\u003e--continue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"4-git-push---force-with-lease-origin-head-で強制プッシュする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-git-push---force-with-lease-origin-head-%E3%81%A7%E5%BC%B7%E5%88%B6%E3%83%97%E3%83%83%E3%82%B7%E3%83%A5%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4. \u003ccode\u003egit push --force-with-lease origin HEAD\u003c/code\u003e で強制プッシュする\u003c/h2\u003e\n\n\u003cp\u003e強制プッシュします。\u003cbr\u003e\nこのときに作業中のブランチが間違っていないかは確認したほうがいいです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit push \u003cspan class=\"nt\"\u003e--force-with-lease\u003c/span\u003e origin HEAD\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"番外編-rebase-中に操作ミスした場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%95%AA%E5%A4%96%E7%B7%A8-rebase-%E4%B8%AD%E3%81%AB%E6%93%8D%E4%BD%9C%E3%83%9F%E3%82%B9%E3%81%97%E3%81%9F%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e（番外編） rebase 中に操作ミスした場合\u003c/h2\u003e\n\n\u003cp\u003e以下を実行すると \u003ccode\u003egit rebase -i\u003c/code\u003e 実行前に戻るはずです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bash\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit rebase \u003cspan class=\"nt\"\u003e--abort\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"\n# 問題です\n現在、 `コミットID_1` の `develop` ブランチから別のブランチである `feature/hogehoge` ブランチを派生させて `コミットID_2` → `コミットID_3` → `コミットID_4` の順に修正をコミットし、`feature/hogehoge` ブランチをリモートブランチにプッシュしています。\n\nこの状態で `コミットID_2` 〜 `コミットID_4` のコミットをまとめたい場合どのようにすればよいでしょうか？\n\n**つまり、これを**\n`コミット1（develop ブランチ）` → `コミット2（feature/hogehoge ブランチ）` → `コミット3（feature/hogehoge ブランチ）` → `コミット4（feature/hogehoge ブランチ）`\n\n**こうしたい**\n`コミット1（develop ブランチ）` → `コミット2〜4（feature/hogehoge ブランチ）`\n\n\n# 答え\n\n1. 対象のブランチにチェクアウトして `git log --oneline` で rebase 元になるコミット ID を探す\n1. `git rebase -i \u003cコミット ID\u003e` で rebase を実行する\n1. Edit モードで rebase 指示書を修正する\n1. `git push --force-with-lease origin HEAD` で強制プッシュする\n\n## 1. `git log --oneline` で rebase 元になるコミット ID を探す\n\n```bash\n$ git checkout feature/hogehoge\n$ git log --oneline\n\nコミットID_4 (HEAD -\u003e feature/hogehoge, origin/feature/hogehoge)コミットメッセージ_4\nコミットID_3 コミットメッセージ_3\nコミットID_2 コミットメッセージ_2\nコミットID_1 (origin/develop, origin/HEAD, develop) コミットメッセージ_1\n```\n\n## 2. `git rebase -i \u003cコミット ID\u003e` で rebase を実行する\n\nまとめるコミット ID の1つ前を指定して、`git rebase -i` を実行します。\n今回の場合は `コミットID_2` 〜 `コミットID_4` をまとめるので `コミットID_1` を指定します。\n\n```bash\n$ git rebase -i コミットID_1\n```\n\n## 3. Edit モードで rebase 指示書を修正する\n\n`git rebase -i` を実行すると Edit モードで以下のような表示が出現します。\nここで表示されるのは `コミットID_1` からみて時系列順でコミットが上から並んでいます（`git log --oneline`とは逆順のはず）。\n\n```bash\npick コミットID_2 コミットメッセージ_2\npick コミットID_3 コミットメッセージ_3\npick コミットID_4 コミットメッセージ_4\n\n# Rebase xxxxx..yyyyy onto zzzzzz\n#\n# Commands:\n# p, pick \u003ccommit\u003e = use commit\n# r, reword \u003ccommit\u003e = use commit, but edit the commit message\n# e, edit \u003ccommit\u003e = use commit, but stop for amending\n# s, squash \u003ccommit\u003e = use commit, but meld into previous commit\n# f, fixup \u003ccommit\u003e = like \"squash\", but discard this commit's log message\n# x, exec \u003ccommand\u003e = run command (the rest of the line) using shell\n# b, break = stop here (continue rebase later with 'git rebase --continue')\n# d, drop \u003ccommit\u003e = remove commit\n# l, label \u003clabel\u003e = label current HEAD with a name\n# t, reset \u003clabel\u003e = reset HEAD to a label\n# m, merge [-C \u003ccommit\u003e | -c \u003ccommit\u003e] \u003clabel\u003e [# \u003coneline\u003e]\n```\n\n今回は `コミットID_2` に `コミットID_3` と `コミットID_4` をまとめる方法を選択します（`コミットID_4` にまとめる方法はないはずです。）。\n省略形の `p` とか `r` とか `f` を指定することが多いはずです。\n\n```bash:コミットメッセージ修正しない場合\np コミットID_2 コミットメッセージ_2\nf コミットID_3 コミットメッセージ_3\nf コミットID_4 コミットメッセージ_4\n```\n\nEdit モードを `:wq` でセーブして抜けて rebase がうまくいくと以下が出力されます。\n\n```bash\nSuccessfully rebased and updated refs/heads/feature/hogehoge.\n```\n\nこれで rebase は完了です。\n\n### コミットメッセージを修正する場合\n\n多くの場合はコミットメッセージを修正するので、rebase 指示書を以下のようにします。（`r` がポイント）\n\n```bash:コミットメッセージ修正する場合\nr コミットID_2 コミットメッセージ_2\nf コミットID_3 コミットメッセージ_3\nf コミットID_4 コミットメッセージ_4\n```\n\nEdit モードを `:wq` でセーブして抜けるとコミットメッセージの修正が求められます。\n\nそれも`:wq` でセーブして抜けると、以下のような表示がされるので、`git rebase --continue` してrebase を進めてください。\n\n```bash\nAborting commit due to empty commit message.\nYou can amend the commit now, with\n\n  git commit --amend \n\nOnce you are satisfied with your changes, run\n\n  git rebase --continue\n```\n\n## 4. `git push --force-with-lease origin HEAD` で強制プッシュする\n\n強制プッシュします。\nこのときに作業中のブランチが間違っていないかは確認したほうがいいです。\n\n```bash\n$ git push --force-with-lease origin HEAD\n```\n\n\n\n## （番外編） rebase 中に操作ミスした場合\n\n以下を実行すると `git rebase -i` 実行前に戻るはずです。\n\n```bash\n$ git rebase --abort\n```\n","coediting":false,"comments_count":0,"created_at":"2021-07-13T13:56:35+09:00","group":null,"id":"5e63bc46a1ff3f2cce5c","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Git","versions":[]},{"name":"GitHub","versions":[]}],"title":"コミットをまとめる方法（git rebase -i）","updated_at":"2021-12-23T16:24:15+09:00","url":"https://qiita.com/ikuraikura/items/5e63bc46a1ff3f2cce5c","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eFlutter が本格的に流行ってきたので、勉強のため、架空のショッピングアプリの開発を Flutter を用いて開発してみました。\u003cbr\u003e\nそこで得られた知見をまとめたいと思います。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"開発したアプリの概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%8B%E7%99%BA%E3%81%97%E3%81%9F%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e開発したアプリの概要\u003c/h1\u003e\n\n\u003cp\u003e開発するアプリとして架空の飲食店または小売店での注文アプリを作成しました。\u003cbr\u003e\nこの手のアプリの中ではマクドナルドのオーダーアプリがかなりよくできていたので、それを参考にして作成しました。\u003c/p\u003e\n\n\u003cp\u003eFlutter の勉強が主な目的ですが、相性の良い Firebase の機能も試してみたかったので、店舗情報、商品情報、注文履歴などのデータはアプリ内で固定値で持たずに Firestore に格納するようにしました。\u003c/p\u003e\n\n\u003cp\u003eただし、商品マスタ登録、店舗マスタ登録や商品在庫といった運用の考慮どはしていません。\u003cbr\u003e\nまた、決済機能は実装対象外としました。\u003c/p\u003e\n\n\u003cp\u003e最終的な画面数は 10 画面。\u003cbr\u003e\n実装期間は土日を 2 ヶ月間ほどです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"アーキテクチャ全体\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3%E5%85%A8%E4%BD%93\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアーキテクチャ（全体）\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/e7153571c948849eab7dca827c56993a851b327f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f61303461666134362d313266352d613735392d383637352d3130663439653834376363622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fa04afa46-12f5-a759-8675-10f49e847ccb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2a4187eb76a2c49778b4b982cf275cbe\" alt=\"a.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/a04afa46-12f5-a759-8675-10f49e847ccb.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fa04afa46-12f5-a759-8675-10f49e847ccb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f5961ee9670bf3aa618ff9279ec95989 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"アーキテクチャcicd\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3cicd\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアーキテクチャ（CI/CD）\u003c/h1\u003e\n\n\u003cp\u003e今回作ったアプリでは CI/CD はストアリリースまでではなく、開発中の内部でのテストアプリ配信を想定して構築しました。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/78841031d82667b2057ca1570857ab7f3f27340e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f63333035393261392d313632382d663039362d663332362d3732373238613261633461372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fc30592a9-1628-f096-f326-72728a2ac4a7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=595a414a483ce14faa62e4599ec38d75\" alt=\"b.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/c30592a9-1628-f096-f326-72728a2ac4a7.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fc30592a9-1628-f096-f326-72728a2ac4a7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d1de5ee3335ca83716f7390ef8ccee6d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003edevelop ブランチへの Push をトリガーに Codemagic 経由で App Store（TestFlight）と Google Play Console（内部テスト）に配信するところまでを作成しました。\u003cbr\u003e\nちなみに、いきなりこのようになったのではなく、以下の経緯を経てこのような形に落ち着きました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e第一形態：手動で .ipa や .apk ファイルを Firebase App Distribution にアップロードして配信\n\n\u003cul\u003e\n\u003cli\u003e手動で配信するのはダサかったので Fastlane を採用することに。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e第二形態：コマンドラインから Fastlane を使って Firebase App Distribution で配信\n\n\u003cul\u003e\n\u003cli\u003eどうせなら GitHub での Push をトリガーに配布したく CI/CD のサービスを検討。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e第三形態：Bitrise で Fastlane を使って Firebase App Distribution で配信\n\n\u003cul\u003e\n\u003cli\u003eモバイルアプリ開発における CI/CD デファクトスタンダードの Bitrise を採用。\u003c/li\u003e\n\u003cli\u003eBitrise の無料枠に iOS ビルドが終わらずで断念。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e最終形態：Codemagic で App Store（TestFlight）、Google Play Console（内部テスト）で配信\n\n\u003cul\u003e\n\u003cli\u003eFlutter に特化した CI/CD サービスかつ、無料枠が多い（500分/月）の Codemagic を採用。\u003c/li\u003e\n\u003cli\u003eFastlane で Firebase App Distribution にアップロードするよりも直接ストアに配布するほうが設定が楽だったので Firebase App Distribution を断念。\u003c/li\u003e\n\u003cli\u003eiOS は TestFlight のアプリがよくできているのでバージョン、ビルド番号ごとに別れるが、Android はメールでストアへのリンクがくるだけなので Android のテスト配信は Firebase App Distribution のほうがよさそうです。\u003c/li\u003e\n\u003cli\u003e初めて使ってみた感想ですが、UI も Bitrise よりもわかりやすく、ドキュメントもしっかりしていて問題なく動いたので Flutter で CI/CD を採用するなら Codemagic がおすすめだと思います。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実装した機能\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%9F%E6%A9%9F%E8%83%BD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装した機能\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eユーザー登録\u003c/li\u003e\n\u003cli\u003eログイン\n\n\u003cul\u003e\n\u003cli\u003eGoogle Sing In\u003c/li\u003e\n\u003cli\u003eメールアドレス/パスワード認証 Sing In\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eログアウト\u003c/li\u003e\n\u003cli\u003e地図機能(Google Maps API)\n\n\u003cul\u003e\n\u003cli\u003e店舗の位置の表示\u003c/li\u003e\n\u003cli\u003e現在位置の表示\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e店舗一覧表示\u003c/li\u003e\n\u003cli\u003e商品一覧表示\n\n\u003cul\u003e\n\u003cli\u003eカテゴリーごとにタブ分け\u003c/li\u003e\n\u003cli\u003e検索機能\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e商品詳細表示\n\n\u003cul\u003e\n\u003cli\u003eカートへ追加\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eカートの確認\n\n\u003cul\u003e\n\u003cli\u003e商品の追加/削除\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e注文詳細\n\n\u003cul\u003e\n\u003cli\u003e受け取り方法の時間/方法/決済方法の指定\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e注文履歴一覧表示\u003c/li\u003e\n\u003cli\u003e注文履歴詳細表示\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ディレクトリ構成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%A7%8B%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eディレクトリ構成\u003c/h1\u003e\n\n\u003cp\u003elib 以下はこのように作成しました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ cd lib\n$ tree\n.\n├── api\n│   ├── request\n│   │   └── publish_order_request.dart\n│   └── response\n│       └── publish_response.dart\n├── common\n│   ├── analytics.dart\n│   └── theme.dart\n├── entities\n│   ├── account.dart\n│   ├── cart.dart\n│   ├── order.dart\n│   ├── payment_method.dart\n│   ├── product.dart\n│   ├── product_category.dart\n│   ├── receive_method.dart\n│   └── store.dart\n├── main.dart\n├── models\n│   └── app_model.dart\n└── screens\n    ├── auth_layer\n    │   ├── login_screen.dart\n    │   └── sign_up_screen.dart\n    ├── order_layer\n    │   ├── cart_screen.dart\n    │   ├── order_confirmation_screen.dart\n    │   ├── order_form_screen.dart\n    │   ├── product_detail_screen.dart\n    │   └── product_list_screen.dart\n    ├── top_layer\n    │   ├── order_detail_screen.dart\n    │   ├── order_list_screen.dart\n    │   └── selete_store_screen.dart\n    └── top_screen.dart\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003escreen フォルダはアプリ内の階層を意識してフォルダ分けしましたが、正直、ずらっと並べてもよかったかもしれません。\u003c/li\u003e\n\u003cli\u003eもしくは model と screen のセットでそれぞれの画面ごとにフォルダ分けをしてもよかったのです。\u003c/li\u003e\n\u003cli\u003eしかし、model を機能ごとにバラバラにするよりもひとつにまとめたほうが書きやすかったのでこうなってしまいました（これをうまくやる方法があるはず、、、）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"使用したパッケージ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e使用したパッケージ\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://pub.dev/packages/firebase_core\" rel=\"nofollow noopener\" target=\"_blank\"\u003efirebase_core\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eFirebse 関連。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://pub.dev/packages/firebase_auth\" rel=\"nofollow noopener\" target=\"_blank\"\u003efirebase_auth\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eFirebse 関連。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://pub.dev/packages/firebase_analytics\" rel=\"nofollow noopener\" target=\"_blank\"\u003efirebase_analytics\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eFirebse 関連。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://pub.dev/packages/cloud_firestore\" rel=\"nofollow noopener\" target=\"_blank\"\u003ecloud_firestore\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eFirebse 関連。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://pub.dev/packages/firebase_storage\" rel=\"nofollow noopener\" target=\"_blank\"\u003efirebase_storage\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eFirebse 関連。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://pub.dev/packages/firebase_crashlytics\" rel=\"nofollow noopener\" target=\"_blank\"\u003efirebase_crashlytics\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eFirebse 関連。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://pub.dev/packages/google_maps_flutter\" rel=\"nofollow noopener\" target=\"_blank\"\u003egoogle_maps_flutter\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eGoogle Map を使用するためのパッケージ。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://pub.dev/packages/location\" rel=\"nofollow noopener\" target=\"_blank\"\u003elocation\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003e位置情報を取得するためのパッケージ。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://pub.dev/packages/provider\" rel=\"nofollow noopener\" target=\"_blank\"\u003eprovider\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eprovider による state 管理をするパッケージ。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://pub.dev/packages/http\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eAPI 通信をするために使用したパッケージ。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://pub.dev/packages/uuid\" rel=\"nofollow noopener\" target=\"_blank\"\u003euuid\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003euuid を発行するパッケージ。ユーザーを識別するために使用。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://pub.dev/packages/intl\" rel=\"nofollow noopener\" target=\"_blank\"\u003eintl\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eロケーションの設定するパッケージ。\u003c/li\u003e\n\u003cli\u003e参考：\u003ca href=\"https://medium.com/flutter-jp/intl-beb5b9e8ee73\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://medium.com/flutter-jp/intl-beb5b9e8ee73\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://pub.dev/packages/fluttertoast\" rel=\"nofollow noopener\" target=\"_blank\"\u003efluttertoast\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eトーストを簡単に実装できるパッケージ。↓サンプル\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/ffee7d4962a7289adcef7e5c7c566712c627471f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f64653461366464342d633861302d373337352d303137302d3232636465356564393037642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fde4a6dd4-c8a0-7375-0170-22cde5ed907d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b138cf22a07d894494bdfac1dbcecb2f\" alt=\"fluttertoast.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/de4a6dd4-c8a0-7375-0170-22cde5ed907d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fde4a6dd4-c8a0-7375-0170-22cde5ed907d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=343a74bb9f34f98576a22bf26fd71c74 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://pub.dev/packages/badges\" rel=\"nofollow noopener\" target=\"_blank\"\u003ebadges\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eIcon ウィジェットにバッチを簡単に配置できるパッケージ。↓サンプル\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/7a0e732f45acefdc732e7ad95b40574d4cfc35c3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f64383764333530372d316538342d323636362d363130652d6234656563366234363331302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fd87d3507-1e84-2666-610e-b4eec6b46310.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8cde028cbce956e93145ed515cdf172a\" alt=\"badges.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/d87d3507-1e84-2666-610e-b4eec6b46310.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fd87d3507-1e84-2666-610e-b4eec6b46310.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9e1f351b535bc7f90659ca5067961171 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://pub.dev/packages/google_sign_in\" rel=\"nofollow noopener\" target=\"_blank\"\u003egoogle_sign_in\u003c/a\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eGoogle Sing In を使用するために必要なパッケージ。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://pub.dev/packages/flutter_signin_button\" rel=\"nofollow noopener\" target=\"_blank\"\u003eflutter_signin_button\u003c/a\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eよく見るサードパーティ認証のボタンを提供してくれるパッケージ。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ca href=\"https://pub.dev/packages/shared_preferences\" rel=\"nofollow noopener\" target=\"_blank\"\u003eshared_preferences\u003c/a\u003e\u003cbr\u003e\nローカルの値を保持可能な Key-Value Store を使えるパッケージ。\u003cbr\u003e\niOS でいうところの User Defaults。\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://pub.dev/packages/flutter_launcher_icons\" rel=\"nofollow noopener\" target=\"_blank\"\u003eflutter_launcher_icons\u003c/a\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eアプリアイコンを簡単に設定できるパッケージ。 ↓サンプル\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/9d722b26d63a325d8ded324f2b66452ec5fb3869/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f31343862396163322d323166652d366631342d313637312d3337633762613732396632662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F148b9ac2-21fe-6f14-1671-37c7ba729f2f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0e65aca44bbe709b925a9deb88dc1fcd\" alt=\"flutter_signin_button.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/148b9ac2-21fe-6f14-1671-37c7ba729f2f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F148b9ac2-21fe-6f14-1671-37c7ba729f2f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d2922028368f916af475210a0d686ebe 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"感想\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%84%9F%E6%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e感想\u003c/h1\u003e\n\n\u003cp\u003e実際に Flutter での開発を経験してみての感想は以下になります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ポジティブ意見\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9D%E3%82%B8%E3%83%86%E3%82%A3%E3%83%96%E6%84%8F%E8%A6%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eポジティブ意見\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eひとつのソースでiOS/Androidのアプリケーションが両方作られることが単純にすごい\u003c/li\u003e\n\u003cli\u003e公式ドキュメントがちゃんとしている\n\n\u003cul\u003e\n\u003cli\u003eFlutter、Firebase、FlutterFire、Pub公式などのドキュメントがかなりまとも（Googleさんすごい！！）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eホットリロードがすごい\n\n\u003cul\u003e\n\u003cli\u003eSwiftUIのようななんちゃってホットリロードではない。SwiftUIではホットロード用のコードを書かないといけないのもイケていない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eライブラリの導入が簡単\n\n\u003cul\u003e\n\u003cli\u003ePub 一択であり、Swift のようにライブラリ管理のサービスが乱立していない\u003c/li\u003e\n\u003cli\u003eつまり、Swift Package Manager vs CocoaPods vs Carthage のようなカオスなことになっていない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eFirebase との相性がかなりよい\n\n\u003cul\u003e\n\u003cli\u003eドキュメントがちゃんとしていて、Firebase の導入が簡単\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e宣言的 UI での実装は直感的\n\n\u003cul\u003e\n\u003cli\u003eSwiftUIっぽく書けるので SwiftUI での実装経験がいきる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eCI/CD サービスの Codemagic が使いやすかった\u003c/li\u003e\n\u003cli\u003eAndroid Studio が意外にも使えた\n\n\u003cul\u003e\n\u003cli\u003eウィジェットを指定して Option + Enter で階層を変えたり、ウィジェットの種類を変更できるのが便利\u003c/li\u003e\n\u003cli\u003eXcode より軽い\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ネガティブ意見\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%8D%E3%82%AC%E3%83%86%E3%82%A3%E3%83%96%E6%84%8F%E8%A6%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eネガティブ意見\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eiOS/Android のソースが一つになるからといって作業が単純に 1/2 になるというわけではない\n\n\u003cul\u003e\n\u003cli\u003e結局、info.plist や AndroidManifest.xml などは iOS、Android それどれの設定は必要\u003c/li\u003e\n\u003cli\u003eストアリリースに必要な証明書の準備や、ストア掲載画像はそれぞれ用意しなければならない\u003c/li\u003e\n\u003cli\u003eこの辺の知識は iOS/Android 両方の知識を求めらる瞬間があり、知らないと調べるのに時間がかかる（特にストア配信あたり）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eiOS のビルドにやや時間がかかる\n\n\u003cul\u003e\n\u003cli\u003eFirebase を組み込むと初回ビルドに 3 分ほどかかる\u003c/li\u003e\n\u003cli\u003eただし、一度ビルドすればあとはホットリロードで更新されるのでそんなにビルドするタイミングは多くない\u003c/li\u003e\n\u003cli\u003eしかし、CI/CD の速度は iOS の ビルド速度にほぼ依存しそう（今回のアプリでは Android 10 分に対して、iOS は 40 分ほどかかりました）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eDart がいまいち好きになれない（Swift 信者の意見）\n\n\u003cul\u003e\n\u003cli\u003ewillSet、didSet のようなプロパティオブザーバーのような機能はない\u003c/li\u003e\n\u003cli\u003eOptional の変数のアンラップ方法として guard let や if let のような書き方がない\u003c/li\u003e\n\u003cli\u003eStruct がない\u003c/li\u003e\n\u003cli\u003eenum はあるが機能が少ない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePadding の指定が SwiftUI に比べて書きづらい\n\n\u003cul\u003e\n\u003cli\u003ePadding を素直に使ったり SizedBox を使ったりするテクニックがあるがコードが見づらくなる（これは本当にどうにかしてほしいです）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eXD to Flutter があまり使えなかった\n\n\u003cul\u003e\n\u003cli\u003eAdobeXD のデザインファイルからコードを生成できる「XD to Flutter」で出力されるコードは実用的ではないので期待しないほうがいい（戒め）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"実際に案件で採用する際の注意点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E9%9A%9B%E3%81%AB%E6%A1%88%E4%BB%B6%E3%81%A7%E6%8E%A1%E7%94%A8%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実際に案件で採用する際の注意点\u003c/h1\u003e\n\n\u003cp\u003e以下の記事の内容に概ね同意です。\u003cbr\u003e\nよくまとめられていると思います。\u003c/p\u003e\n\n\u003cp\u003e参考：モバイルアプリ開発は、Flutter一択なのか？\u003cbr\u003e\n\u003ca href=\"https://zenn.dev/tetsukick/articles/c297b6ee1e64397432e5\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://zenn.dev/tetsukick/articles/c297b6ee1e64397432e5\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eただ、Google が思ったより Flutter の開発に積極的で、つい先日発表された Flutter 2.2 では Google Pay に対応したりとモバイルのネイティブ機能の活用の幅は広がっていきそうなので、このままだと Flutter 一択の世界があるかもしれません。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"さいごに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eさいごに\u003c/h1\u003e\n\n\u003cp\u003e正直、自分が思っていたよりも簡単に iOS/Android の両方の OS で動くアプリが作れることに驚きました。\u003cbr\u003e\nしかも、Firebase の連携もそうですが、いろいろなライブラリであったり、CI/CD 環境や公式ドキュメントも揃っているので、今後、多くのモバイルアプリケーション開発が Flutter で作られる未来はそう遠くないなと感じました。\u003c/p\u003e\n\n\u003cp\u003eFlutter かなり熱いと思います。\u003c/p\u003e\n","body":"\n# はじめに\n\nFlutter が本格的に流行ってきたので、勉強のため、架空のショッピングアプリの開発を Flutter を用いて開発してみました。\nそこで得られた知見をまとめたいと思います。\n\n# 開発したアプリの概要\n\n開発するアプリとして架空の飲食店または小売店での注文アプリを作成しました。\nこの手のアプリの中ではマクドナルドのオーダーアプリがかなりよくできていたので、それを参考にして作成しました。\n\nFlutter の勉強が主な目的ですが、相性の良い Firebase の機能も試してみたかったので、店舗情報、商品情報、注文履歴などのデータはアプリ内で固定値で持たずに Firestore に格納するようにしました。\n\nただし、商品マスタ登録、店舗マスタ登録や商品在庫といった運用の考慮どはしていません。\nまた、決済機能は実装対象外としました。\n\n最終的な画面数は 10 画面。\n実装期間は土日を 2 ヶ月間ほどです。\n\n# アーキテクチャ（全体）\n\n![a.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/a04afa46-12f5-a759-8675-10f49e847ccb.png)\n\n# アーキテクチャ（CI/CD）\n\n今回作ったアプリでは CI/CD はストアリリースまでではなく、開発中の内部でのテストアプリ配信を想定して構築しました。\n\n![b.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/c30592a9-1628-f096-f326-72728a2ac4a7.png)\n\n\ndevelop ブランチへの Push をトリガーに Codemagic 経由で App Store（TestFlight）と Google Play Console（内部テスト）に配信するところまでを作成しました。\nちなみに、いきなりこのようになったのではなく、以下の経緯を経てこのような形に落ち着きました。\n\n- 第一形態：手動で .ipa や .apk ファイルを Firebase App Distribution にアップロードして配信\n  - 手動で配信するのはダサかったので Fastlane を採用することに。\n- 第二形態：コマンドラインから Fastlane を使って Firebase App Distribution で配信\n  - どうせなら GitHub での Push をトリガーに配布したく CI/CD のサービスを検討。\n- 第三形態：Bitrise で Fastlane を使って Firebase App Distribution で配信\n  - モバイルアプリ開発における CI/CD デファクトスタンダードの Bitrise を採用。\n  - Bitrise の無料枠に iOS ビルドが終わらずで断念。\n- 最終形態：Codemagic で App Store（TestFlight）、Google Play Console（内部テスト）で配信\n  - Flutter に特化した CI/CD サービスかつ、無料枠が多い（500分/月）の Codemagic を採用。\n  - Fastlane で Firebase App Distribution にアップロードするよりも直接ストアに配布するほうが設定が楽だったので Firebase App Distribution を断念。\n  - iOS は TestFlight のアプリがよくできているのでバージョン、ビルド番号ごとに別れるが、Android はメールでストアへのリンクがくるだけなので Android のテスト配信は Firebase App Distribution のほうがよさそうです。\n  - 初めて使ってみた感想ですが、UI も Bitrise よりもわかりやすく、ドキュメントもしっかりしていて問題なく動いたので Flutter で CI/CD を採用するなら Codemagic がおすすめだと思います。\n \n# 実装した機能\n\n- ユーザー登録\n- ログイン\n  - Google Sing In\n  - メールアドレス/パスワード認証 Sing In\n- ログアウト\n- 地図機能(Google Maps API)\n  - 店舗の位置の表示\n  - 現在位置の表示\n- 店舗一覧表示\n- 商品一覧表示\n  - カテゴリーごとにタブ分け\n  - 検索機能\n- 商品詳細表示\n  - カートへ追加\n- カートの確認\n  - 商品の追加/削除\n- 注文詳細\n  - 受け取り方法の時間/方法/決済方法の指定\n- 注文履歴一覧表示\n- 注文履歴詳細表示\n\n# ディレクトリ構成\n\nlib 以下はこのように作成しました。\n\n```\n$ cd lib\n$ tree\n.\n├── api\n│   ├── request\n│   │   └── publish_order_request.dart\n│   └── response\n│       └── publish_response.dart\n├── common\n│   ├── analytics.dart\n│   └── theme.dart\n├── entities\n│   ├── account.dart\n│   ├── cart.dart\n│   ├── order.dart\n│   ├── payment_method.dart\n│   ├── product.dart\n│   ├── product_category.dart\n│   ├── receive_method.dart\n│   └── store.dart\n├── main.dart\n├── models\n│   └── app_model.dart\n└── screens\n    ├── auth_layer\n    │   ├── login_screen.dart\n    │   └── sign_up_screen.dart\n    ├── order_layer\n    │   ├── cart_screen.dart\n    │   ├── order_confirmation_screen.dart\n    │   ├── order_form_screen.dart\n    │   ├── product_detail_screen.dart\n    │   └── product_list_screen.dart\n    ├── top_layer\n    │   ├── order_detail_screen.dart\n    │   ├── order_list_screen.dart\n    │   └── selete_store_screen.dart\n    └── top_screen.dart\n```\n\n- screen フォルダはアプリ内の階層を意識してフォルダ分けしましたが、正直、ずらっと並べてもよかったかもしれません。\n- もしくは model と screen のセットでそれぞれの画面ごとにフォルダ分けをしてもよかったのです。\n- しかし、model を機能ごとにバラバラにするよりもひとつにまとめたほうが書きやすかったのでこうなってしまいました（これをうまくやる方法があるはず、、、）\n\n# 使用したパッケージ\n\n- [firebase_core](https://pub.dev/packages/firebase_core)\n  - Firebse 関連。\n- [firebase_auth](https://pub.dev/packages/firebase_auth)\n  - Firebse 関連。\n- [firebase_analytics](https://pub.dev/packages/firebase_analytics)\n  - Firebse 関連。\n- [cloud_firestore](https://pub.dev/packages/cloud_firestore)\n  - Firebse 関連。\n- [firebase_storage](https://pub.dev/packages/firebase_storage)\n  - Firebse 関連。\n- [firebase_crashlytics](https://pub.dev/packages/firebase_crashlytics)\n  - Firebse 関連。\n- [google_maps_flutter](https://pub.dev/packages/google_maps_flutter)\n  - Google Map を使用するためのパッケージ。\n- [location](https://pub.dev/packages/location)\n  - 位置情報を取得するためのパッケージ。\n- [provider](https://pub.dev/packages/provider)\n  - provider による state 管理をするパッケージ。\n- [http](https://pub.dev/packages/http)\n  - API 通信をするために使用したパッケージ。\n- [uuid](https://pub.dev/packages/uuid)\n  - uuid を発行するパッケージ。ユーザーを識別するために使用。\n- [intl](https://pub.dev/packages/intl)\n  - ロケーションの設定するパッケージ。\n  - 参考：https://medium.com/flutter-jp/intl-beb5b9e8ee73\n- [fluttertoast](https://pub.dev/packages/fluttertoast)\n  - トーストを簡単に実装できるパッケージ。↓サンプル\n\n![fluttertoast.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/de4a6dd4-c8a0-7375-0170-22cde5ed907d.png)\n\n\n- [badges](https://pub.dev/packages/badges)\n  - Icon ウィジェットにバッチを簡単に配置できるパッケージ。↓サンプル\n\n![badges.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/d87d3507-1e84-2666-610e-b4eec6b46310.png)\n\n\n- [google_sign_in](https://pub.dev/packages/google_sign_in)\n  - Google Sing In を使用するために必要なパッケージ。\n\n- [flutter_signin_button](https://pub.dev/packages/flutter_signin_button)\n  - よく見るサードパーティ認証のボタンを提供してくれるパッケージ。\n\n- [shared_preferences](https://pub.dev/packages/shared_preferences)\nローカルの値を保持可能な Key-Value Store を使えるパッケージ。\niOS でいうところの User Defaults。\n\n- [flutter_launcher_icons](https://pub.dev/packages/flutter_launcher_icons)\n  - アプリアイコンを簡単に設定できるパッケージ。 ↓サンプル\n \n![flutter_signin_button.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/148b9ac2-21fe-6f14-1671-37c7ba729f2f.png)\n\n\n# 感想\n\n実際に Flutter での開発を経験してみての感想は以下になります。\n\n## ポジティブ意見\n\n- ひとつのソースでiOS/Androidのアプリケーションが両方作られることが単純にすごい\n- 公式ドキュメントがちゃんとしている\n  - Flutter、Firebase、FlutterFire、Pub公式などのドキュメントがかなりまとも（Googleさんすごい！！）\n- ホットリロードがすごい\n  - SwiftUIのようななんちゃってホットリロードではない。SwiftUIではホットロード用のコードを書かないといけないのもイケていない\n- ライブラリの導入が簡単\n  - Pub 一択であり、Swift のようにライブラリ管理のサービスが乱立していない\n  - つまり、Swift Package Manager vs CocoaPods vs Carthage のようなカオスなことになっていない\n- Firebase との相性がかなりよい\n  - ドキュメントがちゃんとしていて、Firebase の導入が簡単\n- 宣言的 UI での実装は直感的\n  - SwiftUIっぽく書けるので SwiftUI での実装経験がいきる\n- CI/CD サービスの Codemagic が使いやすかった\n- Android Studio が意外にも使えた\n  - ウィジェットを指定して Option + Enter で階層を変えたり、ウィジェットの種類を変更できるのが便利\n  - Xcode より軽い\n\n## ネガティブ意見\n\n- iOS/Android のソースが一つになるからといって作業が単純に 1/2 になるというわけではない\n  - 結局、info.plist や AndroidManifest.xml などは iOS、Android それどれの設定は必要\n  - ストアリリースに必要な証明書の準備や、ストア掲載画像はそれぞれ用意しなければならない\n  - この辺の知識は iOS/Android 両方の知識を求めらる瞬間があり、知らないと調べるのに時間がかかる（特にストア配信あたり）\n- iOS のビルドにやや時間がかかる\n  - Firebase を組み込むと初回ビルドに 3 分ほどかかる\n  - ただし、一度ビルドすればあとはホットリロードで更新されるのでそんなにビルドするタイミングは多くない\n  - しかし、CI/CD の速度は iOS の ビルド速度にほぼ依存しそう（今回のアプリでは Android 10 分に対して、iOS は 40 分ほどかかりました）\n- Dart がいまいち好きになれない（Swift 信者の意見）\n  - willSet、didSet のようなプロパティオブザーバーのような機能はない\n  - Optional の変数のアンラップ方法として guard let や if let のような書き方がない\n  - Struct がない\n  - enum はあるが機能が少ない\n- Padding の指定が SwiftUI に比べて書きづらい\n  - Padding を素直に使ったり SizedBox を使ったりするテクニックがあるがコードが見づらくなる（これは本当にどうにかしてほしいです）\n- XD to Flutter があまり使えなかった\n  - AdobeXD のデザインファイルからコードを生成できる「XD to Flutter」で出力されるコードは実用的ではないので期待しないほうがいい（戒め）\n\n# 実際に案件で採用する際の注意点\n\n以下の記事の内容に概ね同意です。\nよくまとめられていると思います。\n\n参考：モバイルアプリ開発は、Flutter一択なのか？\nhttps://zenn.dev/tetsukick/articles/c297b6ee1e64397432e5\n\nただ、Google が思ったより Flutter の開発に積極的で、つい先日発表された Flutter 2.2 では Google Pay に対応したりとモバイルのネイティブ機能の活用の幅は広がっていきそうなので、このままだと Flutter 一択の世界があるかもしれません。\n\n# さいごに\n\n正直、自分が思っていたよりも簡単に iOS/Android の両方の OS で動くアプリが作れることに驚きました。\nしかも、Firebase の連携もそうですが、いろいろなライブラリであったり、CI/CD 環境や公式ドキュメントも揃っているので、今後、多くのモバイルアプリケーション開発が Flutter で作られる未来はそう遠くないなと感じました。\n\nFlutter かなり熱いと思います。\n","coediting":false,"comments_count":1,"created_at":"2021-05-20T13:50:33+09:00","group":null,"id":"92f89ecf3e27c4597e4c","likes_count":89,"private":false,"reactions_count":0,"tags":[{"name":"Android","versions":[]},{"name":"iOS","versions":[]},{"name":"Flutter","versions":[]}],"title":"Flutter でアプリを作ってみた感想","updated_at":"2021-09-08T01:50:27+09:00","url":"https://qiita.com/ikuraikura/items/92f89ecf3e27c4597e4c","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"npm-バージョン7-について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#npm-%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B37-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enpm バージョン7 について\u003c/h1\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eGitHubは米国時間2020年10月13日、Node.jsのパッケージマネージャーであるnpm(Node Package Manager)バージョン7が近日中にリリースされるNode.js 15.0.0に含まれることを公式ブログで明らかにした。npm バージョン7は2020年5月に発表し、10月12日にリリースされた。これまで数百万人の開発者が月間130万パッケージを750億回ダウンロードしている。\u003c/p\u003e\n\n\u003cp\u003enpm バージョン7は複数のパッケージを操作するワークスペースの拡充や、依存関係の最適化、パッケージロック機能を更新するためのyarn.lockのサポートを含んでいる。特に依存関係はnode_modulesツリー内にある依存関係にあるパッケージを正しく検出するアルゴリズムが組み込まれた。Node.jsに含まれる安定版(バージョン12、本稿執筆時点の最新版はバージョン14)のバイナリーでは古いバージョンになるため、npmインストール済み環境で「npm i -g npm@7」を実行すると、npmをバージョン7に更新できる。\u003c/p\u003e\n\n\u003cp\u003e阿久津良和(Cactus)\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e引用元：\u003ca href=\"https://news.mynavi.jp/article/20201016-1418462/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eワークスペース拡充のnpm v7.0\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"npm-バージョン7-の変更点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#npm-%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B37-%E3%81%AE%E5%A4%89%E6%9B%B4%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enpm バージョン7 の変更点\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"/watilde\" class=\"user-mention js-hovercard\" title=\"watilde\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"watilde\"\u003e@watilde\u003c/a\u003e さんという方がまとめてくださっています。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://blog.watilde.com/2020/10/14/npm-v7%E3%81%AE%E4%B8%BB%E3%81%AA%E5%A4%89%E6%9B%B4%E7%82%B9%E3%81%BE%E3%81%A8%E3%82%81/\" rel=\"nofollow noopener\" target=\"_blank\"\u003enpm v7の主な変更点まとめ\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eいくつか破壊的な変更があるので peerDependency や npx を使用している環境では注意してください。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"npm-のアップデート\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#npm-%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%83%87%E3%83%BC%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enpm のアップデート\u003c/h1\u003e\n\n\u003cp\u003e実際にアップデートしたいと思います。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e動作環境\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003enode \u003cspan class=\"nt\"\u003e-v\u003c/span\u003e\nv15.5.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eアップデート\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003enpm \u003cspan class=\"nb\"\u003einstall\u003c/span\u003e \u003cspan class=\"nt\"\u003e-g\u003c/span\u003e npm@7\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e確認\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003enpm \u003cspan class=\"nt\"\u003e-v\u003c/span\u003e\n7.3.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e2020年12月23日現在は \u003ccode\u003ev7.3.0\u003c/code\u003e が最新のようです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"今すぐにバージョンすべきか2020年12月23日時点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E3%81%99%E3%81%90%E3%81%AB%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%99%E3%81%B9%E3%81%8D%E3%81%8B2020%E5%B9%B412%E6%9C%8823%E6%97%A5%E6%99%82%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今すぐにバージョンすべきか？（2020年12月23日時点）\u003c/h1\u003e\n\n\u003cp\u003e2020年12月23日時点では、Node.js の安定版は 14.15.3 (同梱 npm 6.14.9) であるため、今すぐにバージョン 7 にアップデートする必要はないですが、あらかじめ対応しておいたほうがあとあと楽かと思います。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e安定版の確認\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://nodejs.org/ja/download/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://nodejs.org/ja/download/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eNode.js と npm バージョン対応表\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://nodejs.org/ja/download/releases/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://nodejs.org/ja/download/releases/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","body":"\n# npm バージョン7 について\n\n\u003eGitHubは米国時間2020年10月13日、Node.jsのパッケージマネージャーであるnpm(Node Package Manager)バージョン7が近日中にリリースされるNode.js 15.0.0に含まれることを公式ブログで明らかにした。npm バージョン7は2020年5月に発表し、10月12日にリリースされた。これまで数百万人の開発者が月間130万パッケージを750億回ダウンロードしている。\n\u003e\n\u003enpm バージョン7は複数のパッケージを操作するワークスペースの拡充や、依存関係の最適化、パッケージロック機能を更新するためのyarn.lockのサポートを含んでいる。特に依存関係はnode_modulesツリー内にある依存関係にあるパッケージを正しく検出するアルゴリズムが組み込まれた。Node.jsに含まれる安定版(バージョン12、本稿執筆時点の最新版はバージョン14)のバイナリーでは古いバージョンになるため、npmインストール済み環境で「npm i -g npm@7」を実行すると、npmをバージョン7に更新できる。\n\u003e\n\u003e阿久津良和(Cactus)\n\n引用元：[ワークスペース拡充のnpm v7.0](https://news.mynavi.jp/article/20201016-1418462/)\n\n# npm バージョン7 の変更点\n\n@watilde さんという方がまとめてくださっています。\n\n\u003e [npm v7の主な変更点まとめ](https://blog.watilde.com/2020/10/14/npm-v7%E3%81%AE%E4%B8%BB%E3%81%AA%E5%A4%89%E6%9B%B4%E7%82%B9%E3%81%BE%E3%81%A8%E3%82%81/)\n\nいくつか破壊的な変更があるので peerDependency や npx を使用している環境では注意してください。\n\n# npm のアップデート\n\n実際にアップデートしたいと思います。\n\n```shell:動作環境\n$ node -v\nv15.5.0\n```\n\n```shell:アップデート\n$ npm install -g npm@7\n```\n\n```shell:確認\n$ npm -v\n7.3.0\n```\n\n2020年12月23日現在は `v7.3.0` が最新のようです。\n\n# 今すぐにバージョンすべきか？（2020年12月23日時点）\n\n2020年12月23日時点では、Node.js の安定版は 14.15.3 (同梱 npm 6.14.9) であるため、今すぐにバージョン 7 にアップデートする必要はないですが、あらかじめ対応しておいたほうがあとあと楽かと思います。\n\n- 安定版の確認\n  - https://nodejs.org/ja/download/\n- Node.js と npm バージョン対応表\n  - https://nodejs.org/ja/download/releases/\n","coediting":false,"comments_count":0,"created_at":"2020-12-23T17:14:39+09:00","group":null,"id":"e72e6006504e2ee04bb4","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"npm","versions":[]}],"title":"npm バージョン7 にアップデートできるよ【2020年10月20日〜】","updated_at":"2020-12-23T17:26:50+09:00","url":"https://qiita.com/ikuraikura/items/e72e6006504e2ee04bb4","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"便利なサイト5選\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BE%BF%E5%88%A9%E3%81%AA%E3%82%B5%E3%82%A4%E3%83%885%E9%81%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e便利なサイト5選\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://trends.google.co.jp/trends\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGoogle Trends\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eGoogle 検索での比較\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://qiitrend.herokuapp.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eQiiTrend\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eQiita 投稿数のタグ数の比較\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://www.githubcompare.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGithub Compare\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eGithub でのリポジトリの比較\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://madnight.github.io/githut\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGitHut\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eGithub に登録されているリポジトリのプログラミング言語の比較\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://insights.stackoverflow.com/trends\" rel=\"nofollow noopener\" target=\"_blank\"\u003eStack Overflow Trends\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003eStack Overflow でのタグ数の比較\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"google-trends\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#google-trends\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGoogle Trends\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://trends.google.co.jp/trends\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://trends.google.co.jp/trends\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eGoogle での検索トレンドを比較することができます。地域を選択することで国内のみのトレンドを見ることも可能です。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/35bae28d3c925b49b14de870b0033d821c97247d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f65336239376431352d376466382d363037662d623035342d3530396532353462373730662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fe3b97d15-7df8-607f-b054-509e254b770f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f8aac09a2dbbdb0a542efad1fa264461\" alt=\"図1.png-4.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/e3b97d15-7df8-607f-b054-509e254b770f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fe3b97d15-7df8-607f-b054-509e254b770f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=aeb487864cccbb7f813cdb97c27402bb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n地域を日本で選択すると都道府県ごとの比較もみることができます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/79d0f818f55950b53a6c0eea1b796c29af550fd9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f61333739393735622d656364352d306362342d633239322d3166313763356162633834312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fa379975b-ecd5-0cb4-c292-1f17c5abc841.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0d4987073566a4e0f4fcda5521583df8\" alt=\"図1.png-1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/a379975b-ecd5-0cb4-c292-1f17c5abc841.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fa379975b-ecd5-0cb4-c292-1f17c5abc841.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cb86e22ffd42b6936aa29900894f8abe 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"qiitrend\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#qiitrend\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eQiiTrend\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://qiitrend.herokuapp.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://qiitrend.herokuapp.com/\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eQiitaでの投稿数の比較ができます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c5780a74b17e1d5fcaebaa81f4ea7c4a27f76b77/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f32346263303164352d363733382d633334342d316365372d6561323833636163393964632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F24bc01d5-6738-c344-1ce7-ea283cac99dc.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=656e7bd31c21066276aab000ce44b924\" alt=\"図1.png-5.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/24bc01d5-6738-c344-1ce7-ea283cac99dc.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F24bc01d5-6738-c344-1ce7-ea283cac99dc.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8eddf900771f1ae99f264448b8e2f844 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"github-compare\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#github-compare\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGithub Compare\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://www.githubcompare.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.githubcompare.com/\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eGithub のリポジトリの比較をすることができます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/7f1aede4b02bd7b9d360b001820f8acdd8da92bb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f30393765373233372d643331652d613365632d313039622d6631316438303530623764662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F097e7237-d31e-a3ec-109b-f11d8050b7df.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9632182aea83c5ba0c63437b1088e1d3\" alt=\"図1.png-2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/097e7237-d31e-a3ec-109b-f11d8050b7df.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F097e7237-d31e-a3ec-109b-f11d8050b7df.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0457ffcc8a915cf764a1d892c853eba9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"githut\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#githut\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGitHut\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://madnight.github.io/githut\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://madnight.github.io/githut\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eGithub での言語のトレンドを比較することができます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/8aa7259cf441cc606ab6180cb24ce93cf9139a46/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f62366131626565342d353731352d363738632d316139662d6132383735393036613031372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fb6a1bee4-5715-678c-1a9f-a2875906a017.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=41b811d09228382c9c118b20d7130843\" alt=\"図1.png-6.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/b6a1bee4-5715-678c-1a9f-a2875906a017.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fb6a1bee4-5715-678c-1a9f-a2875906a017.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7b63dad7cf536a1ede56b9fd189df222 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n真ん中の 「PUSHES」 と書かれているボタンを押すと STARS, ISSUES, PULL REUESTS, PUSHES とそれぞれの項目で比較することができます。\u003c/p\u003e\n\n\u003cp\u003eまた、言語の判例をクリックするとクリックした言語のみのグラフを表示することが可能です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"stack-overflow-trends\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stack-overflow-trends\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStack Overflow Trends\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://insights.stackoverflow.com/trends\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://insights.stackoverflow.com/trends\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eStack Overflow のタグ数での比較ができます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/13b3b3c598666f8a4c095952cf6a32fb9632a963/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f62313835613937352d303561302d336235332d626562642d3930626535353561333533642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fb185a975-05a0-3b53-bebd-90be555a353d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bb02da698b29b6240843fbff6ea0e0ed\" alt=\"図1.png-3.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/b185a975-05a0-3b53-bebd-90be555a353d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fb185a975-05a0-3b53-bebd-90be555a353d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=32c3008008df2e95e1085cd861169f1f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\n\u003cp\u003e・\u003ca href=\"https://qiita.com/tag1216/items/da1b078270c0cb6c07df\" id=\"reference-36ce49853bd792243d57\"\u003eIT系の技術トレンドを調べるのに使えるサービス\u003c/a\u003e\u003cbr\u003e\nこの記事の投稿者の方が QiiTrend を開発したみたいです。\u003c/p\u003e\n","body":"\n# 便利なサイト5選\n\n- [Google Trends](https://trends.google.co.jp/trends)\n  - Google 検索での比較\n- [QiiTrend](https://qiitrend.herokuapp.com/)\n  - Qiita 投稿数のタグ数の比較\n- [Github Compare](https://www.githubcompare.com/)\n  - Github でのリポジトリの比較\n- [GitHut](https://madnight.github.io/githut)\n  - Github に登録されているリポジトリのプログラミング言語の比較\n- [Stack Overflow Trends](https://insights.stackoverflow.com/trends)\n  - Stack Overflow でのタグ数の比較\n\n\n\n## Google Trends\n\n\u003e https://trends.google.co.jp/trends\n\nGoogle での検索トレンドを比較することができます。地域を選択することで国内のみのトレンドを見ることも可能です。\n![図1.png-4.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/e3b97d15-7df8-607f-b054-509e254b770f.png)\n地域を日本で選択すると都道府県ごとの比較もみることができます。\n![図1.png-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/a379975b-ecd5-0cb4-c292-1f17c5abc841.png)\n\n## QiiTrend\n\n\u003e https://qiitrend.herokuapp.com/\n\nQiitaでの投稿数の比較ができます。\n![図1.png-5.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/24bc01d5-6738-c344-1ce7-ea283cac99dc.png)\n\n## Github Compare\n\n\u003e https://www.githubcompare.com/\n\nGithub のリポジトリの比較をすることができます。\n![図1.png-2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/097e7237-d31e-a3ec-109b-f11d8050b7df.png)\n\n\n## GitHut\n\n\u003e https://madnight.github.io/githut\n\nGithub での言語のトレンドを比較することができます。\n![図1.png-6.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/b6a1bee4-5715-678c-1a9f-a2875906a017.png)\n真ん中の 「PUSHES」 と書かれているボタンを押すと STARS, ISSUES, PULL REUESTS, PUSHES とそれぞれの項目で比較することができます。\n\nまた、言語の判例をクリックするとクリックした言語のみのグラフを表示することが可能です。\n\n## Stack Overflow Trends\n\n\u003e https://insights.stackoverflow.com/trends\n\nStack Overflow のタグ数での比較ができます。\n![図1.png-3.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/b185a975-05a0-3b53-bebd-90be555a353d.png)\n\n# 参考\n\n・[IT系の技術トレンドを調べるのに使えるサービス](https://qiita.com/tag1216/items/da1b078270c0cb6c07df)\nこの記事の投稿者の方が QiiTrend を開発したみたいです。\n","coediting":false,"comments_count":0,"created_at":"2020-12-21T23:57:26+09:00","group":null,"id":"ee28eddc4f2c0e7fa9a5","likes_count":1,"private":false,"reactions_count":0,"tags":[{"name":"Qiita","versions":[]},{"name":"StackOverflow","versions":[]},{"name":"フレームワーク","versions":[]},{"name":"GoogleTrends","versions":[]},{"name":"技術調査","versions":[]}],"title":"フレームワークや言語の技術トレンドの調査に便利なサイト5選","updated_at":"2020-12-22T00:47:17+09:00","url":"https://qiita.com/ikuraikura/items/ee28eddc4f2c0e7fa9a5","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"やったこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやったこと\u003c/h1\u003e\n\n\u003cp\u003eこの記事では Serverless Framework で API キーの設定方法や、設定した場合の API の挙動について書いていきたいと思います。\u003c/p\u003e\n\n\u003cp\u003e結局のところ serverless.yml で記述するそれらの設定は API Gateway の API キーの設定に反映されます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"serverlessyml\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#serverlessyml\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eserverless.yml\u003c/h1\u003e\n\n\u003cp\u003eserverless.yml に記述することで API キーの設定が行うことができます。\u003c/p\u003e\n\n\u003cp\u003e今回は serverless.yml は以下のように設定しました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"yaml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eserverless.yml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003eprovider\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e# （省略）\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eapiKeys\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003efree\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 使用量プラン\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${opt:stage, self:provider.stage}-free-key\u003c/span\u003e \u003cspan class=\"c1\"\u003e# key 名\u003c/span\u003e\n          \u003cspan class=\"na\"\u003evalue\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ea123456789012345678901234567890\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 30-128文字の英数字\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003emogemoge\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 複数のプランを設定することが可能\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e${opt:stage, self:provider.stage}-mogemoge-key\u003c/span\u003e \u003cspan class=\"c1\"\u003e# name, value を指定しないと value は自動生成される\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eusagePlan\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003efree\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003equota\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003elimit\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e1000\u003c/span\u003e \u003cspan class=\"c1\"\u003e# API の呼び出しを行える最大回数\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eoffset\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"c1\"\u003e# API の呼び出し回数の初期値（通常は 0 回を指定する）\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eperiod\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eMONTH\u003c/span\u003e \u003cspan class=\"c1\"\u003e# DAY or WEEK or MONTH\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ethrottle\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003erateLimit\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 1 秒あたりに処理できる API リクエスト数\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eburstLimit\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 同時に処理できる最大リクエスト数\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003emogemoge\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003equota\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003elimit\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e50000\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eoffset\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eperiod\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eMONTH\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ethrottle\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eburstLimit\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2000\u003c/span\u003e\n          \u003cspan class=\"na\"\u003erateLimit\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e1000\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# （省略）\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003efunctions\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ehello\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ehandler\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehandler.hello\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eevents\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ehttp\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehello\u003c/span\u003e\n          \u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eget\u003c/span\u003e\n          \u003cspan class=\"na\"\u003eprivate\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003etrue\u003c/span\u003e \u003cspan class=\"c1\"\u003e# API キーを有効にするエンドポイントは true にする\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eapiKeys, quota, throttle の設定についてコメントで注釈をいれました。\u003c/p\u003e\n\n\u003cp\u003eさらに詳しいことは以下を参考にしてください。\u003c/p\u003e\n\n\u003cp\u003e【参考】\u003cbr\u003e\n・\u003ca href=\"https://dev.classmethod.jp/articles/api-gateway-usage-plan/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAPI Gateway の API Key を調べてみた\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/api-gateway-request-throttling.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAPI リクエストを調整してスループットを向上させる\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e個人的に思うこととして、API キーの値は自動生成させるのではなく、値を固定して運用することがほとんどだと思います。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eデプロイごとに API キーが変わると、今まで使用していた API キーでアクセスするとエラーになってしまうので、もし、自動生成としている場合、クライアント側と API 側は常に同時にアップデートしなければならない制約が設けられます。\u003c/p\u003e\n\n\u003cp\u003eかといって、『ソースコード上に API キーの値を直接書くことはセキュリティ上よくないのでは？』と思いますが、そもそも論として、API キーは唯一の認証には使用してはいけなく、リクエストの制限を行うユーザーをグループとして管理するために用いるものであるので、ソースコード上にベタに書いても問題ないと思います。（もちろん、認証の仕組みは別に設ける必要がありますが。）\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"api-キーの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#api-%E3%82%AD%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAPI キーの作成\u003c/h1\u003e\n\n\u003cp\u003e上記のように serverless.yml を設定して \u003ccode\u003esls deploy\u003c/code\u003e するだけです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ sls deploy\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eデプロイに成功するとコンソールの最後の方に API キーが出力されると思います。\u003c/p\u003e\n\n\u003cp\u003e削除は \u003ccode\u003esls remove\u003c/code\u003e で削除\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"api-キーの確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#api-%E3%82%AD%E3%83%BC%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAPI キーの確認\u003c/h1\u003e\n\n\u003cp\u003eちなみに API キーの確認は \u003ccode\u003esls info\u003c/code\u003e コマンド実行すれば、いつでも可能です。\u003cbr\u003e\nもちろん sls deploy コマンド実行時のコンソールに API キーの値が出力されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ sls info\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/e8cf936daa62000b48f6e4bdc4e4a50ee03d9cb5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f65626266643437632d326161342d653532362d633263632d3233623136303166336232382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Febbfd47c-2aa4-e526-c2cc-23b1601f3b28.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8d22f516fcd6c1ae0f79df6d027882f1\" alt=\"aaa.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/ebbfd47c-2aa4-e526-c2cc-23b1601f3b28.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Febbfd47c-2aa4-e526-c2cc-23b1601f3b28.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5695baa5bc35e1bbbd2a63a6d24aed9e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"api-の挙動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#api-%E3%81%AE%E6%8C%99%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAPI の挙動\u003c/h1\u003e\n\n\u003cp\u003e実際に API キー を設定した場合の API の挙動について確認してみました。\u003cbr\u003e\n以下のケースで行ってみました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ex-api-key を設定していない場合\u003c/li\u003e\n\u003cli\u003ex-api-key が不正な場合\u003c/li\u003e\n\u003cli\u003ex-api-key が正常な場合\u003c/li\u003e\n\u003cli\u003equota の上限を超えた場合\u003c/li\u003e\n\u003cli\u003ethrottle の上限を超えた場合\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAPI キーをリクエストに設定する場合は、リクエストヘッダーの \u003cstrong\u003e\u003ccode\u003ex-api-key\u003c/code\u003e\u003c/strong\u003e というキーに対して、API キーの値を設定します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"x-api-key-を設定していない場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#x-api-key-%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ex-api-key を設定していない場合\u003c/h2\u003e\n\n\u003cp\u003e・方法： \u003ccode\u003ex-api-key\u003c/code\u003e をリクエストヘッダーで設定しない\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/e36be3bf59fbb2a22a055fcce0747a2c298ccb7e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f66346265653936642d303262382d326334662d363861332d6162636330313131653031632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Ff4bee96d-02b8-2c4f-68a3-abcc0111e01c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=facb709b70851b8a06a908a2d6375e38\" alt=\"aa.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/f4bee96d-02b8-2c4f-68a3-abcc0111e01c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Ff4bee96d-02b8-2c4f-68a3-abcc0111e01c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6c65610fea96ed244db191e3e0e3969d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n【結果】\u003cbr\u003e\n・ Stats: 403 Forbidden\u003cbr\u003e\n・ Response body: {\"message\":\"Forbidden\"}\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"x-api-key-が不正な場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#x-api-key-%E3%81%8C%E4%B8%8D%E6%AD%A3%E3%81%AA%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ex-api-key が不正な場合\u003c/h2\u003e\n\n\u003cp\u003e・方法： \u003ccode\u003ex-api-key\u003c/code\u003e に不正な値（hogehoge）を使用する\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/8a59645384fa5833b18aedc4ab3532d485fb32c7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f64613830353234392d626534632d663533622d326337642d3136376264663239663462642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fda805249-be4c-f53b-2c7d-167bdf29f4bd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2c0c5070f8ee3118a81f368821c53e3a\" alt=\"bb.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/da805249-be4c-f53b-2c7d-167bdf29f4bd.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fda805249-be4c-f53b-2c7d-167bdf29f4bd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=19bb401d61491c2be9af7523bc1ba2b2 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n【結果】\u003cbr\u003e\n・ Stats: 403 Forbidden\u003cbr\u003e\n・ Response body: {\"message\":\"Forbidden\"}\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"x-api-key-が正常な場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#x-api-key-%E3%81%8C%E6%AD%A3%E5%B8%B8%E3%81%AA%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ex-api-key が正常な場合\u003c/h2\u003e\n\n\u003cp\u003e・方法： \u003ccode\u003ex-api-key\u003c/code\u003e に正常な値（a123456789012345678901234567890）を使用する\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/2d11d09b501f4aa8ec950f9afe33ecb4c8d3cd7c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f38633532653630662d656461362d393863612d303162372d3530643834613238653438362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F8c52e60f-eda6-98ca-01b7-50d84a28e486.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=528cb61b1eace8a8529070b6c68894bd\" alt=\"cc.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/8c52e60f-eda6-98ca-01b7-50d84a28e486.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F8c52e60f-eda6-98ca-01b7-50d84a28e486.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c64aa24cce43880b9142619ff4ad977b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n【結果】\u003cbr\u003e\n・Stats: 200 OK\u003cbr\u003e\n・Response body: 正常なレスポンス\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"quota-の上限を超えた場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#quota-%E3%81%AE%E4%B8%8A%E9%99%90%E3%82%92%E8%B6%85%E3%81%88%E3%81%9F%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003equota の上限を超えた場合\u003c/h2\u003e\n\n\u003cp\u003e・方法： quota の設定をかなり低くしてリクエスト回数の上限を超えてリクエストする\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/1f5bd46bda2b5fc63a745f73e17ac64315085a82/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f30616530303433312d353634652d303062632d396165382d6338313532623063323435352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F0ae00431-564e-00bc-9ae8-c8152b0c2455.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d95e6de43a8406b1a1b925364bcaed52\" alt=\"d 2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/0ae00431-564e-00bc-9ae8-c8152b0c2455.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F0ae00431-564e-00bc-9ae8-c8152b0c2455.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6f35bead554003f1dead795f1eeb04d8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n【結果】\u003cbr\u003e\n・Stats: 429 Too Many Requests\u003cbr\u003e\n・Response body: \u003cstrong\u003e{\"message\":\"Limit Exceeded\"}\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"throttle-の上限を超えた場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#throttle-%E3%81%AE%E4%B8%8A%E9%99%90%E3%82%92%E8%B6%85%E3%81%88%E3%81%9F%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ethrottle の上限を超えた場合\u003c/h2\u003e\n\n\u003cp\u003e・方法： throttle の上限をかなり低く設定して 100 件連続でリクエストを投じる\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/5bcd08ffd503b397cc7c2c752ce79005bb948a12/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f36323538323464312d643433642d626534362d376634642d3833656238383736623066642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F625824d1-d43d-be46-7f4d-83eb8876b0fd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7d92eacbeb8e4e4716903e009d7ec918\" alt=\"qqqqq.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/625824d1-d43d-be46-7f4d-83eb8876b0fd.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F625824d1-d43d-be46-7f4d-83eb8876b0fd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fa6d4c3b58e6bbd23107ae0b49c3b505 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n【結果】\u003cbr\u003e\n・Stats: 429 Too Many Requests\u003cbr\u003e\n・Response body: \u003cstrong\u003e{\"message\":\"Too Many Requests\"}\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"検証結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A4%9C%E8%A8%BC%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e検証結果\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003ex-api-key を設定していない場合\n\n\u003cul\u003e\n\u003cli\u003eStats: 403 Forbidden\u003c/li\u003e\n\u003cli\u003eResponse body: {\"message\":\"Forbidden\"}\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ex-api-key を設定していない場合\n\n\u003cul\u003e\n\u003cli\u003eStats: 403 Forbidden\u003c/li\u003e\n\u003cli\u003eResponse body: {\"message\":\"Forbidden\"}\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ex-api-key が正常な場合\n\n\u003cul\u003e\n\u003cli\u003eStats: 200 OK\u003c/li\u003e\n\u003cli\u003eResponse body: 正常なレスポンス\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003equota の上限を超えた場合\n\n\u003cul\u003e\n\u003cli\u003eStats: 429 Too Many Requests\u003c/li\u003e\n\u003cli\u003eResponse body: \u003cstrong\u003e{\"message\":\"Limit Exceeded\"}\u003c/strong\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ethrottle の上限を超えた場合\n\n\u003cul\u003e\n\u003cli\u003eStats: 429 Too Many Requests\u003c/li\u003e\n\u003cli\u003eResponse body: \u003cstrong\u003e{\"message\":\"Too Many Requests\"}\u003c/strong\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003equota、throttle の上限を超えた場合は両方とも \u003ccode\u003eStats: 429 Too Many Requests\u003c/code\u003e でしたが、Response body の値が違うようですね。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"api-gateway-コンソールでの確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#api-gateway-%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%81%A7%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eAPI Gateway コンソールでの確認\u003c/h1\u003e\n\n\u003cp\u003eserverless.yml で記述した設定は API Gateway の API キーの設定に反映されます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/a145e6957b2e8926819bfd82b83631f753638148/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f65646237643931322d633063632d663863332d623764342d6639643435623766393239322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fedb7d912-c0cc-f8c3-b7d4-f9d45b7f9292.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=480f465762c7d0ceacc4f1eefe78550e\" alt=\"スクリーンショット 2020-12-12 21.10.12.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/edb7d912-c0cc-f8c3-b7d4-f9d45b7f9292.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fedb7d912-c0cc-f8c3-b7d4-f9d45b7f9292.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3b0ddfd5e849601ef251bb4defba88a3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n使用量も確認することができます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/2e7bdea39e51f9bb59bc08f513ec77ec06abe741/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f65306132396534382d333334652d616630342d623164322d6462356664366537616165642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fe0a29e48-334e-af04-b1d2-db5fd6e7aaed.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0c7f81d13881040b7adc24281ce70622\" alt=\"スクリーンショット 2020-12-12 21.49.53.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/e0a29e48-334e-af04-b1d2-db5fd6e7aaed.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fe0a29e48-334e-af04-b1d2-db5fd6e7aaed.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0261229bde854e31571d3218c5f89220 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考文献\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考文献\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eServerless Framework 公式ドキュメント\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.serverless.com/framework/docs/providers/aws/events/apigateway#setting-api-keys-for-your-rest-api\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSetting API keys for your Rest API\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAWS 公式ドキュメント\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/api-gateway-api-usage-plans.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAPI キーを使用した使用量プランの作成と使用\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eクラスメソッドでの解説\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://dev.classmethod.jp/articles/try-api-gateway-usage-plan/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAPI GatewayのAPIキーと使用量プランについて調べてみた\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://dev.classmethod.jp/articles/api-gateway-usage-plan/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAPI Gateway の API Key を調べてみた\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","body":"# やったこと\n\nこの記事では Serverless Framework で API キーの設定方法や、設定した場合の API の挙動について書いていきたいと思います。\n\n結局のところ serverless.yml で記述するそれらの設定は API Gateway の API キーの設定に反映されます。\n\n# serverless.yml\n\nserverless.yml に記述することで API キーの設定が行うことができます。\n\n今回は serverless.yml は以下のように設定しました。\n\n\n```yaml:serverless.yml\nprovider:\n  # （省略）\n  apiKeys:\n    - free: # 使用量プラン\n        - name: ${opt:stage, self:provider.stage}-free-key # key 名\n          value: a123456789012345678901234567890 # 30-128文字の英数字\n    - mogemoge: # 複数のプランを設定することが可能\n        - ${opt:stage, self:provider.stage}-mogemoge-key # name, value を指定しないと value は自動生成される\n  usagePlan:\n    - free:\n        quota:\n          limit: 1000 # API の呼び出しを行える最大回数\n          offset: 2 # API の呼び出し回数の初期値（通常は 0 回を指定する）\n          period: MONTH # DAY or WEEK or MONTH\n        throttle:\n          rateLimit: 2 # 1 秒あたりに処理できる API リクエスト数\n          burstLimit: 3 # 同時に処理できる最大リクエスト数\n    - mogemoge:\n        quota:\n          limit: 50000\n          offset: 1\n          period: MONTH\n        throttle:\n          burstLimit: 2000\n          rateLimit: 1000\n\n# （省略）\n\nfunctions:\n  hello:\n    handler: handler.hello\n    events:\n      - http:\n          path: hello\n          method: get\n          private: true # API キーを有効にするエンドポイントは true にする\n```\n\napiKeys, quota, throttle の設定についてコメントで注釈をいれました。\n\nさらに詳しいことは以下を参考にしてください。\n\n【参考】\n・[API Gateway の API Key を調べてみた](https://dev.classmethod.jp/articles/api-gateway-usage-plan/)\n・[API リクエストを調整してスループットを向上させる](https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/api-gateway-request-throttling.html)\n\n**個人的に思うこととして、API キーの値は自動生成させるのではなく、値を固定して運用することがほとんどだと思います。**\n\nデプロイごとに API キーが変わると、今まで使用していた API キーでアクセスするとエラーになってしまうので、もし、自動生成としている場合、クライアント側と API 側は常に同時にアップデートしなければならない制約が設けられます。\n\nかといって、『ソースコード上に API キーの値を直接書くことはセキュリティ上よくないのでは？』と思いますが、そもそも論として、API キーは唯一の認証には使用してはいけなく、リクエストの制限を行うユーザーをグループとして管理するために用いるものであるので、ソースコード上にベタに書いても問題ないと思います。（もちろん、認証の仕組みは別に設ける必要がありますが。）\n\n# API キーの作成\n\n上記のように serverless.yml を設定して `sls deploy` するだけです。\n\n```\n$ sls deploy\n```\n\nデプロイに成功するとコンソールの最後の方に API キーが出力されると思います。\n\n削除は `sls remove` で削除\n\n# API キーの確認\n\nちなみに API キーの確認は `sls info` コマンド実行すれば、いつでも可能です。\nもちろん sls deploy コマンド実行時のコンソールに API キーの値が出力されます。\n\n```\n$ sls info\n```\n![aaa.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/ebbfd47c-2aa4-e526-c2cc-23b1601f3b28.png)\n\n# API の挙動\n\n実際に API キー を設定した場合の API の挙動について確認してみました。\n以下のケースで行ってみました。\n\n- x-api-key を設定していない場合\n- x-api-key が不正な場合\n- x-api-key が正常な場合\n- quota の上限を超えた場合\n- throttle の上限を超えた場合\n\nAPI キーをリクエストに設定する場合は、リクエストヘッダーの **`x-api-key`** というキーに対して、API キーの値を設定します。\n\n## x-api-key を設定していない場合\n\n・方法： `x-api-key` をリクエストヘッダーで設定しない\n![aa.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/f4bee96d-02b8-2c4f-68a3-abcc0111e01c.png)\n【結果】\n・ Stats: 403 Forbidden\n・ Response body: {\"message\":\"Forbidden\"}\n\n## x-api-key が不正な場合\n\n・方法： `x-api-key` に不正な値（hogehoge）を使用する\n![bb.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/da805249-be4c-f53b-2c7d-167bdf29f4bd.png)\n【結果】\n・ Stats: 403 Forbidden\n・ Response body: {\"message\":\"Forbidden\"}\n\n## x-api-key が正常な場合\n\n・方法： `x-api-key` に正常な値（a123456789012345678901234567890）を使用する\n![cc.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/8c52e60f-eda6-98ca-01b7-50d84a28e486.png)\n【結果】\n・Stats: 200 OK\n・Response body: 正常なレスポンス\n\n## quota の上限を超えた場合\n\n・方法： quota の設定をかなり低くしてリクエスト回数の上限を超えてリクエストする\n![d 2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/0ae00431-564e-00bc-9ae8-c8152b0c2455.png)\n【結果】\n・Stats: 429 Too Many Requests\n・Response body: **{\"message\":\"Limit Exceeded\"}**\n\n## throttle の上限を超えた場合\n\n・方法： throttle の上限をかなり低く設定して 100 件連続でリクエストを投じる\n![qqqqq.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/625824d1-d43d-be46-7f4d-83eb8876b0fd.png)\n【結果】\n・Stats: 429 Too Many Requests\n・Response body: **{\"message\":\"Too Many Requests\"}**\n\n## 検証結果\n\n- x-api-key を設定していない場合\n  - Stats: 403 Forbidden\n  - Response body: {\"message\":\"Forbidden\"}\n- x-api-key を設定していない場合\n  - Stats: 403 Forbidden\n  - Response body: {\"message\":\"Forbidden\"}\n- x-api-key が正常な場合\n  - Stats: 200 OK\n  - Response body: 正常なレスポンス\n- quota の上限を超えた場合\n  - Stats: 429 Too Many Requests\n  - Response body: **{\"message\":\"Limit Exceeded\"}**\n- throttle の上限を超えた場合\n  - Stats: 429 Too Many Requests\n  - Response body: **{\"message\":\"Too Many Requests\"}**\n\nquota、throttle の上限を超えた場合は両方とも `Stats: 429 Too Many Requests` でしたが、Response body の値が違うようですね。\n\n# API Gateway コンソールでの確認\n\nserverless.yml で記述した設定は API Gateway の API キーの設定に反映されます。\n![スクリーンショット 2020-12-12 21.10.12.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/edb7d912-c0cc-f8c3-b7d4-f9d45b7f9292.png)\n使用量も確認することができます。\n![スクリーンショット 2020-12-12 21.49.53.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/e0a29e48-334e-af04-b1d2-db5fd6e7aaed.png)\n\n# 参考文献\n\n- Serverless Framework 公式ドキュメント\n  - [Setting API keys for your Rest API](https://www.serverless.com/framework/docs/providers/aws/events/apigateway#setting-api-keys-for-your-rest-api)\n- AWS 公式ドキュメント\n  - [API キーを使用した使用量プランの作成と使用](https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/api-gateway-api-usage-plans.html)\n- クラスメソッドでの解説\n  - [API GatewayのAPIキーと使用量プランについて調べてみた](https://dev.classmethod.jp/articles/try-api-gateway-usage-plan/)\n  - [API Gateway の API Key を調べてみた](https://dev.classmethod.jp/articles/api-gateway-usage-plan/)\n","coediting":false,"comments_count":0,"created_at":"2020-12-12T20:44:42+09:00","group":null,"id":"790c23db9dc59d3f7d55","likes_count":4,"private":false,"reactions_count":0,"tags":[{"name":"APIGateway","versions":[]},{"name":"ServerlessFramework","versions":[]},{"name":"apikey","versions":[]}],"title":"【AWS】【Serverless Framework】API キーの設定（リクエストの制限の設定）","updated_at":"2021-03-01T15:57:58+09:00","url":"https://qiita.com/ikuraikura/items/790c23db9dc59d3f7d55","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/sugurutakahashi12345/items/8eafa9ef6ce26531290a\" id=\"reference-18c2e0ad26f0bb97241c\"\u003eこちら\u003c/a\u003eの記事の続編です。\u003cbr\u003e\n（※ 読まなくても大丈夫です。）\u003c/p\u003e\n\n\u003cp\u003eServerless Framework で REST API をデプロイすると、AWS 側で以下のようなドメインが発行されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ehttps://5tjwpqfgo2.execute-api.us-east-1.amazonaws.com/dev/hello\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのドメインに含まれる \u003ccode\u003e5tjwpqfgo2\u003c/code\u003e という値は、こちらで何も設定しないとデプロイするごとに毎回変更されてしまい、使い勝手がよくないです。\u003c/p\u003e\n\n\u003cp\u003eなので、これをカスタムドメインで固定しようというのが、今回やりたいことになります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"サマリー\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B5%E3%83%9E%E3%83%AA%E3%83%BC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eサマリー\u003c/h1\u003e\n\n\u003cp\u003e以下を Serverless Framework で実現しました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eカスタムドメインを指定できるようにすること\u003c/li\u003e\n\u003cli\u003e開発環境と本番環境で異なるカスタムドメインを指定できるようにすること\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eその結果、REST API のパスが以下のように固定することができるようになりました。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eBefore\n\n\u003cul\u003e\n\u003cli\u003eURL：\u003ccode\u003ehttps://xxxxxxx.execute-api.us-east-1.amazonaws.com/dev/hello\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e備考：URL の \u003ccode\u003exxxxxxx\u003c/code\u003e の部分はデプロイするたびに変わる\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAfter\n\n\u003cul\u003e\n\u003cli\u003e開発環境 URL：\u003ccode\u003ehttps://dev.suguru-takahashi.com/api/hello\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e本番環境 URL：\u003ccode\u003ehttps://suguru-takahashi.com/api/hello\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e備考：カスタムドメインは固定である\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e全体構成図は以下のようになります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f2102125e50e3f0c0c08360e101e06e1890f819b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f65363432323030322d616161322d393531352d613336612d3035633930313134616433302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fe6422002-aaa2-9515-a36a-05c90114ad30.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d8b016d31c420eeb3a9fa5f80584659b\" alt=\"png.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/e6422002-aaa2-9515-a36a-05c90114ad30.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fe6422002-aaa2-9515-a36a-05c90114ad30.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3cfd31be375b165e802a820a46ff756f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e全体のソースコードは\u003ca href=\"https://github.com/suguruTakahashi-1234/sls-hogehoge\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちら\u003c/a\u003eにあげました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"やりたいこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやりたいこと\u003c/h1\u003e\n\n\u003cp\u003eやりたいことは以下の 2 つです。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eカスタムドメインを指定できるようにすること\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e開発環境と本番環境で異なるカスタムドメインを使用すること\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eこれを↓\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eカスタム度名指定前（Before）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ehttps://5tjwpqfgo2.execute-api.us-east-1.amazonaws.com/dev/hello\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこうしたい↓\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eカスタムドメイン指定後（After その1）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ehttps://mogemoge.suguru-takahashi.com/api/hello\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eそして、以下のように開発環境と本番環境で URL を分けたい↓\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e開発環境（After その2）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ehttps://dev.suguru-takahashi.com/api/hello\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e本番環境（After その2）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ehttps://suguru-takahashi.com/api/hello\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"全体構成図\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%A8%E4%BD%93%E6%A7%8B%E6%88%90%E5%9B%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e全体構成図\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eカスタムドメイン指定前（Before）\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/619d0eaa8fdaa3351eda06b158ad21fbcef3e0b3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f38323637373038302d386464332d386434622d323539352d3430363335363337666633352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F82677080-8dd3-8d4b-2595-40635637ff35.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f76eea23b429da13dda9131794ff8758\" alt=\"1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/82677080-8dd3-8d4b-2595-40635637ff35.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F82677080-8dd3-8d4b-2595-40635637ff35.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=18b1d67534d515bdd30220dc836e3a8a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eカスタムドメイン指定後（After）\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f2499ccf5f2c10e4d36a40a24a2a8c71192b4221/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f62373931323763362d303235622d323538322d356563352d3762393865316234623361362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fb79127c6-025b-2582-5ec5-7b98e1b4b3a6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=26e970806da4fec9dc4a07f3b98ccf3c\" alt=\"png.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/b79127c6-025b-2582-5ec5-7b98e1b4b3a6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fb79127c6-025b-2582-5ec5-7b98e1b4b3a6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5f0666540de2a02bb542e120223e2483 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこの記事では増築された部分の設定の仕方について触れます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"カスタムドメインを指定できるようにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eカスタムドメインを指定できるようにする\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"前提\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E6%8F%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前提\u003c/h2\u003e\n\n\u003cp\u003e以下の操作はすべて済んでいることを前提に手順を説明します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eServerless Framework 関連の準備\n\n\u003cul\u003e\n\u003cli\u003eカスタムドメインの設定を除いた serverless.yml の設定\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eカスタムドメイン関連の準備\n\n\u003cul\u003e\n\u003cli\u003e外部サービス or Route 53 でのカスタムドメインの取得\u003c/li\u003e\n\u003cli\u003eRoute 53 でのホストゾーンの作成\u003c/li\u003e\n\u003cli\u003eACM での SSL証明書の作成\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eこれらの操作については以下の記事がわかりやすかったです。\u003c/p\u003e\n\n\u003cp\u003e【参考】\u003cbr\u003e\n- \u003ca href=\"https://qiita.com/motchi0214/items/0b43ba924a4814c503e1\" id=\"reference-22af8735f93fc342048d\"\u003eServerless Frameworkでカスタムドメインを設定する\u003c/a\u003e\u003cbr\u003e\n- \u003ca href=\"https://qiita.com/sugurutakahashi12345/items/8eafa9ef6ce26531290a\"\u003e【Serverless Framework 入門】 API Gateway + Lambda + DynamoDB サンプル\u003c/a\u003e（過去記事1）\u003cbr\u003e\n- \u003ca href=\"https://qiita.com/sugurutakahashi12345/items/bd99e6b32e4f5f0e8096\" id=\"reference-d91862fe804a2a7c5fdf\"\u003e【AWS】 Route 53 + ACM + CloudFront + S3 の構成を構築する際につまずいたところ解説\u003c/a\u003e（過去記事2）\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"プラグインのインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプラグインのインストール\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/amplify-education/serverless-domain-manager\" rel=\"nofollow noopener\" target=\"_blank\"\u003eserverless-domain-manager\u003c/a\u003e という npm パッケージのプラグインを使用します。\u003c/p\u003e\n\n\u003cp\u003enpm パッケージなので Serverless Framework のプロジェクトを Node.js で使用しなければならないという縛りはないです。（例えば Python などのプロジェクトでも使用可能）\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e# package.json の作成（すでにあればスキップ）\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003enpm init \u003cspan class=\"nt\"\u003e-y\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e# serverless-domain-manager のインストール\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003enpm \u003cspan class=\"nb\"\u003einstall \u003c/span\u003eserverless-domain-manager \u003cspan class=\"nt\"\u003e--save-dev\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"serverlessyml-の設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#serverlessyml-%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eserverless.yml の設定\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eplugins の設定\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ccode\u003eserverless-domain-manager\u003c/code\u003e を追記するだけです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"yml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eserverless.yml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003eplugins\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003eserverless-domain-manager\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003ecustom の設定\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ccode\u003emogemoge.suguru-takahashi.com/api\u003c/code\u003e というドメインを作成する例になります。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"yml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eserverless.yml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003ecustom\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ecustomDomain\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# API のパスは `https://\u0026lt;domainName\u0026gt;/\u0026lt;basePath\u0026gt;/xxxx` となる\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edomainName\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emogemoge.suguru-takahashi.com\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ebasePath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eapi\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecertificateName\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s\"\u003e*.suguru-takahashi.com'\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecreateRoute53Record\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eendpointType\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s\"\u003eregional'\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esecurityPolicy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etls_1_2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e詳しい設定項目の説明は \u003ca href=\"https://github.com/amplify-education/serverless-domain-manager\" rel=\"nofollow noopener\" target=\"_blank\"\u003eserverless-domain-manager\u003c/a\u003e の公式ドキュメントを参照ください。\u003c/p\u003e\n\n\u003cp\u003e実のところ、Serverless Framework を使用しなくても、以下の AWS 公式ドキュメントの操作を行えば同じことは実現できます。\u003c/p\u003e\n\n\u003cp\u003e【参考】\u003cbr\u003e\n・\u003ca href=\"https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/how-to-custom-domains.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eREST API のカスタムドメイン名を設定する\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eendpointType\u003c/code\u003e などについての設定項目は上記の AWS 公式ドキュメントに詳しく説明があります。\u003c/p\u003e\n\n\u003cp\u003eまた、事前に Route 53 や ACM の設定は必要です。今回は以下のような設定です。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/e61443d50e73124ce8a990f1a4a414b2cbf6aeee/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f64623839353530342d363264642d643437352d646236622d3631613462396663386261632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fdb895504-62dd-d475-db6b-61a4b9fc8bac.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=000ea4c31e702885b0e4a10efec2fa43\" alt=\"a.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/db895504-62dd-d475-db6b-61a4b9fc8bac.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fdb895504-62dd-d475-db6b-61a4b9fc8bac.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0bb53966bdb0d33968cbeec003d548e3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ドメイン設定の-aws-への反映\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E8%A8%AD%E5%AE%9A%E3%81%AE-aws-%E3%81%B8%E3%81%AE%E5%8F%8D%E6%98%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eドメイン設定の AWS への反映\u003c/h2\u003e\n\n\u003cp\u003e以下のコマンドによって、AWS にドメイン設定を反映させます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003esls create_domain\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこのコマンド実行によって Route 53 に A レコードと AAAA レコードの 2 つのレコードが作成されます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/26fc9557f9bdfc756b7aac22574a376aa97d8822/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f37306133346339362d653963342d633733392d616139642d3062643337346635393234352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F70a34c96-e9c4-c739-aa9d-0bd374f59245.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=22523e3f2aa28cf26a4d9c35b9a5ed49\" alt=\"b.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/70a34c96-e9c4-c739-aa9d-0bd374f59245.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F70a34c96-e9c4-c739-aa9d-0bd374f59245.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=29b968af814bb7c1ebe4ccde8310d448 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e【参考】\u003cbr\u003e\n・\u003ca href=\"https://qiita.com/leomaro7/items/7d717077dd9165357f16\" id=\"reference-19f7dba3054af1b3cd7c\"\u003eDNSレコード\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"デプロイ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデプロイ\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003esls deploy\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"挙動の確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8C%99%E5%8B%95%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e挙動の確認\u003c/h2\u003e\n\n\u003cp\u003eServerless Framework のデフォルトで配置されている \u003ccode\u003e/hello\u003c/code\u003e の API で挙動を確認します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eA. 今まで通りの AWS が発行のドメインでアクセスする\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eコンソールにでている AWS 側から発行される \u003ccode\u003ehttps://xxxxx.execute-api.us-east-1.amazonaws.com/dev/hello\u003c/code\u003e というドメインでもアクセスできます。\u003c/p\u003e\n\n\u003cp\u003e※ \u003ccode\u003e/dev\u003c/code\u003e の部分は API Gateway 側のステージ名が反映されます。Serverless Framework でのデフォルトのステージ名は dev になります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/af40dbf6a12cc5cdc4eb273c3bc3201c8b5ad81c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f66333435336135332d383237382d333666612d386465662d3338633565623731666435382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Ff3453a53-8278-36fa-8def-38c5eb71fd58.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1ec427458648b0657f2fb347c29d55f4\" alt=\"c.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/f3453a53-8278-36fa-8def-38c5eb71fd58.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Ff3453a53-8278-36fa-8def-38c5eb71fd58.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ab51fe8c53d9d32126c88751fcf117a5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nもちろん、証明書は AWS が用意したものになります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/7d8a9975ba860761a1aa0b46b423b55cc37e9ae8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f31323139353135332d393534362d363432342d393861382d6632333631366262656136612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F12195153-9546-6424-98a8-f23616bbea6a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=307b413499cd3ebf60a6b03112e89f5f\" alt=\"c-1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/12195153-9546-6424-98a8-f23616bbea6a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F12195153-9546-6424-98a8-f23616bbea6a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d55d97c3ff248d5348c5b4568839c7bb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eB. カスタムドメインでアクセスする（本命）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e設定した以下のカスタムドメインでアクセスでします。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ehttps://mogemoge.suguru-takahashi.com/api/hello\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/91bfd6aa5ce0a742b6c4d9c10608bce4e737f3b6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f62366666396237342d313735302d313866332d666362632d3230623037666534636231332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fb6ff9b74-1750-18f3-fcbc-20b07fe4cb13.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a33f1b683d43ae166766f215f658889d\" alt=\"d.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/b6ff9b74-1750-18f3-fcbc-20b07fe4cb13.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fb6ff9b74-1750-18f3-fcbc-20b07fe4cb13.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=15a19a5789a85801fa92d1d093838ac4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e証明書は ACM に登録したものが設定されています。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/7dd02e90aa82c29daec18b4b0f5b48c103aa614c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f66353632613431352d323766322d643066612d653864392d6462333731323738336235312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Ff562a415-27f2-d0fa-e8d9-db3712783b51.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7bda86357335218bb6824588f837d27e\" alt=\"e.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/f562a415-27f2-d0fa-e8d9-db3712783b51.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Ff562a415-27f2-d0fa-e8d9-db3712783b51.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5294a6959a0c8546d0e3cddde11e8b4e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nAPI Gateway の設定も確認してみます。以下の画像のように Route 53 に挿入された A レコードと AAAA レコードの対応通りになっていることが確認できます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c43f1d04f9bd482868e95b1d9cb6ca912722fc55/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f63656636613532362d663632382d376530312d323137332d3838333263313339623137622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fcef6a526-f628-7e01-2173-8832c139b17b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=17414381f5749c6ce245f35183d6633c\" alt=\"f.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/cef6a526-f628-7e01-2173-8832c139b17b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fcef6a526-f628-7e01-2173-8832c139b17b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=57db3d7ed19a802e1606a783119fd01b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nserverless.yml で設定した \u003ccode\u003ebasePath: api\u003c/code\u003e も反映されていることが確認できます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/646fd2228776bc51a8ab0874ed5e977939dc3641/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f62333031333133362d613233382d393465362d613230302d3532313537323032633738642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fb3013136-a238-94e6-a200-52157202c78d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2feff569757ed2a80296d5844c49c04f\" alt=\"f-2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/b3013136-a238-94e6-a200-52157202c78d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fb3013136-a238-94e6-a200-52157202c78d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d50faa331a56d5f2063548fa98414659 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"プロジェクトの削除\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E5%89%8A%E9%99%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプロジェクトの削除\u003c/h2\u003e\n\n\u003cp\u003eこちらのコマンドでプロジェクトは削除されます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ sls remove\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e先にドメイン設定を削除してしまうと、プロジェクトの削除に失敗するおそれがあるので注意してください。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ドメイン設定の削除\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E8%A8%AD%E5%AE%9A%E3%81%AE%E5%89%8A%E9%99%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eドメイン設定の削除\u003c/h2\u003e\n\n\u003cp\u003e以下のコマンドによって、AWS にドメイン設定を反映させます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003esls delete_domain\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eRoute 53 を確認すると \u003ccode\u003esls create_domain\u003c/code\u003e で作成された A レコードおよび AAAA レコードが削除されていることが確認できます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/30647d121dcf759d486755a7a1b3a2ef55b91282/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f66396338346664362d326630392d633038312d363635352d3338646535336432633739332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Ff9c84fd6-2f09-c081-6655-38de53d2c793.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bd4b20a2d18202f1cb3dbe4a3688d814\" alt=\"g.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/f9c84fd6-2f09-c081-6655-38de53d2c793.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Ff9c84fd6-2f09-c081-6655-38de53d2c793.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ba1785c470cc8e123dd15f13d9d883ab 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"運用\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%81%8B%E7%94%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e運用\u003c/h2\u003e\n\n\u003cp\u003eserverless-domain-manager のインストールと serverless.yml の設定が完了すれば、実運用としては以下のコマンドでカスタムドメインを設定した REST API のデプロイから削除までを行うことができます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e# ドメイン作成\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003esls create_domain\n\n\u003cspan class=\"c\"\u003e# プロジェクト作成\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003esls deploy\n\n\u003cspan class=\"c\"\u003e# プロジェクト削除\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003esls remove\n\n\u003cspan class=\"c\"\u003e# ドメイン削除\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003esls delete_domain\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eServerless Framework でのカスタムドメイン設定の基礎的な部分は以上になります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"開発環境と本番環境で異なるカスタムドメインを指定できるようにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%81%A8%E6%9C%AC%E7%95%AA%E7%92%B0%E5%A2%83%E3%81%A7%E7%95%B0%E3%81%AA%E3%82%8B%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e開発環境と本番環境で異なるカスタムドメインを指定できるようにする\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003esls create_domain\u003c/code\u003e の実行時に \u003ccode\u003esls deploy\u003c/code\u003e のときと同様にコマンド実行時に \u003ccode\u003e--stage \u0026lt;ステージ名\u0026gt;\u003c/code\u003e で stage を設定することができるので、それを利用して開発環境と本番環境で異なるカスタムドメインを指定します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"前提-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E6%8F%90-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前提\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e『その 1：カスタムを指定できるようにする』が完了していること\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"serverlessyml-の設定-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#serverlessyml-%E3%81%AE%E8%A8%AD%E5%AE%9A-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eserverless.yml の設定\u003c/h2\u003e\n\n\u003cp\u003e変更するのは \u003ccode\u003eserverless.yml\u003c/code\u003e のみです。\u003cbr\u003e\nステージ名、カスタムドメインを以下のように設定します。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e開発環境\n\n\u003cul\u003e\n\u003cli\u003eステージ名：\u003ccode\u003edev\u003c/code\u003e（デフォルト）\u003c/li\u003e\n\u003cli\u003eカスタムドメイン：\u003ccode\u003edev.suguru-takahashi.com\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e本番環境\n\n\u003cul\u003e\n\u003cli\u003eステージ名：\u003ccode\u003eprd\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eカスタムドメイン：\u003ccode\u003esuguru-takahashi.com\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"yml\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eserverless.yml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003ecustom\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003estage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${opt:stage, self:provider.stage}\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eendpoint\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edev\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"s\"\u003edev.suguru-takahashi.com\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eprd\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"s\"\u003esuguru-takahashi.com\"\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ecustomDomain\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edomainName\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${self:custom.endpoint.${self:custom.stage}}\u003c/span\u003e\n    \u003cspan class=\"na\"\u003estage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${self:custom.stage}\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ebasePath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eapi\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecertificateName\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s\"\u003e*.suguru-takahashi.com'\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecreateRoute53Record\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eendpointType\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s\"\u003eregional'\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esecurityPolicy\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etls_1_2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003ecustom.stage\u003c/code\u003e, \u003ccode\u003ecustom.endpoint\u003c/code\u003e はという名称は引数名なので何でもよいです。\u003c/p\u003e\n\n\u003cp\u003eここでのポイントはステージ名を \u003ccode\u003edomainName\u003c/code\u003e に埋め込むようにすると本番環境のカスタムドメインが \u003ccode\u003eprd.suguru-takahashi.com\u003c/code\u003e なってしまい \u003ccode\u003eprd\u003c/code\u003e が格好悪いので、\u003ccode\u003ecustom.endpoint\u003c/code\u003e をクッションにおいて自由なカスタムドメインを設定できるようにしています。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"開発環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e開発環境\u003c/h2\u003e\n\n\u003cp\u003e開発環境はデフォルトでステージ名が \u003ccode\u003edev\u003c/code\u003e なので、デプロイと削除のコマンドに変更はありません。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e# ドメイン作成\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003esls create_domain\n\n\u003cspan class=\"c\"\u003e# プロジェクト作成\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003esls deploy\n\n\u003cspan class=\"c\"\u003e# プロジェクト削除\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003esls remove\n\n\u003cspan class=\"c\"\u003e# ドメイン削除\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003esls delete_domain\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e※ もちろん、\u003ccode\u003e--stage dev\u003c/code\u003e とオプションをつけても同様の挙動になります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"本番環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%AC%E7%95%AA%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e本番環境\u003c/h2\u003e\n\n\u003cp\u003e開発環境との違いはコマンド実行時に \u003ccode\u003e--stage \u0026lt;ステージ名\u0026gt;\u003c/code\u003e のオプションでステージ名を \u003ccode\u003eprd\u003c/code\u003e と指定してあげるだけです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"shell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e# ドメイン作成\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003esls create_domain \u003cspan class=\"nt\"\u003e--stage\u003c/span\u003e prd\n\n\u003cspan class=\"c\"\u003e# プロジェクト作成\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003esls deploy \u003cspan class=\"nt\"\u003e--stage\u003c/span\u003e prd\n\n\u003cspan class=\"c\"\u003e# プロジェクト削除\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003esls remove \u003cspan class=\"nt\"\u003e--stage\u003c/span\u003e prd\n\n\u003cspan class=\"c\"\u003e# ドメイン削除\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003esls delete_domain \u003cspan class=\"nt\"\u003e--stage\u003c/span\u003e prd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e※ あえて、serverless.yml 内で設定していないようなステージ名を \u003ccode\u003e--stage \u0026lt;ステージ名\u0026gt;\u003c/code\u003e でわたすと serverless.yml での変数名が解決できず、デプロイに失敗してくれます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"挙動の確認-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8C%99%E5%8B%95%E3%81%AE%E7%A2%BA%E8%AA%8D-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e挙動の確認\u003c/h2\u003e\n\n\u003cp\u003e開発環境と本番環境のデプロイ後の AWS コンソールを確認すると以下のようになります。\u003c/p\u003e\n\n\u003cp\u003e両方の環境が別々のドメインがふられていることが確認できます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eRoute 53\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/aa848a3f89e9a2246f1cadf9f7d24c3fa6cf7c78/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f33323661643363322d353734642d393039382d333531322d3735393931643333383832342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F326ad3c2-574d-9098-3512-75991d338824.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7f7c48facf3de8667226f24337c2ba36\" alt=\"x.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/326ad3c2-574d-9098-3512-75991d338824.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F326ad3c2-574d-9098-3512-75991d338824.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=946195813f65267594024fa0b35fb44d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eAPI Gateway\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/67a6955d56f5b0c33f3d4d02a37cd8cb3e570640/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f37303832613132302d303130322d623261322d363238392d3731663062356534383664382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F7082a120-0102-b2a2-6289-71f0b5e486d8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=54cd942dc0f734001fc160afb3fa3040\" alt=\"y.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/7082a120-0102-b2a2-6289-71f0b5e486d8.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F7082a120-0102-b2a2-6289-71f0b5e486d8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7e948d0d01e1b702c055df6228efde25 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e以上になります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考文献\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考文献\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eServerless Framework 公式のブログでの解説\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.serverless.com/blog/serverless-api-gateway-domain\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHow to set up a custom domain name for Lambda \u0026amp; API Gateway with Serverless\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eserverless-domain-manager\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/amplify-education/serverless-domain-manager\" rel=\"nofollow noopener\" target=\"_blank\"\u003eserverless-domain-manager\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eわかりやすかった記事\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://blog.katsubemakito.net/aws/lambda-with-serverless-framework2\" rel=\"nofollow noopener\" target=\"_blank\"\u003e[AWS] Serverless FrameworkでカスタムドメインをSSL付きで設定する\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e開発環境/本番環境の切り替えで参考になった資料\u003c/li\u003e\n\u003c/ul\u003e\n","body":"# はじめに\n\n[こちら](https://qiita.com/sugurutakahashi12345/items/8eafa9ef6ce26531290a)の記事の続編です。\n（※ 読まなくても大丈夫です。）\n\nServerless Framework で REST API をデプロイすると、AWS 側で以下のようなドメインが発行されます。\n\n```\nhttps://5tjwpqfgo2.execute-api.us-east-1.amazonaws.com/dev/hello\n```\n\nこのドメインに含まれる `5tjwpqfgo2` という値は、こちらで何も設定しないとデプロイするごとに毎回変更されてしまい、使い勝手がよくないです。\n\nなので、これをカスタムドメインで固定しようというのが、今回やりたいことになります。\n\n\n# サマリー\n\n以下を Serverless Framework で実現しました。\n\n- カスタムドメインを指定できるようにすること\n- 開発環境と本番環境で異なるカスタムドメインを指定できるようにすること\n\nその結果、REST API のパスが以下のように固定することができるようになりました。\n\n- Before\n  - URL：`https://xxxxxxx.execute-api.us-east-1.amazonaws.com/dev/hello`\n  - 備考：URL の `xxxxxxx` の部分はデプロイするたびに変わる\n- After\n  - 開発環境 URL：`https://dev.suguru-takahashi.com/api/hello`\n  - 本番環境 URL：`https://suguru-takahashi.com/api/hello`\n  - 備考：カスタムドメインは固定である\n\n全体構成図は以下のようになります。\n![png.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/e6422002-aaa2-9515-a36a-05c90114ad30.png)\n\n\n全体のソースコードは[こちら](https://github.com/suguruTakahashi-1234/sls-hogehoge)にあげました。\n\n\n# やりたいこと\n\nやりたいことは以下の 2 つです。\n\n1. **カスタムドメインを指定できるようにすること**\n2. **開発環境と本番環境で異なるカスタムドメインを使用すること**\n \nこれを↓\n\n- カスタム度名指定前（Before）\n\n```\nhttps://5tjwpqfgo2.execute-api.us-east-1.amazonaws.com/dev/hello\n```\n\nこうしたい↓\n\n- カスタムドメイン指定後（After その1）\n\n```\nhttps://mogemoge.suguru-takahashi.com/api/hello\n```\n\nそして、以下のように開発環境と本番環境で URL を分けたい↓\n\n- 開発環境（After その2）\n\n```\nhttps://dev.suguru-takahashi.com/api/hello\n```\n\n- 本番環境（After その2）\n\n```\nhttps://suguru-takahashi.com/api/hello\n```\n\n# 全体構成図\n\n- カスタムドメイン指定前（Before）\n![1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/82677080-8dd3-8d4b-2595-40635637ff35.png)\n\n- カスタムドメイン指定後（After）\n![png.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/b79127c6-025b-2582-5ec5-7b98e1b4b3a6.png)\n\n\nこの記事では増築された部分の設定の仕方について触れます。\n\n# カスタムドメインを指定できるようにする\n\n## 前提\n\n以下の操作はすべて済んでいることを前提に手順を説明します。\n\n- Serverless Framework 関連の準備\n  - カスタムドメインの設定を除いた serverless.yml の設定\n- カスタムドメイン関連の準備\n  - 外部サービス or Route 53 でのカスタムドメインの取得\n  - Route 53 でのホストゾーンの作成\n  - ACM での SSL証明書の作成\n\nこれらの操作については以下の記事がわかりやすかったです。\n\n【参考】\n- [Serverless Frameworkでカスタムドメインを設定する](https://qiita.com/motchi0214/items/0b43ba924a4814c503e1)\n- [【Serverless Framework 入門】 API Gateway + Lambda + DynamoDB サンプル](https://qiita.com/sugurutakahashi12345/items/8eafa9ef6ce26531290a)（過去記事1）\n- [【AWS】 Route 53 + ACM + CloudFront + S3 の構成を構築する際につまずいたところ解説](https://qiita.com/sugurutakahashi12345/items/bd99e6b32e4f5f0e8096)（過去記事2）\n\n## プラグインのインストール\n\n[serverless-domain-manager](https://github.com/amplify-education/serverless-domain-manager) という npm パッケージのプラグインを使用します。\n\nnpm パッケージなので Serverless Framework のプロジェクトを Node.js で使用しなければならないという縛りはないです。（例えば Python などのプロジェクトでも使用可能）\n\n```shell\n# package.json の作成（すでにあればスキップ）\n$ npm init -y\n\n# serverless-domain-manager のインストール\n$ npm install serverless-domain-manager --save-dev\n```\n\n## serverless.yml の設定\n\n- plugins の設定\n\n`serverless-domain-manager` を追記するだけです。\n\n```yml:serverless.yml\nplugins:\n  - serverless-domain-manager\n```\n\n- custom の設定\n\n`mogemoge.suguru-takahashi.com/api` というドメインを作成する例になります。\n\n```yml:serverless.yml\ncustom:\n  customDomain:\n    # API のパスは `https://\u003cdomainName\u003e/\u003cbasePath\u003e/xxxx` となる\n    domainName: mogemoge.suguru-takahashi.com\n    basePath: api\n    certificateName: '*.suguru-takahashi.com'\n    createRoute53Record: true\n    endpointType: 'regional'\n    securityPolicy: tls_1_2\n```\n\n詳しい設定項目の説明は [serverless-domain-manager](https://github.com/amplify-education/serverless-domain-manager) の公式ドキュメントを参照ください。\n\n実のところ、Serverless Framework を使用しなくても、以下の AWS 公式ドキュメントの操作を行えば同じことは実現できます。\n\n【参考】\n・[REST API のカスタムドメイン名を設定する](https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/how-to-custom-domains.html)\n\n`endpointType` などについての設定項目は上記の AWS 公式ドキュメントに詳しく説明があります。\n\nまた、事前に Route 53 や ACM の設定は必要です。今回は以下のような設定です。\n![a.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/db895504-62dd-d475-db6b-61a4b9fc8bac.png)\n\n## ドメイン設定の AWS への反映\n\n以下のコマンドによって、AWS にドメイン設定を反映させます。\n\n```shell\n$ sls create_domain\n```\n\nこのコマンド実行によって Route 53 に A レコードと AAAA レコードの 2 つのレコードが作成されます。\n![b.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/70a34c96-e9c4-c739-aa9d-0bd374f59245.png)\n\n\n【参考】\n・[DNSレコード](https://qiita.com/leomaro7/items/7d717077dd9165357f16)\n\n## デプロイ\n\n```shell\n$ sls deploy\n```\n\n## 挙動の確認\n\nServerless Framework のデフォルトで配置されている `/hello` の API で挙動を確認します。\n\n- A. 今まで通りの AWS が発行のドメインでアクセスする\n\nコンソールにでている AWS 側から発行される `https://xxxxx.execute-api.us-east-1.amazonaws.com/dev/hello` というドメインでもアクセスできます。\n\n※ `/dev` の部分は API Gateway 側のステージ名が反映されます。Serverless Framework でのデフォルトのステージ名は dev になります。\n![c.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/f3453a53-8278-36fa-8def-38c5eb71fd58.png)\nもちろん、証明書は AWS が用意したものになります。\n![c-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/12195153-9546-6424-98a8-f23616bbea6a.png)\n\n\n- B. カスタムドメインでアクセスする（本命）\n\n設定した以下のカスタムドメインでアクセスでします。\n\n```\nhttps://mogemoge.suguru-takahashi.com/api/hello\n```\n\n![d.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/b6ff9b74-1750-18f3-fcbc-20b07fe4cb13.png)\n\n証明書は ACM に登録したものが設定されています。\n![e.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/f562a415-27f2-d0fa-e8d9-db3712783b51.png)\nAPI Gateway の設定も確認してみます。以下の画像のように Route 53 に挿入された A レコードと AAAA レコードの対応通りになっていることが確認できます。\n![f.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/cef6a526-f628-7e01-2173-8832c139b17b.png)\nserverless.yml で設定した `basePath: api` も反映されていることが確認できます。\n![f-2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/b3013136-a238-94e6-a200-52157202c78d.png)\n\n## プロジェクトの削除\n\nこちらのコマンドでプロジェクトは削除されます。\n\n```\n$ sls remove\n```\n\n先にドメイン設定を削除してしまうと、プロジェクトの削除に失敗するおそれがあるので注意してください。\n\n## ドメイン設定の削除\n\n以下のコマンドによって、AWS にドメイン設定を反映させます。\n\n```shell\n$ sls delete_domain\n```\n\nRoute 53 を確認すると `sls create_domain` で作成された A レコードおよび AAAA レコードが削除されていることが確認できます。\n![g.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/f9c84fd6-2f09-c081-6655-38de53d2c793.png)\n\n## 運用\n\nserverless-domain-manager のインストールと serverless.yml の設定が完了すれば、実運用としては以下のコマンドでカスタムドメインを設定した REST API のデプロイから削除までを行うことができます。\n\n```shell\n# ドメイン作成\n$ sls create_domain\n\n# プロジェクト作成\n$ sls deploy\n\n# プロジェクト削除\n$ sls remove\n\n# ドメイン削除\n$ sls delete_domain\n```\n\nServerless Framework でのカスタムドメイン設定の基礎的な部分は以上になります。\n\n# 開発環境と本番環境で異なるカスタムドメインを指定できるようにする\n\n`sls create_domain` の実行時に `sls deploy` のときと同様にコマンド実行時に `--stage \u003cステージ名\u003e` で stage を設定することができるので、それを利用して開発環境と本番環境で異なるカスタムドメインを指定します。\n\n\n## 前提\n\n- 『その 1：カスタムを指定できるようにする』が完了していること\n\n## serverless.yml の設定\n\n変更するのは `serverless.yml` のみです。\nステージ名、カスタムドメインを以下のように設定します。\n\n- 開発環境\n  - ステージ名：`dev`（デフォルト）\n  - カスタムドメイン：`dev.suguru-takahashi.com`\n- 本番環境\n  - ステージ名：`prd`\n  - カスタムドメイン：`suguru-takahashi.com`\n\n```yml:serverless.yml\ncustom:\n  stage: ${opt:stage, self:provider.stage}\n  endpoint:\n    dev: \"dev.suguru-takahashi.com\"\n    prd: \"suguru-takahashi.com\"\n  customDomain:\n    domainName: ${self:custom.endpoint.${self:custom.stage}}\n    stage: ${self:custom.stage}\n    basePath: api\n    certificateName: '*.suguru-takahashi.com'\n    createRoute53Record: true\n    endpointType: 'regional'\n    securityPolicy: tls_1_2\n```\n\n`custom.stage`, `custom.endpoint` はという名称は引数名なので何でもよいです。\n\nここでのポイントはステージ名を `domainName` に埋め込むようにすると本番環境のカスタムドメインが `prd.suguru-takahashi.com` なってしまい `prd` が格好悪いので、`custom.endpoint` をクッションにおいて自由なカスタムドメインを設定できるようにしています。\n\n## 開発環境\n\n開発環境はデフォルトでステージ名が `dev` なので、デプロイと削除のコマンドに変更はありません。\n\n```shell\n# ドメイン作成\n$ sls create_domain\n\n# プロジェクト作成\n$ sls deploy\n\n# プロジェクト削除\n$ sls remove\n\n# ドメイン削除\n$ sls delete_domain\n```\n\n※ もちろん、`--stage dev` とオプションをつけても同様の挙動になります。\n\n## 本番環境\n\n開発環境との違いはコマンド実行時に `--stage \u003cステージ名\u003e` のオプションでステージ名を `prd` と指定してあげるだけです。\n\n```shell\n# ドメイン作成\n$ sls create_domain --stage prd\n\n# プロジェクト作成\n$ sls deploy --stage prd\n\n# プロジェクト削除\n$ sls remove --stage prd\n\n# ドメイン削除\n$ sls delete_domain --stage prd\n```\n\n※ あえて、serverless.yml 内で設定していないようなステージ名を `--stage \u003cステージ名\u003e` でわたすと serverless.yml での変数名が解決できず、デプロイに失敗してくれます。\n\n## 挙動の確認\n\n開発環境と本番環境のデプロイ後の AWS コンソールを確認すると以下のようになります。\n\n両方の環境が別々のドメインがふられていることが確認できます。\n\n- Route 53\n![x.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/326ad3c2-574d-9098-3512-75991d338824.png)\n\n- API Gateway\n![y.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/7082a120-0102-b2a2-6289-71f0b5e486d8.png)\n\n以上になります。\n\n# 参考文献\n\n- Serverless Framework 公式のブログでの解説\n  - [How to set up a custom domain name for Lambda \u0026 API Gateway with Serverless](https://www.serverless.com/blog/serverless-api-gateway-domain)\n- serverless-domain-manager\n  - [serverless-domain-manager](https://github.com/amplify-education/serverless-domain-manager)\n- わかりやすかった記事\n  - [[AWS] Serverless FrameworkでカスタムドメインをSSL付きで設定する](https://blog.katsubemakito.net/aws/lambda-with-serverless-framework2)\n- 開発環境/本番環境の切り替えで参考になった資料\n","coediting":false,"comments_count":0,"created_at":"2020-12-09T17:00:27+09:00","group":null,"id":"c4e0cf5708a792703b9d","likes_count":1,"private":false,"reactions_count":0,"tags":[{"name":"AWS","versions":[]},{"name":"route53","versions":[]},{"name":"APIGateway","versions":[]},{"name":"CertificateManager","versions":[]},{"name":"ServerlessFramework","versions":[]}],"title":"【AWS】【Serverless Framework】カスタムドメイン設定方法（開発環境と本番環境の分離も考慮）","updated_at":"2021-03-01T15:58:08+09:00","url":"https://qiita.com/ikuraikura/items/c4e0cf5708a792703b9d","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"この記事の対象者\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E5%AF%BE%E8%B1%A1%E8%80%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこの記事の対象者\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e Route 53 + ACM + CloudFront + S3 構成を構築しようと試みている人\u003c/li\u003e\n\u003cli\u003e Route 53 + ACM + CloudFront + S3 構成を構築してみたがいまいち全体像がわからない人\u003c/li\u003e\n\u003cli\u003e AWS で独自ドメインで HTTPS 通信で Web サイトを配信したい人\u003c/li\u003e\n\u003cli\u003e AWS 初心者\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eAWS で Web サイトを独自ドメインで配信するにはどうしたらいいのか調べてたところ、どうも Route 53 + ACM + CloudFront + S3 の構成がスタンダードのようでした。\u003c/p\u003e\n\n\u003cp\u003e【参考】\u003cbr\u003e\n・\u003ca href=\"https://dev.classmethod.jp/articles/static-contents-delivery-patterns/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAWSにおける静的コンテンツ配信パターンカタログ（アンチパターン含む）\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eそして、この構成についての参考になるサイトがたくさん存在します。\u003c/p\u003e\n\n\u003cp\u003e以下リンクになります。\u003c/p\u003e\n\n\u003cp\u003e・\u003ca href=\"https://t-dilemma.info/static-website-hosting-by-aws-2020\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAWSで独自ドメインのhttpsな静的Webサイトを構築する（ACM+S3＋CloudFront+Route53）\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://blog.pirox.dev/2019/03/16/337/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAWSをフル活用してブログをdevドメインに移行した\u003c/a\u003e \u003cbr\u003e\n・\u003ca href=\"https://www.seeds-std.co.jp/blog/creators/2019-12-24-124054/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAmazon S3 + AWS Certificate Manager (ACM) + Amazon CloudFront + オリジンアクセスアイデンティティ(OAI) でhttpsサイト公開\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e特に1番上の記事は全ての手順に画像があるので非常にわかりやすかったです。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e初めはこれらに相当する記事を書こうと思ったのですが、上記のようにそのような記事は既にあったため、\u003cstrong\u003eこの記事は自分が実際に環境を構築した際につまずいたところについて書いていきたいと思います。\u003c/strong\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"つまずいたところ解説\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A4%E3%81%BE%E3%81%9A%E3%81%84%E3%81%9F%E3%81%A8%E3%81%93%E3%82%8D%E8%A7%A3%E8%AA%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eつまずいたところ解説\u003c/h1\u003e\n\n\u003cp\u003e基本的にここのサイトの手順になぞって構築してうまくいきました。\u003cbr\u003e\n・\u003ca href=\"https://t-dilemma.info/static-website-hosting-by-aws-2020\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAWSで独自ドメインのhttpsな静的Webサイトを構築する（ACM+S3＋CloudFront+Route53）\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e個人的につまずいたところを書いていきたいと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"全体感がつかめないこの記事のメイン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%A8%E4%BD%93%E6%84%9F%E3%81%8C%E3%81%A4%E3%81%8B%E3%82%81%E3%81%AA%E3%81%84%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E3%83%A1%E3%82%A4%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e全体感がつかめない（この記事のメイン）\u003c/h2\u003e\n\n\u003cp\u003e解説の記事通りやっても、かなり操作が多いため、途中で自分が何を、何のためにやっているか分からなくなります。\u003c/p\u003e\n\n\u003cp\u003e全体感が分かりやすくなるように、私なりに解説していきます。\u003c/p\u003e\n\n\u003cp\u003eまず、サンプルとして以下の値を設定するとして、\u003cstrong\u003e各サービス別での\u003c/strong\u003e操作を書いていきたいと思います。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"設定値サンプル\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%AD%E5%AE%9A%E5%80%A4%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e設定値（サンプル）\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e独自ドメイン名：\u003ccode\u003ehogehoge.com\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eS3 バケット名：\u003ccode\u003emogemoge-bucket\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e発行される CloudFront ドメイン名：\u003ccode\u003enantoka.cloudfront.net.\u003c/code\u003e ← 実際は設定不可能な値\u003c/li\u003e\n\u003cli\u003e一般ユーザーがサイトにアクセスする際のURL：\u003ccode\u003ehttps://pokapoka.hogehoge.com\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"各サービスごとに実施する操作\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%90%84%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%94%E3%81%A8%E3%81%AB%E5%AE%9F%E6%96%BD%E3%81%99%E3%82%8B%E6%93%8D%E4%BD%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e各サービスごとに実施する操作\u003c/h3\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"独自ドメイン発行サービスお名前com-や-freenom-などもちろん-route-53-でドメインを買ってもよい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%8B%AC%E8%87%AA%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E7%99%BA%E8%A1%8C%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%8A%E5%90%8D%E5%89%8Dcom-%E3%82%84-freenom-%E3%81%AA%E3%81%A9%E3%82%82%E3%81%A1%E3%82%8D%E3%82%93-route-53-%E3%81%A7%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%82%92%E8%B2%B7%E3%81%A3%E3%81%A6%E3%82%82%E3%82%88%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cstrong\u003e独自ドメイン発行サービス（お名前.com や freenom など、もちろん Route 53 でドメインを買ってもよい）\u003c/strong\u003e\n\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003e \u003ccode\u003ehogehoge.com\u003c/code\u003e というドメインを発行する（末尾が \u003ccode\u003e.com\u003c/code\u003e である必要はない）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"route-53\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#route-53\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cstrong\u003eRoute 53\u003c/strong\u003e\n\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ehogehoge.com\u003c/code\u003e の HostedZone （ ＝ DNS レコードを格納できるところ） を作成する（Route 53 でドメインを購入した場合は自動で作成される）\u003c/li\u003e\n\u003cli\u003e （この操作は CloudFront 設定後の作業）CloudFront で代替ドメイン名（CNAMEs）として登録したドメイン \u003ccode\u003epokapoka.hogehoge.com\u003c/code\u003e と、CloudFront \nの Distribution のドメイン \u003ccode\u003enantoka.cloudfront.net.\u003c/code\u003e を結びつけるために ALIAS レコード（A レコード）を挿入する\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"acmaws-certificate-manager\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#acmaws-certificate-manager\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cstrong\u003eACM（AWS Certificate Manager）\u003c/strong\u003e\n\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ehogehoge.com\u003c/code\u003e と \u003ccode\u003e*.hogehoge.com\u003c/code\u003e というドメインに対する証明書を発行する（ワイルドカードを使ってドメインある程度まとめてドメインを発行したほうがあとあと便利）（参考：\u003ca href=\"https://docs.aws.amazon.com/ja_jp/acm/latest/userguide/gs-acm-request-public.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eパブリック証明書のリクエスト\u003c/a\u003e）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"s3\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#s3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cstrong\u003eS3\u003c/strong\u003e\n\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003emogemoge-bucket\u003c/code\u003e というバケットを作成する（今回の構成ではドメイン名と合わせる必要はありません）\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003emogemoge-bucket\u003c/code\u003e を静的ウェブサイトとして公開する\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003emogemoge-bucket\u003c/code\u003e に静的コンテンツをアップロードする（最低限 index.html があればよい）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"cloudfront\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cloudfront\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cstrong\u003eCloudFront\u003c/strong\u003e\n\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003eCloudFront の Distribution 作成する\n\n\u003cul\u003e\n\u003cli\u003eDistribution を S3 の \u003ccode\u003emogemoge-bucket\u003c/code\u003e に指定\u003c/li\u003e\n\u003cli\u003eDistribution の代替ドメイン名 (CNAMEs) を \u003ccode\u003epokapoka.hogehoge.com\u003c/code\u003e と登録する（複数登録することも可能）\u003c/li\u003e\n\u003cli\u003eさきほど ACM で作成した証明書を指定する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eDistribution 作成すると Distribution のドメインが自動的に発行される（\u003ccode\u003enantoka.cloudfront.net.\u003c/code\u003e など）（※このドメイン名は自動発行）\u003c/li\u003e\n\u003cli\u003eDistribution を作成後に CloudFront の Distribution の origin access identity（OAI）の編集から S3 の \u003ccode\u003emogemoge-bucket\u003c/code\u003e へのアクセスを CloudFront を介してのみに制限する（これを行うとワンクリックで \u003ccode\u003emogemoge-bucket\u003c/code\u003e のバケットポリシーが更新される）（これを設定しないと S3 の \u003ccode\u003emogemoge-bucket\u003c/code\u003e は静的ウェブサイトとして公開しているため、CloudFront を経由せずに直接アクセス可能になってしまう）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"操作の結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%93%8D%E4%BD%9C%E3%81%AE%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e操作の結果\u003c/h3\u003e\n\n\u003cp\u003eそして、これらの手順の結果、各 AWS のサービスの状態と、その状態が表す意味は以下のようになります。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"route-53-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#route-53-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRoute 53\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003eCNAME レコード\n\n\u003cul\u003e\n\u003cli\u003eACM の DNS 検証 で挿入したレコード\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003e（解説）\u003c/strong\u003e証明書の発行のときに挿入したよ、普段はとくに使わないよ、このレコードがある間は ACM が証明書の自動更新をやってくれるよ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eA レコード\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003epokapoka.hogehoge.com\u003c/code\u003e = \u003ccode\u003enantoka.cloudfront.net.\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003e（解説）\u003c/strong\u003e\u003ccode\u003epokapoka.hogehoge.com\u003c/code\u003e は \u003ccode\u003enantoka.cloudfront.net.\u003c/code\u003e のフリをするよ、名前解決のときに使うよ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"acmaws-certificate-manager-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#acmaws-certificate-manager-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eACM（AWS Certificate Manager）\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003e証明書\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ehogehoge.com\u003c/code\u003e と \u003ccode\u003e*.hogehoge.com\u003c/code\u003e というドメインに対する証明書\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003e（解説）\u003c/strong\u003eこの証明書は ACM で管理しているよ、一度、証明書を発行したらここの設定を変えることはないよ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"cloudfront-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cloudfront-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCloudFront\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003eDistribution\n\n\u003cul\u003e\n\u003cli\u003eS3 \u003ccode\u003emogemoge-bucket\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003e（解説）\u003c/strong\u003e\u003ccode\u003enantoka.cloudfront.net.\u003c/code\u003e のアクセス先は S3 の \u003ccode\u003emogemoge-bucket\u003c/code\u003e だよ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eDistribution CNAMEs\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003enantoka.cloudfront.net.\u003c/code\u003e = \u003ccode\u003epokapoka.hogehoge.com\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003e（解説）\u003c/strong\u003e\u003ccode\u003enantoka.cloudfront.net.\u003c/code\u003e は \u003ccode\u003epokapoka.hogehoge.com\u003c/code\u003e のフリをするよ、基本的に \u003ccode\u003epokapoka.hogehoge.com\u003c/code\u003e でアクセスされたのを \u003ccode\u003enantoka.cloudfront.net.\u003c/code\u003e に読み替えるよ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eSSL Certificate\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003e*.hogehoge.com\u003c/code\u003e の証明書を設定\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003e（解説）\u003c/strong\u003eこの Distribution では \u003ccode\u003e*.hogehoge.com\u003c/code\u003e の証明書を使うよ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"s3-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#s3-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eS3\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003e静的ウェブサイトホスティング設定\n\n\u003cul\u003e\n\u003cli\u003e有効\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003e（解説）\u003c/strong\u003eHTTP/HTTPS のリクエストがきたら \u003ccode\u003emogemoge-bucket\u003c/code\u003e の中身をWebページとして返却するよ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eパケットポリシー\n\n\u003cul\u003e\n\u003cli\u003eCloudFront のみ OK\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003e（解説）\u003c/strong\u003e\u003ccode\u003emogemoge-bucket\u003c/code\u003e にアクセスにするには必ず CloudFront を経由してくださいね、それ以外の経路でアクセスしたら断ますよ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"全体像\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%A8%E4%BD%93%E5%83%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e全体像\u003c/h3\u003e\n\n\u003cp\u003eここで、全体像を確認したいと思います。\u003c/p\u003e\n\n\u003cp\u003eまず、名前解決を含めた Web サイトにアクセスした際の通信のフローは以下の図のようになります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/10173634fcba68607e8e8ad6abe7f3f8a06b2f46/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f63633735383966352d623563382d646134632d393531612d3361396635323837663662332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fcc7589f5-b5c8-da4c-951a-3a9f5287f6b3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6853eef492f41622ae9caafc70250761\" alt=\"how-route-53-routes-traffic.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/cc7589f5-b5c8-da4c-951a-3a9f5287f6b3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fcc7589f5-b5c8-da4c-951a-3a9f5287f6b3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=80c8b2a6afa9c89b56961d92c3db21a8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e大きく分けて以下のフローに分けれれます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e1 〜 7 ：ドメインの名前解決\u003c/li\u003e\n\u003cli\u003e8 〜 9 ：コンテンツ配信\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eそのフローを、 Route 53 + ACM + CloudFront + S3 構成の全体像で当てはめると以下のようになります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ec76f17dd19e29e172a3ee30376317b1fdc63cea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f62346266366666372d666137302d303339362d303632322d3037353734653938653235322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fb4bf6ff7-fa70-0396-0622-07574e98e252.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4bf0ea7d4d9705f65867a3ab360a2036\" alt=\"img_5f01d1bdc21cb.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/b4bf6ff7-fa70-0396-0622-07574e98e252.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fb4bf6ff7-fa70-0396-0622-07574e98e252.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cb92ac9c89dd7642d127bd22f8859633 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eRoute 53 は 「ドメインの名前解決する役割」 と 「ACM の証明書リクエストを検証する役割」があるということが分かります。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eまた、CloudFront は 「証明書が置いてある Web サーバーとしての役割」 と 「キャッシュサーバーとしての役割」 があることがわかります。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eちなみに、8 〜 9のコンテンツ配信は SSL 通信をしており、その詳細のフローは以下の図のようになります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/d13e3dfa3d86987eb27e6a4f15852073adbc321e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f34643066616533632d346438662d313863652d313064332d3237383634383730616634332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F4d0fae3c-4d8f-18ce-10d3-27864870af43.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8868d81cb817dac57feb97a135773e45\" alt=\"fig02.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/4d0fae3c-4d8f-18ce-10d3-27864870af43.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F4d0fae3c-4d8f-18ce-10d3-27864870af43.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5d054629b03254d746b618fbe2fa3b38 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e【参考】\u003cbr\u003e\n・\u003ca href=\"https://t-dilemma.info/static-website-hosting-by-aws-2020\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAWSで独自ドメインのhttpsな静的Webサイトを構築する（ACM+S3＋CloudFront+Route53）\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://docs.aws.amazon.com/ja_jp/Route53/latest/DeveloperGuide/welcome-dns-service.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eウェブサイトやウェブアプリケーションへのインターネットトラフィックのルーティング\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://www.lac.co.jp/library/ssl/3.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSSL/TLSとは何か\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ssl-やら-dnsサーバー-やら-証明書-が何だかわからない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ssl-%E3%82%84%E3%82%89-dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC-%E3%82%84%E3%82%89-%E8%A8%BC%E6%98%8E%E6%9B%B8-%E3%81%8C%E4%BD%95%E3%81%A0%E3%81%8B%E3%82%8F%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSSL やら DNSサーバー やら 証明書 が何だかわからない\u003c/h2\u003e\n\n\u003cp\u003e今回の構成は SSL やら DNSサーバー やら 証明書 やらその辺の知識が必要になってきます。\u003c/p\u003e\n\n\u003cp\u003eITパスポートレベルの基礎的なことだと思うのですが、自分はこの辺の理解が乏しく、よくわからないまま環境を構築することになりました。\u003c/p\u003e\n\n\u003cp\u003e（自分が無知なだけでありますが、）AWS の公式ドキュメントは割とそのあたりの知識があることを前提としているので、\u003cstrong\u003e基本的な用語などについては別で調べて、よく理解しながら進むしかないと思います。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e以下、よく見たサイトのリンクになります。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e暗号化通信\u003c/strong\u003e\u003cbr\u003e\n・\u003ca href=\"https://blog.qbist.co.jp/?p=1441\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHTTPS と SSL と TLS：その違いを５分でわかりやすく解説！\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://www.lac.co.jp/library/ssl/3.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSSL/TLSとは何か\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDNS レコード\u003c/strong\u003e\u003cbr\u003e\n・\u003ca href=\"https://qiita.com/leomaro7/items/7d717077dd9165357f16\" id=\"reference-7d05027fdbb541de5a5c\"\u003eDNSレコード\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://qiita.com/PharaohKJ/items/b6a933b7f79afe8a32e1\" id=\"reference-4e33620078c1607c6c15\"\u003eAレコードとCNAMEレコードの違い\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"freenom-で無料ドメインが発行できない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#freenom-%E3%81%A7%E7%84%A1%E6%96%99%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%81%8C%E7%99%BA%E8%A1%8C%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003efreenom で無料ドメインが発行できない\u003c/h2\u003e\n\n\u003cp\u003eこの構成での解説記事は \u003ca href=\"https://www.freenom.com/ja/index.html?lang=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003efreenom\u003c/a\u003e というサイトで無料ドメインを作成して、それを用いて検証しているものが多くありました。\u003c/p\u003e\n\n\u003cp\u003eそれに習って、無料ドメインを作成したかったのですが、なぜか作成できませんでした。\u003c/p\u003e\n\n\u003cp\u003eなので、仕方なく AWS の Route 53 は有料でしたが、年間 12-14 ドルほどで購入できるとのことでしたので、Route 53 でドメインを購入しました。\u003c/p\u003e\n\n\u003cp\u003eドメインの購入は一瞬で作成できたので、初めから Route 53 で購入しておけば楽だったと後悔しました。\u003c/p\u003e\n\n\u003cp\u003e【参考】\u003cbr\u003e\n\u003ca href=\"https://qiita.com/takashi8816/items/d6d7edc711494dd24e0d\" id=\"reference-7f228f33d69dbca5f006\"\u003eRoute53でドメインを購入方法\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"acm-での証明書のリクエスト時の-dns-検証がよくわかわからない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#acm-%E3%81%A7%E3%81%AE%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%AE%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E6%99%82%E3%81%AE-dns-%E6%A4%9C%E8%A8%BC%E3%81%8C%E3%82%88%E3%81%8F%E3%82%8F%E3%81%8B%E3%82%8F%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eACM での証明書のリクエスト時の DNS 検証がよくわかわからない\u003c/h2\u003e\n\n\u003cp\u003eACM での証明書のリクエストはなにやっているかわからなくて、何度も調べたので、私なりにまとめました。\u003cbr\u003e\n（結局、\u003ca\u003e公式ドキュメント\u003c/a\u003eを読んだらよく理解できました。）\u003c/p\u003e\n\n\u003cp\u003e以下、解説になります。\u003c/p\u003e\n\n\u003cp\u003eACM では証明書のリクエストをすると Amazon 認証局 (CA) が証明書を発行する前にドメイン名の所有者または管理者であることを検証します。\u003c/p\u003e\n\n\u003cp\u003eその検証の方法は以下の 2 種類があります。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eDNS 検証\u003c/li\u003e\n\u003cli\u003eE メール検証\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e公式ドキュメントにもあるように DNS 検証の方が証明書の自動更新などの恩恵を受けられるので E メール検証よりも \u003cstrong\u003eDNS 検証\u003c/strong\u003eが推奨されています。\u003c/p\u003e\n\n\u003cp\u003eDNS 検証の手順は以下の通りです。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eDNS 検証を選択する\u003c/li\u003e\n\u003cli\u003eDNS データベースに挿入する CNAME レコードを ACM が発行される\u003c/li\u003e\n\u003cli\u003e発行された CNAME レコードを DNS データベースに挿入する（Route 53 を DNS プロバイダにしている場合はACM のコンソールからワンクリックで挿入可能）\u003c/li\u003e\n\u003cli\u003eCNAME レコード挿入後、しばらくすると自動的に ACM が DNS 検証を完了します（完了までに数分かかります）\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eここで発行される CNAME レコードの値は ACM が所有するドメインを指すエイリアスであり、ACM が証明書を自動更新するときに使用されるらしいです（ここでのレコードの値については特に気にする必要はない理解）。\u003c/p\u003e\n\n\u003cp\u003eACM での証明書のリクエストで行っていることはこのような感じになります。\u003c/p\u003e\n","body":"# この記事の対象者\n\n-  Route 53 + ACM + CloudFront + S3 構成を構築しようと試みている人\n-  Route 53 + ACM + CloudFront + S3 構成を構築してみたがいまいち全体像がわからない人\n-  AWS で独自ドメインで HTTPS 通信で Web サイトを配信したい人\n-  AWS 初心者\n\n# はじめに\n\nAWS で Web サイトを独自ドメインで配信するにはどうしたらいいのか調べてたところ、どうも Route 53 + ACM + CloudFront + S3 の構成がスタンダードのようでした。\n\n【参考】\n・[AWSにおける静的コンテンツ配信パターンカタログ（アンチパターン含む）](https://dev.classmethod.jp/articles/static-contents-delivery-patterns/)\n\nそして、この構成についての参考になるサイトがたくさん存在します。\n\n以下リンクになります。\n\n・[AWSで独自ドメインのhttpsな静的Webサイトを構築する（ACM+S3＋CloudFront+Route53）](https://t-dilemma.info/static-website-hosting-by-aws-2020)\n・[AWSをフル活用してブログをdevドメインに移行した](https://blog.pirox.dev/2019/03/16/337/) \n・[Amazon S3 + AWS Certificate Manager (ACM) + Amazon CloudFront + オリジンアクセスアイデンティティ(OAI) でhttpsサイト公開](https://www.seeds-std.co.jp/blog/creators/2019-12-24-124054/)\n\n**特に1番上の記事は全ての手順に画像があるので非常にわかりやすかったです。**\n\n初めはこれらに相当する記事を書こうと思ったのですが、上記のようにそのような記事は既にあったため、**この記事は自分が実際に環境を構築した際につまずいたところについて書いていきたいと思います。**\n\n# つまずいたところ解説\n\n基本的にここのサイトの手順になぞって構築してうまくいきました。\n・[AWSで独自ドメインのhttpsな静的Webサイトを構築する（ACM+S3＋CloudFront+Route53）](https://t-dilemma.info/static-website-hosting-by-aws-2020)\n\n個人的につまずいたところを書いていきたいと思います。\n\n## 全体感がつかめない（この記事のメイン）\n\n解説の記事通りやっても、かなり操作が多いため、途中で自分が何を、何のためにやっているか分からなくなります。\n\n全体感が分かりやすくなるように、私なりに解説していきます。\n\nまず、サンプルとして以下の値を設定するとして、**各サービス別での**操作を書いていきたいと思います。\n\n### 設定値（サンプル）\n\n- 独自ドメイン名：`hogehoge.com`\n- S3 バケット名：`mogemoge-bucket`\n- 発行される CloudFront ドメイン名：`nantoka.cloudfront.net.` ← 実際は設定不可能な値\n- 一般ユーザーがサイトにアクセスする際のURL：`https://pokapoka.hogehoge.com`\n\n### 各サービスごとに実施する操作\n\n#### **独自ドメイン発行サービス（お名前.com や freenom など、もちろん Route 53 でドメインを買ってもよい）**\n\n-  `hogehoge.com` というドメインを発行する（末尾が `.com` である必要はない）\n\n#### **Route 53**\n\n- `hogehoge.com` の HostedZone （ ＝ DNS レコードを格納できるところ） を作成する（Route 53 でドメインを購入した場合は自動で作成される）\n-  （この操作は CloudFront 設定後の作業）CloudFront で代替ドメイン名（CNAMEs）として登録したドメイン\b `pokapoka.hogehoge.com` と、CloudFront \nの Distribution のドメイン `nantoka.cloudfront.net.` を結びつけるために ALIAS レコード（A レコード）を挿入する\n\n#### **ACM（AWS Certificate Manager）**\n\n- `hogehoge.com` と `*.hogehoge.com` というドメインに対する証明書を発行する（ワイルドカードを使ってドメインある程度まとめてドメインを発行したほうがあとあと便利）（参考：[パブリック証明書のリクエスト](https://docs.aws.amazon.com/ja_jp/acm/latest/userguide/gs-acm-request-public.html)）\n\n#### **S3**\n\n- `mogemoge-bucket` というバケットを作成する（今回の構成ではドメイン名と合わせる必要はありません）\n- `mogemoge-bucket` を静的ウェブサイトとして公開する\n- `mogemoge-bucket` に静的コンテンツをアップロードする（最低限 index.html があればよい）\n\n#### **CloudFront**\n\n- CloudFront の Distribution 作成する\n  - Distribution を S3 の `mogemoge-bucket` に指定\n  - Distribution の代替ドメイン名 (CNAMEs) を `pokapoka.hogehoge.com` と登録する（複数登録することも可能）\n  - さきほど ACM で作成した証明書を指定する\n- Distribution 作成すると Distribution のドメインが自動的に発行される（`nantoka.cloudfront.net.` など）（※このドメイン名は自動発行）\n- Distribution を作成後に CloudFront の Distribution の origin access identity（OAI）の編集から S3 の `mogemoge-bucket` へのアクセスを CloudFront を介してのみに制限する（これを行うとワンクリックで `mogemoge-bucket` のバケットポリシーが更新される）（これを設定しないと S3 の `mogemoge-bucket` は静的ウェブサイトとして公開しているため、CloudFront を経由せずに直接アクセス可能になってしまう）\n\n### 操作の結果\n\nそして、これらの手順の結果、各 AWS のサービスの状態と、その状態が表す意味は以下のようになります。\n\n#### Route 53\n\n- CNAME レコード\n  - ACM の DNS 検証 で挿入したレコード\n        - **（解説）**証明書の発行のときに挿入したよ、普段はとくに使わないよ、このレコードがある間は ACM が証明書の自動更新をやってくれるよ\n- A レコード\n  - `pokapoka.hogehoge.com` \b= `nantoka.cloudfront.net.`\n        - **（解説）**`pokapoka.hogehoge.com` は `nantoka.cloudfront.net.` のフリをするよ、名前解決のときに使うよ\n\n\n#### ACM（AWS Certificate Manager）\n\n- 証明書\n  - `hogehoge.com` と `*.hogehoge.com` というドメインに対する証明書\n        - **（解説）**この証明書は ACM で管理しているよ、一度、証明書を発行したらここの設定を変えることはないよ\n      \n#### CloudFront\n\n- Distribution\n  - S3 `mogemoge-bucket`\n      - **（解説）**`nantoka.cloudfront.net.` のアクセス先は S3 の `mogemoge-bucket` だよ\n- Distribution CNAMEs\n  - `nantoka.cloudfront.net.` = `pokapoka.hogehoge.com`\n      - **（解説）**`nantoka.cloudfront.net.` は `pokapoka.hogehoge.com` のフリをするよ、基本的に `pokapoka.hogehoge.com` でアクセスされたのを `nantoka.cloudfront.net.` に読み替えるよ\n- SSL Certificate\n  - `*.hogehoge.com` の証明書を設定\n      - **（解説）**この Distribution では `*.hogehoge.com` の証明書を使うよ\n\n#### S3\n\n- 静的ウェブサイトホスティング設定\n  - 有効\n      - **（解説）**HTTP/HTTPS のリクエストがきたら `mogemoge-bucket` の中身をWebページとして返却するよ\n- パケットポリシー\n  - CloudFront のみ OK\n      - **（解説）**`mogemoge-bucket` にアクセスにするには必ず CloudFront を経由してくださいね、それ以外の経路でアクセスしたら断ますよ\n\n### 全体像\n\nここで、全体像を確認したいと思います。\n\nまず、名前解決を含めた Web サイトにアクセスした際の通信のフローは以下の図のようになります。\n![how-route-53-routes-traffic.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/cc7589f5-b5c8-da4c-951a-3a9f5287f6b3.png)\n\n大きく分けて以下のフローに分けれれます。\n\n- 1 〜 7 ：ドメインの名前解決\n- 8 〜 9 ：コンテンツ配信\n\nそのフローを、 Route 53 + ACM + CloudFront + S3 構成の全体像で当てはめると以下のようになります。\n![img_5f01d1bdc21cb.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/b4bf6ff7-fa70-0396-0622-07574e98e252.png)\n\n**Route 53 は 「ドメインの名前解決する役割」 と 「ACM の証明書リクエストを検証する役割」があるということが分かります。**\n\n**また、CloudFront は 「証明書が置いてある Web サーバーとしての役割」 と 「キャッシュサーバーとしての役割」 があることがわかります。**\n\nちなみに、8 〜 9のコンテンツ配信は SSL 通信をしており、その詳細のフローは以下の図のようになります。\n![fig02.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/4d0fae3c-4d8f-18ce-10d3-27864870af43.png)\n\n【参考】\n・[AWSで独自ドメインのhttpsな静的Webサイトを構築する（ACM+S3＋CloudFront+Route53）](https://t-dilemma.info/static-website-hosting-by-aws-2020)\n・[ウェブサイトやウェブアプリケーションへのインターネットトラフィックのルーティング](https://docs.aws.amazon.com/ja_jp/Route53/latest/DeveloperGuide/welcome-dns-service.html)\n・[SSL/TLSとは何か](https://www.lac.co.jp/library/ssl/3.html)\n\n## SSL やら DNSサーバー やら 証明書 が何だかわからない\n\n今回の構成は SSL やら DNSサーバー やら 証明書 やらその辺の知識が必要になってきます。\n\nITパスポートレベルの基礎的なことだと思うのですが、自分はこの辺の理解が乏しく、よくわからないまま環境を構築することになりました。\n\n（自分が無知なだけでありますが、）AWS の公式ドキュメントは割とそのあたりの知識があることを前提としているので、**基本的な用語などについては別で調べて、よく理解しながら進むしかないと思います。**\n\n以下、よく見たサイトのリンクになります。\n\n**暗号化通信**\n・[HTTPS と SSL と TLS：その違いを５分でわかりやすく解説！](https://blog.qbist.co.jp/?p=1441)\n・[SSL/TLSとは何か](https://www.lac.co.jp/library/ssl/3.html)\n\n**DNS レコード**\n・[DNSレコード](https://qiita.com/leomaro7/items/7d717077dd9165357f16)\n・[AレコードとCNAMEレコードの違い](https://qiita.com/PharaohKJ/items/b6a933b7f79afe8a32e1)\n\n## freenom で無料ドメインが発行できない\n\nこの構成での解説記事は [freenom](https://www.freenom.com/ja/index.html?lang=ja) というサイトで無料ドメインを作成して、それを用いて検証しているものが多くありました。\n\nそれに習って、無料ドメインを作成したかったのですが、なぜか作成できませんでした。\n\nなので、仕方なく AWS の Route 53 は有料でしたが、年間 12-14 ドルほどで購入できるとのことでしたので、Route 53 でドメインを購入しました。\n\nドメインの購入は一瞬で作成できたので、初めから Route 53 で購入しておけば楽だったと後悔しました。\n\n【参考】\n[Route53でドメインを購入方法](https://qiita.com/takashi8816/items/d6d7edc711494dd24e0d)\n\n\n## ACM での証明書のリクエスト時の DNS 検証がよくわかわからない\n\nACM での証明書のリクエストはなにやっているかわからなくて、何度も調べたので、私なりにまとめました。\n（結局、[公式ドキュメント]((https://docs.aws.amazon.com/ja_jp/acm/latest/userguide/gs-acm-validate-dns.html))を読んだらよく理解できました。）\n\n以下、解説になります。\n\nACM では証明書のリクエストをすると Amazon 認証局 (CA) が証明書を発行する前にドメイン名の所有者または管理者であることを検証します。\n\nその検証の方法は以下の 2 種類があります。\n\n1. DNS 検証\n2. E メール検証\n\n公式ドキュメントにもあるように DNS 検証の方が証明書の自動更新などの恩恵を受けられるので E メール検証よりも **DNS 検証**が推奨されています。\n\nDNS 検証の手順は以下の通りです。\n\n1. DNS 検証を選択する\n2. DNS データベースに挿入する CNAME レコードを ACM が発行される\n3. 発行された CNAME レコードを DNS データベースに挿入する（Route 53 を DNS プロバイダにしている場合はACM のコンソールからワンクリックで挿入可能）\n4. CNAME レコード挿入後、しばらくすると自動的に ACM が DNS 検証を完了します（完了までに数分かかります）\n\nここで発行される CNAME レコードの値は ACM が所有するドメインを指すエイリアスであり、ACM が証明書を自動更新するときに使用されるらしいです（ここでのレコードの値については特に気にする必要はない理解）。\n\nACM での証明書のリクエストで行っていることはこのような感じになります。\n","coediting":false,"comments_count":0,"created_at":"2020-11-25T08:46:43+09:00","group":null,"id":"bd99e6b32e4f5f0e8096","likes_count":10,"private":false,"reactions_count":0,"tags":[{"name":"AWS","versions":[]},{"name":"S3","versions":[]},{"name":"route53","versions":[]},{"name":"CloudFront","versions":[]},{"name":"CertificateManager","versions":[]}],"title":"【AWS】 Route 53 + ACM + CloudFront + S3 の構成を構築する際にいろいろつまずいた件","updated_at":"2020-12-13T13:40:40+09:00","url":"https://qiita.com/ikuraikura/items/bd99e6b32e4f5f0e8096","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"目標\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%AE%E6%A8%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e目標\u003c/h1\u003e\n\n\u003cp\u003e本記事の目標は S3 のバケットに HTML ファイルをアップロードしてそれをブラウザから表示してみることです。\u003cbr\u003e\n図で表すと以下のようになります。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/6e108893ddc5740f68373a6a042a05818b02a196/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f31633236346439322d383737352d643466642d306132382d3634353034623466343436352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F1c264d92-8775-d4fd-0a28-64504b4f4465.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ef0cb9bdc5df2106a991b152e4f844a9\" alt=\"png.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/1c264d92-8775-d4fd-0a28-64504b4f4465.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F1c264d92-8775-d4fd-0a28-64504b4f4465.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9fb0575871c3be00b45e41dc6cffa6a3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e【参考】\u003cbr\u003e\n・\u003ca href=\"https://docs.aws.amazon.com/ja_jp/AmazonS3/latest/user-guide/static-website-hosting.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e静的ウェブサイトホスティング用に S3 バケットを設定する方法\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://www.slideshare.net/horiyasu/amazon-s3web-27138902\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAmazon S3による静的Webサイトホスティング\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"手順\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%89%8B%E9%A0%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e手順\u003c/h1\u003e\n\n\u003col\u003e\n\u003cli\u003eバケットの作成\u003c/li\u003e\n\u003cli\u003eバケットの設定\u003c/li\u003e\n\u003cli\u003eコンテンツのアップロード\u003c/li\u003e\n\u003cli\u003eブラウザからアクセス\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"1-バケットの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E3%83%90%E3%82%B1%E3%83%83%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. バケットの作成\u003c/h1\u003e\n\n\u003cp\u003e画像の赤枠を修正したりクリックしていくだけです。\u003cbr\u003e\n基本すべてデフォルト設定で作成して、あとから設定を編集していきます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/62329617d031dfcd5938c16d3048454e3b3cbf2f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f36636139343064612d313133322d646234622d633132612d6633306666363231366162642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F6ca940da-1132-db4b-c12a-f30ff6216abd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8391f75c9dcbe762bf5d67e310b9f230\" alt=\"1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/6ca940da-1132-db4b-c12a-f30ff6216abd.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F6ca940da-1132-db4b-c12a-f30ff6216abd.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=499f58e5c41ebb6b98db122cd62168b4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n※ 今回はバケット名を「test-bucket-suguru」に設定しました。適宜変更してください。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/719ba2e03bc6c52411c499ed7ec8310c08eb940f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f61303633643031622d393732392d346635372d343235342d3235646633363965636536372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fa063d01b-9729-4f57-4254-25df369ece67.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=cba9d728ff93aaa16809d5c4348bd853\" alt=\"2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/a063d01b-9729-4f57-4254-25df369ece67.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fa063d01b-9729-4f57-4254-25df369ece67.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=41b28e6249ee0dbec27bd8d5e4cffb48 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/145e40f0310c0dfab3dec8b876ba1638cc67b9b4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f30383733646165302d313838302d353537612d613061622d3764306138386265643061312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F0873dae0-1880-557a-a0ab-7d0a88bed0a1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5063a5bfa11bcd9a009b76790f82a91f\" alt=\"3.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/0873dae0-1880-557a-a0ab-7d0a88bed0a1.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F0873dae0-1880-557a-a0ab-7d0a88bed0a1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bc92d07f92219b5fef635b64599c8508 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f2effd725e1ba08378fc9580ea85a398d9a428f1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f31613737373734642d633335622d373833652d343933332d3331373263323339626233312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F1a77774d-c35b-783e-4933-3172c239bb31.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=45a2955dff04c8e1f6db66e4caf9dba2\" alt=\"4.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/1a77774d-c35b-783e-4933-3172c239bb31.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F1a77774d-c35b-783e-4933-3172c239bb31.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=13037f506079e6f7c1b435db87ce49ec 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eバケットの作成は以上です。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"2-バケットの設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-%E3%83%90%E3%82%B1%E3%83%83%E3%83%88%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. バケットの設定\u003c/h1\u003e\n\n\u003cp\u003e以下の 3 つの設定をします。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eパブリックアクセスの設定\u003c/li\u003e\n\u003cli\u003eパケットポリシーの設定\u003c/li\u003e\n\u003cli\u003e静的ウェブホスティングの有効化\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-1-パブリックアクセスの設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-1-%E3%83%91%E3%83%96%E3%83%AA%E3%83%83%E3%82%AF%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-1. パブリックアクセスの設定\u003c/h2\u003e\n\n\u003cp\u003e「アクセス許可」から設定します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/6785c2043bd8ad4a3c087fb0037e7212e7650bbc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f66643931656461342d323962662d306364352d653538322d6539376339633838383137662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Ffd91eda4-29bf-0cd5-e582-e97c9c88817f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=70d9686baaca5afdca69cde0331a2ab3\" alt=\"5.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/fd91eda4-29bf-0cd5-e582-e97c9c88817f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Ffd91eda4-29bf-0cd5-e582-e97c9c88817f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=592c2666a00efcb48fa44ecdbec6fffa 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ab40b510318c99374a8b74e80a234ff8a0647d2c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f33613432343530382d643638622d323335622d393262632d3930613839623563663661612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F3a424508-d68b-235b-92bc-90a89b5cf6aa.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3dabb14eadccea1f917bc197b55cd5af\" alt=\"6.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/3a424508-d68b-235b-92bc-90a89b5cf6aa.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F3a424508-d68b-235b-92bc-90a89b5cf6aa.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=83e35affd201dfa903734e093fcdc343 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eパブリックアクセスの設定は以上です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-2-パケットポリシーの設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-2-%E3%83%91%E3%82%B1%E3%83%83%E3%83%88%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-2. パケットポリシーの設定\u003c/h2\u003e\n\n\u003cp\u003e「アクセス許可」から設定します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/489a0df11766e8297ca46ad60e6826289f6fc50f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f34346265386665372d383531362d356439392d313834642d3731313132373034303139642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F44be8fe7-8516-5d99-184d-71112704019d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e9651400b76032e85f4964458583a932\" alt=\"6-5.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/44be8fe7-8516-5d99-184d-71112704019d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F44be8fe7-8516-5d99-184d-71112704019d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6ed2726596ef2314436c0120cb529702 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/a0bf5aff7cc6022958ce25f13435f4663e2d0968/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f63393136646334372d336436342d363863332d363131372d3331386639393239383032382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fc916dc47-3d64-68c3-6117-318f99298028.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0631f66c96f970a82abfc0480df986c3\" alt=\"7.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/c916dc47-3d64-68c3-6117-318f99298028.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fc916dc47-3d64-68c3-6117-318f99298028.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e1abdbb690bbb00add3ae86e6222fa9d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e設定内容は\u003ca href=\"https://docs.aws.amazon.com/ja_jp/AmazonS3/latest/user-guide/static-website-hosting.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e公式\u003c/a\u003eを参考にしてください。\u003cbr\u003e\n公式を見ると以下のように設定するとのことでした。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"Version\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"2012-10-17\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"Statement\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"Sid\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"PublicReadGetObject\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"Effect\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Allow\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"Principal\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"*\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"Action\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e\n                \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"s3:GetObject\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"Resource\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e\n                \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"arn:aws:s3:::\u0026lt;バケット名\u0026gt;/*\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eパケットポリシーの設定は以上です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"2-3-静的ウェブホスティングの有効化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-3-%E9%9D%99%E7%9A%84%E3%82%A6%E3%82%A7%E3%83%96%E3%83%9B%E3%82%B9%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E6%9C%89%E5%8A%B9%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-3. 静的ウェブホスティングの有効化\u003c/h2\u003e\n\n\u003cp\u003e「プロパティ」から設定します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/dfc3b1bd4176a9b0460cdc426e91e91dc72b8736/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f31313065383839662d653730642d326137642d336434352d3635626363343862653966312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F110e889f-e70d-2a7d-3d45-65bcc48be9f1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bef4f5f6d7fa91eab86968adaa1fafcc\" alt=\"8.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/110e889f-e70d-2a7d-3d45-65bcc48be9f1.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F110e889f-e70d-2a7d-3d45-65bcc48be9f1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d4f11348e118e73470fcde4c9e5c853c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/81ca3e4bb1209cc46ca35f8aa6f2d0d21e53bbb6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f37363636623032632d323933312d326432642d656535352d3837323165613838373330362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F7666b02c-2931-2d2d-ee55-8721ea887306.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d762f03fa24976c583842f703e3ac720\" alt=\"9.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/7666b02c-2931-2d2d-ee55-8721ea887306.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F7666b02c-2931-2d2d-ee55-8721ea887306.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=65b493868b21cc3ea31002aea59d2743 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6add0861100d6c9ae8e0b1e2980933fbc4cba4a3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f30613830396466312d373264322d386431612d663139652d6363656332346534653934322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F0a809df1-72d2-8d1a-f19e-ccec24e4e942.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=59e82f24b12a7b0ef7e1f602d029d70b\" alt=\"10.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/0a809df1-72d2-8d1a-f19e-ccec24e4e942.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F0a809df1-72d2-8d1a-f19e-ccec24e4e942.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d516625b99b1024a395708364d5bd9cf 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/cb764907331098414a55f5014e3d68b11245082e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f61356165636561632d653363342d383765332d396236662d3039396463323338386533622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fa5aeceac-e3c4-87e3-9b6f-099dc2388e3b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f8cba3ccfc369d7e1e23b8a835ba9c2c\" alt=\"11.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/a5aeceac-e3c4-87e3-9b6f-099dc2388e3b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fa5aeceac-e3c4-87e3-9b6f-099dc2388e3b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a282425cd120e39e4488ad471480b14b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eデフォルトページを index.html、エラーページを error.html と設定しました。\u003cbr\u003e\nこれらのファイルを次の手順でアップロードします。\u003c/p\u003e\n\n\u003cp\u003e静的ウェブホスティングの有効化は以上になります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"3-コンテンツのアップロード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. コンテンツのアップロード\u003c/h1\u003e\n\n\u003cp\u003eデフォルトページを index.html、エラーページを error.html と設定したのでそれらのファイルをアップロードします。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"3-1-ファイルの用意\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-1-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E7%94%A8%E6%84%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3-1. ファイルの用意\u003c/h2\u003e\n\n\u003cp\u003eアップロードするファイルを用意します。\u003cbr\u003e\n今回は検証なので内容はなんでもいいです。\u003c/p\u003e\n\n\u003cp\u003eHTML から画像ファイルが参照されることも確認したかったので、index.html には image01.png という画像ファイルを参照するようにしました。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eindex.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;p\u0026gt;\u003c/span\u003eindex desu\u003cspan class=\"nt\"\u003e\u0026lt;/p\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;img\u003c/span\u003e \u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"image01.png\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"html\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eerror.html\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;p\u0026gt;\u003c/span\u003eerror desu\u003cspan class=\"nt\"\u003e\u0026lt;/p\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e・image01.png ↓\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/bf694808648cb6276e9c76d89e5de3a3a9d73332/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f35363438306130662d643763642d323462302d663061352d6562613637323530643031352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F56480a0f-d7cd-24b0-f0a5-eba67250d015.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7d60d355cd75d831f13b35fb7955fec7\" alt=\"image01.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/56480a0f-d7cd-24b0-f0a5-eba67250d015.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F56480a0f-d7cd-24b0-f0a5-eba67250d015.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=31d312d9526f6b72ff2b4adabfa8b771 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"3-2-アップロード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-2-%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3-2. アップロード\u003c/h2\u003e\n\n\u003cp\u003e用意した以下の 3 つのファイルをアップロードします。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eindex.html\u003c/li\u003e\n\u003cli\u003eerror.html\u003c/li\u003e\n\u003cli\u003eimage01.png \u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/c900d63baa375e111d10214b1608b82f50c10e76/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f33656361663463332d323133392d346139652d316562312d3765336331396133303737352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F3ecaf4c3-2139-4a9e-1eb1-7e3c19a30775.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=aa0320e21afd9feb1a6e96f314299702\" alt=\"12.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/3ecaf4c3-2139-4a9e-1eb1-7e3c19a30775.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F3ecaf4c3-2139-4a9e-1eb1-7e3c19a30775.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=45f6350d13a442b10a0ec517fcb82f2f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/39dc0d8f6d2a4253e57f9f29a79abcff947692e6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f65396438343138662d303930322d383034372d333362632d3261343166633062646337312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fe9d8418f-0902-8047-33bc-2a41fc0bdc71.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=cedac9d91da4cda6b32e823a1791b9c1\" alt=\"13.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/e9d8418f-0902-8047-33bc-2a41fc0bdc71.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fe9d8418f-0902-8047-33bc-2a41fc0bdc71.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=036ed7ce8b14b789d2154f42d4f69334 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/cdfad27fb93177d632ce4387ad8cdbe1de3749e2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f34303534643663392d346337372d326335352d653465642d6562303238623735353161392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F4054d6c9-4c77-2c55-e4ed-eb028b7551a9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ef31964eafe03621c7a6adf2aaaf5646\" alt=\"14.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/4054d6c9-4c77-2c55-e4ed-eb028b7551a9.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F4054d6c9-4c77-2c55-e4ed-eb028b7551a9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e59606a25bd6ca7fc9cf4f50c041d301 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/0b7ffc13eef43e623e03b02d08c79138461033ea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f63656332323930342d633935632d356362642d333937632d3039336234626166366466342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fcec22904-c95c-5cbd-397c-093b4baf6df4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d4bd466de036e9093f6e9d33b854ff15\" alt=\"15.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/cec22904-c95c-5cbd-397c-093b4baf6df4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Fcec22904-c95c-5cbd-397c-093b4baf6df4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2b92b3c822d5a73f67e2efa547fa1684 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eコンテンツのアップロードは以上になります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"4-ブラウザからアクセス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4. ブラウザからアクセス\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"4-1-エンドポイントの確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-1-%E3%82%A8%E3%83%B3%E3%83%89%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4-1. エンドポイントの確認\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/f0a6c22256e2e917e3bf593d54244d3760734814/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f34373662656134662d363664332d643336302d323962642d3666623638343639356466372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F476bea4f-66d3-d360-29bd-6fb684695df7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d7273bfb2a3e2016866ac79bd4c5e3ad\" alt=\"16.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/476bea4f-66d3-d360-29bd-6fb684695df7.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F476bea4f-66d3-d360-29bd-6fb684695df7.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a52c05fcc4d399f995b3939b7d97e6d8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/e8e2b92df01301344424c257903b24a4824db490/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f66653364303265312d383761632d313537322d643036612d3062356438616233333362392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Ffe3d02e1-87ac-1572-d06a-0b5d8ab333b9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=30836c65e2c5ed61592f266693452ed4\" alt=\"17.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/fe3d02e1-87ac-1572-d06a-0b5d8ab333b9.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2Ffe3d02e1-87ac-1572-d06a-0b5d8ab333b9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=959ac3747e807bb629fce01a3bd43d41 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e赤枠がエンドポイントの URL になります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"4-2-ブラウザからアクセス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-2-%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4-2. ブラウザからアクセス\u003c/h2\u003e\n\n\u003cp\u003e確認したエンドポイントの URL をコピーしてブラウザからアクセスします。\u003c/p\u003e\n\n\u003cp\u003eデフォルトを index.html と設定したので、アクセスすると index.html が表示されます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6afbadb90553bde6af17eaa3eaaf506fe2b2b962/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f38313466323663322d646164652d613231612d613035352d3561343738323766316235392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F814f26c2-dade-a21a-a055-5a47827f1b59.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9683c5bbd81c041b8852879c8097dd1a\" alt=\"18.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/814f26c2-dade-a21a-a055-5a47827f1b59.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F814f26c2-dade-a21a-a055-5a47827f1b59.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7cb55455059a4a99d8bae528e1bbc8c7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nデフォルトページの URL の末尾に  \u003ccode\u003e/error.html\u003c/code\u003e をつけてアクセスするとエラーページが表示されます。 \u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f943f8368c772f45b07ffc0fb8ebd0e024b43e92/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f33396332643161632d616366352d616365312d666336642d3564323065656130653433362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F39c2d1ac-acf5-ace1-fc6d-5d20eea0e436.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c38fe42826f80635ddbf2b22c2a64f65\" alt=\"19.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/39c2d1ac-acf5-ace1-fc6d-5d20eea0e436.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F39c2d1ac-acf5-ace1-fc6d-5d20eea0e436.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=51df57ce069c685115405762f0dd2e42 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"5-バケットの削除\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-%E3%83%90%E3%82%B1%E3%83%83%E3%83%88%E3%81%AE%E5%89%8A%E9%99%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5. バケットの削除\u003c/h1\u003e\n\n\u003cp\u003e最後にバケットの中身を空にして、さらにバケットそのものを削除しましょう。\u003cbr\u003e\n今の状態だとアクセスが大量にきてしまうと無料枠を突破してしまう可能性があります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\n\u003cp\u003e目標であった S3 のバケットに HTML ファイルをアップロードしてそれをブラウザから表示してみることが達成できました。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/55c087586f7ae201c7c80e4fe4308b16ea7710bb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3235393132352f30646663353939342d323566642d373836612d363164312d3364373864653230363437622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F0dfc5994-25fd-786a-61d1-3d78de20647b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4679dac2c7606bb4c9765542452f5afd\" alt=\"png.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/0dfc5994-25fd-786a-61d1-3d78de20647b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F259125%2F0dfc5994-25fd-786a-61d1-3d78de20647b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7a647145b63d726c88a9846ccef7aa50 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n","body":"\n# 目標\n\n本記事の目標は S3 のバケットに HTML ファイルをアップロードしてそれをブラウザから表示してみることです。\n図で表すと以下のようになります。\n\n![png.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/1c264d92-8775-d4fd-0a28-64504b4f4465.png)\n\n\n【参考】\n・[静的ウェブサイトホスティング用に S3 バケットを設定する方法](https://docs.aws.amazon.com/ja_jp/AmazonS3/latest/user-guide/static-website-hosting.html)\n・[Amazon S3による静的Webサイトホスティング](https://www.slideshare.net/horiyasu/amazon-s3web-27138902)\n\n# 手順\n\n1. バケットの作成\n2. バケットの設定\n3. コンテンツのアップロード\n4. ブラウザからアクセス\n\n# 1. バケットの作成\n\n画像の赤枠を修正したりクリックしていくだけです。\n基本すべてデフォルト設定で作成して、あとから設定を編集していきます。\n\n![1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/6ca940da-1132-db4b-c12a-f30ff6216abd.png)\n※ 今回はバケット名を「test-bucket-suguru」に設定しました。適宜変更してください。\n![2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/a063d01b-9729-4f57-4254-25df369ece67.png)\n![3.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/0873dae0-1880-557a-a0ab-7d0a88bed0a1.png)\n![4.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/1a77774d-c35b-783e-4933-3172c239bb31.png)\n\nバケットの作成は以上です。\n\n# 2. バケットの設定\n\n以下の 3 つの設定をします。\n\n- パブリックアクセスの設定\n- パケットポリシーの設定\n- 静的ウェブホスティングの有効化\n\n## 2-1. パブリックアクセスの設定\n\n「アクセス許可」から設定します。\n\n![5.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/fd91eda4-29bf-0cd5-e582-e97c9c88817f.png)\n![6.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/3a424508-d68b-235b-92bc-90a89b5cf6aa.png)\n\nパブリックアクセスの設定は以上です。\n\n## 2-2. パケットポリシーの設定\n\n「アクセス許可」から設定します。\n\n![6-5.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/44be8fe7-8516-5d99-184d-71112704019d.png)\n![7.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/c916dc47-3d64-68c3-6117-318f99298028.png)\n\n設定内容は[公式](https://docs.aws.amazon.com/ja_jp/AmazonS3/latest/user-guide/static-website-hosting.html)を参考にしてください。\n公式を見ると以下のように設定するとのことでした。\n\n```json\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"PublicReadGetObject\",\n            \"Effect\": \"Allow\",\n            \"Principal\": \"*\",\n            \"Action\": [\n                \"s3:GetObject\"\n            ],\n            \"Resource\": [\n                \"arn:aws:s3:::\u003cバケット名\u003e/*\"\n            ]\n        }\n    ]\n}\n```\n\nパケットポリシーの設定は以上です。\n\n## 2-3. 静的ウェブホスティングの有効化\n\n「プロパティ」から設定します。\n\n![8.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/110e889f-e70d-2a7d-3d45-65bcc48be9f1.png)\n![9.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/7666b02c-2931-2d2d-ee55-8721ea887306.png)\n![10.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/0a809df1-72d2-8d1a-f19e-ccec24e4e942.png)\n![11.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/a5aeceac-e3c4-87e3-9b6f-099dc2388e3b.png)\n\nデフォルトページを index.html、エラーページを error.html と設定しました。\nこれらのファイルを次の手順でアップロードします。\n\n静的ウェブホスティングの有効化は以上になります。\n\n# 3. コンテンツのアップロード\n\nデフォルトページを index.html、エラーページを error.html と設定したのでそれらのファイルをアップロードします。\n\n## 3-1. ファイルの用意\n\nアップロードするファイルを用意します。\n今回は検証なので内容はなんでもいいです。\n\nHTML から画像ファイルが参照されることも確認したかったので、index.html には image01.png という画像ファイルを参照するようにしました。\n\n```html:index.html\n\u003cp\u003eindex desu\u003c/p\u003e\n\u003cimg src=\"image01.png\"\u003e\n```\n\n```html:error.html\n\u003cp\u003eerror desu\u003c/p\u003e\n```\n\n・image01.png ↓\n![image01.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/56480a0f-d7cd-24b0-f0a5-eba67250d015.png)\n\n## 3-2. アップロード\n\n用意した以下の 3 つのファイルをアップロードします。\n\n- index.html\n- error.html\n- image01.png \n\n![12.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/3ecaf4c3-2139-4a9e-1eb1-7e3c19a30775.png)\n![13.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/e9d8418f-0902-8047-33bc-2a41fc0bdc71.png)\n![14.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/4054d6c9-4c77-2c55-e4ed-eb028b7551a9.png)\n![15.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/cec22904-c95c-5cbd-397c-093b4baf6df4.png)\n\nコンテンツのアップロードは以上になります。\n\n# 4. ブラウザからアクセス\n\n## 4-1. エンドポイントの確認\n\n![16.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/476bea4f-66d3-d360-29bd-6fb684695df7.png)\n![17.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/fe3d02e1-87ac-1572-d06a-0b5d8ab333b9.png)\n\n赤枠がエンドポイントの URL になります。\n\n## 4-2. ブラウザからアクセス\n\n確認したエンドポイントの URL をコピーしてブラウザからアクセスします。\n\nデフォルトを index.html と設定したので、アクセスすると index.html が表示されます。\n![18.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/814f26c2-dade-a21a-a055-5a47827f1b59.png)\nデフォルトページの URL の末尾に  `/error.html` をつけてアクセスするとエラーページが表示されます。 \n![19.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/39c2d1ac-acf5-ace1-fc6d-5d20eea0e436.png)\n\n# 5. バケットの削除\n\n最後にバケットの中身を空にして、さらにバケットそのものを削除しましょう。\n今の状態だとアクセスが大量にきてしまうと無料枠を突破してしまう可能性があります。\n\n# まとめ\n\n目標であった S3 のバケットに HTML ファイルをアップロードしてそれをブラウザから表示してみることが達成できました。\n\n![png.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/259125/0dfc5994-25fd-786a-61d1-3d78de20647b.png)\n","coediting":false,"comments_count":0,"created_at":"2020-11-20T02:14:56+09:00","group":null,"id":"820bea40f910c106738b","likes_count":1,"private":false,"reactions_count":0,"tags":[{"name":"AWS","versions":[]},{"name":"S3","versions":[]}],"title":"【AWS】S3 のバケットに HTML ファイルをアップロードしてブラウザから表示する","updated_at":"2020-11-25T14:10:49+09:00","url":"https://qiita.com/ikuraikura/items/820bea40f910c106738b","user":{"description":" このサイトへの掲載内容はあくまで私個人の見解であり、所属企業における立場、戦略、意見を代表するものではありません。iOS、Swift、SwiftUI、Flutter、UI/UX、Firebase、AWS、Docker、CI/CD","facebook_id":"","followees_count":7,"followers_count":17,"github_login_name":null,"id":"ikuraikura","items_count":62,"linkedin_id":"","location":"","name":"サーモン イクラ","organization":"","permanent_id":259125,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/259125/c7ab3e80cde8cdcaf1cd12778c0a05209ce30837/x_large.png?1640369132","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null}]